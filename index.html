<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GiftsMine üéÅ</title>
<style>
body {
  margin:0;font-family:Segoe UI,sans-serif;color:#fff;
  display:flex;flex-direction:column;height:100vh;
  overflow:hidden;background-size:cover;background-position:center;
  opacity:0;transition:opacity .6s ease;
}
#balance {padding:15px;text-align:right;font-size:1.2em;font-weight:bold;
  background:rgba(0,0,0,0.15);backdrop-filter:blur(5px);}
main {flex:1;overflow-y:auto;padding:10px;display:none;background:rgba(0,0,0,0.3);}
main.active {display:block;}
.tab-bar {display:flex;justify-content:space-around;background:rgba(0,0,0,0.2);padding:10px;}
.tab-bar button {flex:1;margin:0 5px;padding:10px;border:none;
  background:linear-gradient(135deg,#ff9a9e,#fad0c4);color:#fff;font-weight:bold;cursor:pointer;}
.tab-bar button.active {background:linear-gradient(135deg,#a1c4fd,#c2e9fb);}
.grid {display:grid;gap:5px;justify-content:center;}
.mines-grid {grid-template-columns:repeat(5,1fr);}
.mine-cell,.block {
  aspect-ratio:1/1;background:#333;display:flex;align-items:center;justify-content:center;
  font-size:.9em;font-weight:bold;cursor:pointer;position:relative;
  background-size:cover;background-position:center;
}
.block-price{position:absolute;bottom:2px;right:2px;background:rgba(0,0,0,0.5);font-size:.7em;padding:2px 4px;border-radius:3px;}
.block.cooldown{filter:brightness(0.6);}
.cooldown-timer{position:absolute;top:2px;left:2px;background:rgba(0,0,0,0.6);padding:2px 4px;font-size:.7em;border-radius:3px;}
.inventory-list{display:flex;flex-wrap:wrap;gap:10px;}
.gift-item{background:#222;padding:10px;flex:1 1 45%;display:flex;align-items:center;gap:10px;}
.gift-img{width:50px;height:50px;}
.gift-buttons{display:flex;flex-direction:column;gap:5px;}
#loader{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:#000;z-index:9999;color:#fff;transition:opacity .6s ease;}
#loader.hidden{opacity:0;pointer-events:none;}
#loaderAnimation{width:150px;height:150px;margin-bottom:20px;}
.flying{position:absolute;width:60px;height:60px;pointer-events:none;z-index:1000;}
#mineReward{border:2px dashed #aaa;padding:10px;border-radius:10px;min-width:150px;text-align:center;}
</style>
</head>
<body>

<div id="loader">
  <div id="loaderAnimation"></div>
  <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤...</p>
</div>

<div id="balance">–ë–∞–ª–∞–Ω—Å: 10000 <img src="ton.svg" width="16"></div>

<main id="menu" class="active"><h2>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h2></main>
<main id="mines">
  <h2>–ú–∏–Ω—ã üí£</h2>
  <div>
    <input type="number" id="tonStake" min="0.5" step="0.1" placeholder="–°—Ç–∞–≤–∫–∞ TON">
    <button onclick="startMines()">–ò–≥—Ä–∞—Ç—å</button>
    <span id="mineReward">–í—ã–∏–≥—Ä—ã—à: ‚Äì</span>
    <button id="collectReward" onclick="collectReward()">–ó–∞–±—Ä–∞—Ç—å</button>
  </div>
  <div class="grid mines-grid" id="minesGrid"></div>
</main>
<main id="mine">
  <h2>–®–∞—Ö—Ç–∞ ‚õèÔ∏è</h2>
  <div class="grid" id="mineGrid" style="grid-template-columns:repeat(4,1fr)"></div>
</main>
<main id="inventory"><h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å üéí</h2><div id="inventoryList" class="inventory-list"></div></main>

<div class="tab-bar">
  <button onclick="showTab('menu')" id="tab-menu" class="active">–ú–µ–Ω—é</button>
  <button onclick="showTab('mines')" id="tab-mines">–ú–∏–Ω—ã</button>
  <button onclick="showTab('mine')" id="tab-mine">–®–∞—Ö—Ç–∞</button>
  <button onclick="showTab('inventory')" id="tab-inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>
<script>
let balance=10000;function updateBalance(){document.getElementById('balance').innerHTML=`–ë–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} <img src="ton.svg" width="16">`;}

// –§–æ–Ω—ã
const backgrounds={menu:'images/menu.jpg',mines:'images/mines.jpg',mine:'images/mine.jpg',inventory:'images/inventory.jpg'};
function showTab(id){
  document.querySelectorAll('main').forEach(m=>m.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.tab-bar button').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+id).classList.add('active');
  document.body.style.backgroundImage=`url(${backgrounds[id]})`;
  if(id==='inventory') renderInventory();
}

// === –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤ ===
const gifts=[
  {name:"Hypno Lollipop",price:1.77},{name:"Desk Calendar",price:1.31},{name:"B-Day Candle",price:1.32},{name:"Lol Pop",price:1.32},
  {name:"Snake Box",price:1.36},{name:"Lunar Snake",price:1.38},{name:"Xmas Stocking",price:1.38},{name:"Whip Cupcake",price:1.38},
  {name:"Candy Cane",price:1.48},{name:"Pet Snake",price:1.58},{name:"Jester Hat",price:1.62},{name:"Snoop Dogg",price:1.64},
  {name:"Homemade Cake",price:1.7},{name:"Holiday Drink",price:1.7},{name:"Jingle Bells",price:1.74},{name:"Cookie Heart",price:1.75},
  {name:"Big Year",price:1.78},{name:"Party Sparkler",price:1.8},{name:"Winter Wreath",price:1.79},{name:"Swag Bag",price:1.91},
  {name:"Tama Gadget",price:1.93},{name:"Ginger Cookie",price:1.95},{name:"Moon Pendant",price:1.96},{name:"Jack-in-the-Box",price:2.01},
  {name:"Spiced Wine",price:2.12},{name:"Stellar Rocket",price:2.19},{name:"Star Notepad",price:2.32},{name:"Easter Egg",price:2.46},
  {name:"Restless Jar",price:2.5},{name:"Santa Hat",price:2.6},{name:"Snow Globe",price:2.65},{name:"Hex Pot",price:2.7},
  {name:"Joyful Bundle",price:2.71},{name:"Lush Bouquet",price:2.84},{name:"Witch Hat",price:2.86},{name:"Light Sword",price:3.13},
  {name:"Spy Agaric",price:3.2},{name:"Bow Tie",price:3.22},{name:"Eternal Candle",price:3.38},{name:"Bunny Muffin",price:3.34},
  {name:"Jelly Bunny",price:3.43},{name:"Berry Box",price:3.58},{name:"Evil Eye",price:3.6},{name:"Snow Mittens",price:3.67},
  {name:"Valentine Box",price:4.2},{name:"Snoop Cigar",price:4.26},{name:"Sakura Flower",price:4.77},{name:"Hanging Star",price:5.26},
  {name:"Jolly Chimp",price:5.34},{name:"Sleigh Bell",price:7.63},{name:"Skull Flower",price:7.7},{name:"Crystal Ball",price:7.86},
  {name:"Record Player",price:7.91},{name:"Love Candle",price:7.94},{name:"Top Hat",price:7.99},{name:"Trapped Heart",price:8.69},
  {name:"Love Potion",price:8.79},{name:"Flying Broom",price:9.45},{name:"Cupid Charm",price:11.26},{name:"Eternal Rose",price:13.71},
  {name:"Ionic Dryer",price:14.21},{name:"Diamond Ring",price:16.39},{name:"Voodoo Doll",price:16.43},{name:"Mad Pumpkin",price:17.91},
  {name:"Toy Bear",price:19.3},{name:"Vintage Cigar",price:23.98},{name:"Low Rider",price:24.8},{name:"Signet Ring",price:25.1},
  {name:"Neko Helmet",price:26.41},{name:"Electric Skull",price:31},{name:"Kissed Frog",price:34},{name:"Swiss Watch",price:35},
  {name:"Sharp Tongue",price:39.69},{name:"Scared Cat",price:43.6},{name:"Genie Lamp",price:47.07},{name:"Westside Sign",price:51.27},
  {name:"Bonded Ring",price:54.99},{name:"Gem Signet",price:72.98},{name:"Magic Potion",price:72.98},{name:"Ion Gem",price:83},
  {name:"Astral Shard",price:95.97},{name:"Perfume Bottle",price:95.99},{name:"Loot Bag",price:90.1},{name:"Mini Oscar",price:123.89},
  {name:"Nail Bracelet",price:129.84},{name:"Heroic Helmet",price:219.99},{name:"Precious Peach",price:379.99},
  {name:"Durov‚Äôs Cap",price:794.9},{name:"Heart Locket",price:1450},{name:"Plush Pepe",price:5199}
];
let inventory=[];

// === –®–∞—Ö—Ç–∞ ===
let cooldowns={};
function generateMineGrid(){
  let grid=document.getElementById('mineGrid');grid.innerHTML='';
  for(let i=0;i<16;i++){let block=document.createElement('div');
    block.className='block';block.dataset.hp=3;
    let price=(Math.random()*5.5+1).toFixed(2);block.dataset.price=price;
    block.innerHTML=`<div class="block-price">${price} TON</div>`;
    block.onclick=()=>hitBlock(block,i);grid.appendChild(block);}
}
function hitBlock(block,index){
  if(block.classList.contains('cooldown'))return;
  let hp=+block.dataset.hp;hp--;block.dataset.hp=hp;
  if(hp<=0){let cost=parseFloat(block.dataset.price);if(balance<cost)return;
    balance-=cost;updateBalance();
    let reward=rollGift(cost,index);if(reward)flyGift(reward,block);
    let cd=Date.now()+1000*60*(1+Math.random()*29);
    cooldowns[index]=cd;setCooldown(block,index,cd);}
}
function setCooldown(block,index,until){
  block.classList.add('cooldown');
  let timer=document.createElement('div');timer.className='cooldown-timer';block.appendChild(timer);
  let int=setInterval(()=>{
    let left=until-Date.now();if(left<=0){clearInterval(int);cooldownExpired(block,index);return;}
    let m=Math.floor(left/60000),s=Math.floor((left%60000)/1000);
    timer.textContent=`${m}:${s.toString().padStart(2,'0')}`;
  },1000);
}
function cooldownExpired(block,index){
  block.classList.remove('cooldown');block.innerHTML='';
  let p=(Math.random()*5.5+1).toFixed(2);block.dataset.price=p;block.dataset.hp=3;
  block.innerHTML=`<div class="block-price">${p} TON</div>`;
}
function rollGift(cost,index){
  let expected=cost*0.95;
  let pool=gifts.filter(g=>g.price<=expected*2);
  if(index===0 && pool.length){return pool[Math.floor(Math.random()*pool.length)];}
  if(Math.random()<0.7&&pool.length)return pool[Math.floor(Math.random()*pool.length)];
  if(Math.random()<0.1)return gifts[gifts.length-1];
  return null;
}
function flyGift(gift,fromBlock){
  let rect=fromBlock.getBoundingClientRect();
  let clone=document.createElement('div');clone.className='flying';
  clone.style.left=rect.left+'px';clone.style.top=rect.top+'px';
  document.body.appendChild(clone);
  lottie.loadAnimation({container:clone,renderer:'svg',loop:false,autoplay:true,path:`animations/${gift.name}.json`});
  let target=document.getElementById('tab-inventory').getBoundingClientRect();
  clone.animate([{transform:`translate(0,0)`},{transform:`translate(${target.left-rect.left}px,${target.top-rect.top}px)`}],
    {duration:1000,easing:'ease-in-out'}).onfinish=()=>{clone.remove();addToInventory(gift);};
}

// === –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å ===
function addToInventory(gift){inventory.push(gift);renderInventory();}
function renderInventory(){let list=document.getElementById('inventoryList');list.innerHTML='';
  inventory.forEach((g,i)=>{let div=document.createElement('div');div.className='gift-item';
    div.innerHTML=`<div class="gift-img" id="gift-${i}"></div><span>${g.name} (${g.price} TON)</span>
    <div class="gift-buttons"><button onclick="sellGift(${i})">–ü—Ä–æ–¥–∞—Ç—å</button><button onclick="withdrawGift(${i})">–í—ã–≤–µ—Å—Ç–∏</button></div>`;
    list.appendChild(div);
    lottie.loadAnimation({container:document.getElementById('gift-'+i),renderer:'svg',loop:false,autoplay:false,path:`animations/${g.name}.json`});
  });}
function sellGift(i){balance+=inventory[i].price;inventory.splice(i,1);updateBalance();renderInventory();}
function withdrawGift(i){alert("–í—ã–≤–æ–¥ –ø–æ–∑–∂–µ");}

// === –ú–∏–Ω—ã ===
let currentReward=0,rewardTaken=false;
function startMines(){let stake=parseFloat(document.getElementById('tonStake').value||0);
  if(stake<=0||stake>balance)return alert("–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Ç–∞–≤–∫–∞");
  balance-=stake;updateBalance();currentReward=(stake*1.5).toFixed(2);rewardTaken=false;
  document.getElementById('mineReward').textContent=`–í—ã–∏–≥—Ä—ã—à: ${currentReward} TON`; }
function collectReward(){if(rewardTaken||currentReward<=0)return;rewardTaken=true;
  if(currentReward>=1.5){let g=gifts[Math.floor(Math.random()*gifts.length)];addToInventory(g);}
  else{balance+=parseFloat(currentReward);updateBalance();}
  document.getElementById('mineReward').textContent="–í—ã–∏–≥—Ä—ã—à: ‚Äì";currentReward=0;}

// === –ó–∞–≥—Ä—É–∑—á–∏–∫ ===
function preloadAssets(){return new Promise(res=>{let bg=Object.values(backgrounds).map(src=>new Promise(r=>{let i=new Image();i.onload=r;i.onerror=r;i.src=src;}));
  Promise.all(bg).then(res);});}
window.onload=()=>{lottie.loadAnimation({container:document.getElementById('loaderAnimation'),
  renderer:'svg',loop:true,autoplay:true,path:'animations/myLoader.json'});
  let start=Date.now();preloadAssets().then(()=>{let d=Math.max(2000-(Date.now()-start),0);
    setTimeout(()=>{document.getElementById('loader').classList.add('hidden');
      document.body.style.opacity='1';updateBalance();generateMineGrid();showTab('menu');},d);});};
</script>
</body>
</html>
