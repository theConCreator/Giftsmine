<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GiftsMine üéÅ</title>
  <style>
    @font-face {
      font-family: 'Minecraft';
      src: url('minecraft.ttf') format('truetype');
    }
    body, html {
      margin:0; padding:0; height:100%;
      font-family:'Minecraft',sans-serif;
      color:#fff; overflow:hidden;
      display:flex; flex-direction:column;
      background:#000; background-size:cover; background-position:center;
      transition: background 0.5s;
    }
    #balance {
      padding:15px; text-align:right;
      font-size:1.2em; font-weight:bold;
      background:rgba(0,0,0,0.15);
      backdrop-filter:blur(5px);
      box-shadow:0 2px 8px rgba(0,0,0,0.3);
    }
    main { flex:1; overflow-y:auto; padding:10px; padding-bottom:70px;
      display:none; background: rgba(0,0,0,0.2);}
    main.active{display:block;}
    h2{text-align:center;margin-top:0;}
    .tab-bar {
      position: fixed; bottom: 0; left: 0; right: 0;
      display: flex; justify-content: space-between;
      background: rgba(0,0,0,0.2); padding: 10px 8px;
      border-top: 2px solid #fff; z-index: 1000;
    }
    .tab-bar button {
      flex: 1; margin: 0 4px; padding: 10px;
      font-size: 1em; border-radius: 10px;
      transition: 0.25s; font-weight:bold;
      border:none; cursor:pointer;
      background: linear-gradient(135deg,#ff9a9e,#fad0c4); color:#fff;
    }
    .tab-bar button.active {
      background: linear-gradient(135deg,#a1c4fd,#c2e9fb);
    }
    .grid { display:grid; gap:5px; justify-content:center; }
    #mineGrid { grid-template-columns: repeat(4, minmax(70px,1fr)); }
    .block {
      aspect-ratio:1/1; background:#333;
      display:flex; align-items:center; justify-content:center;
      cursor:pointer; position:relative; overflow:hidden;
      background-size:cover; background-position:center;
      border-radius:8px;
    }
    .block-price {
      position:absolute; bottom:2px; right:2px;
      background:rgba(0,0,0,0.6); padding:1px 3px;
      font-size:0.65em; border-radius:3px;
      display:flex; align-items:center; gap:2px;
    }
    .block.cooldown { filter:brightness(0.5); cursor:not-allowed; }
    .inventory-list { display:flex; flex-direction:column; gap:12px; }
    .gift-item {
      display:flex; flex-direction:column;
      background: rgba(20,20,20,0.95);
      border-radius:10px; padding:10px;
      box-shadow:0 4px 12px rgba(0,0,0,0.5); color:#fff;
    }
    .gift-top { display:flex; gap:10px; align-items:center; margin-bottom:8px; }
    .gift-preview {
      width:60px; height:60px; flex-shrink:0;
      border-radius:6px; overflow:hidden; background:#111;
    }
    .gift-info { display:flex; flex-direction:column; justify-content:center; gap:4px; flex-grow:1; }
    .gift-name { font-size:1em; font-weight:bold; }
    .gift-price { font-size:0.9em; color:#ccc; }
    .gift-actions { display:flex; gap:10px; margin-top:6px; }
    .gift-actions button {
      flex:1; padding:6px; border:none; border-radius:6px;
      font-size:0.85em; cursor:pointer; color:#fff;
      background: linear-gradient(135deg,#ff9a9e,#fad0c4);
      transition:0.3s;
    }
    .flying { position:absolute; width:60px; height:60px; pointer-events:none; z-index:10000; }
    #loader {
      position:fixed; top:0; left:0; width:100%; height:100%;
      display:flex; align-items:center; justify-content:center;
      flex-direction:column; z-index:9999; background:#000;
      transition:opacity 0.6s ease;
    }
    #loader.hidden { opacity:0; pointer-events:none; }
    #loaderAnimation { width:200px; height:200px; margin-bottom:20px; }
    #loaderProgress {
      width:40%; height:14px; background:#444;
      border-radius:10px; margin-top:10px; overflow:hidden;
    }
    #loaderProgressBar {
      width:0%; height:100%; background:#ff9a9e; transition:0.3s;
    }
    input[type="text"] {
      padding:8px; border-radius:8px; border:none;
      background:rgba(255,255,255,0.1); color:#fff; font-weight:bold;
    }
    .deposit-option {
      display:flex; align-items:center; justify-content:space-between;
      padding:10px; background:rgba(255,255,255,0.08);
      border-radius:10px; margin-bottom:8px; cursor:pointer;
      transition:0.3s;
    }
    .deposit-option:hover { background:rgba(255,255,255,0.15); }
    .deposit-left { display:flex; align-items:center; gap:8px; }
    .deposit-left img { width:24px; height:24px; }
    .deposit-percent { text-align:right; font-size:0.8em; color:#bbb; }
    .balance-buttons button {
      background:linear-gradient(135deg,#6a11cb,#2575fc);
      color:#fff; font-weight:bold; border-radius:8px;
      width:100%; padding:12px; margin-bottom:8px;
      transition:0.3s; border:none; cursor:pointer;
    }
    canvas.pixelated { image-rendering: pixelated; width:100%; height:100%; }
    @media (max-width:500px){
      .tab-bar button{font-size:0.85em;padding:8px;}
      #balance{font-size:1em;padding:10px;}
      #mineGrid{gap:3px;}
    }
  </style>
</head>
<body>
<div id="loader">
  <div id="loaderAnimation"></div>
  <div id="loaderProgress"><div id="loaderProgressBar"></div></div>
  <p style="color:#fff;font-size:1.1em;margin-top:8px">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤...</p>
</div>

<div id="balance">–ë–∞–ª–∞–Ω—Å: 0 <img src="ton.svg" style="width:16px;vertical-align:middle"></div>

<main id="menu" class="active">
  <h2>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h2>
  <p style="text-align:center;color:#bbb">–í—ã–±–∏—Ä–∞–π —Ä–µ–∂–∏–º –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –ø–æ–¥–∞—Ä–∫–∏!</p>
</main>

<main id="mine">
  <h2>–®–∞—Ö—Ç–∞ ‚õèÔ∏è</h2>
  <div id="brokenBlocks" style="text-align:center;margin-bottom:12px">–°–ª–æ–º–∞–Ω–æ –±–ª–æ–∫–æ–≤: 0</div>
  <div class="grid" id="mineGrid"></div>
</main>

<main id="inventory">
  <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å üéí</h2>
  <div class="inventory-list" id="inventoryList"></div>
</main>

<main id="balanceTab">
  <h2>–ë–∞–ª–∞–Ω—Å üí∞</h2>

  <div>
    <h3>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
    <div class="deposit-option" onclick="addBalance('TON')">
      <div class="deposit-left"><img src="ton.svg"> TON –∫–æ—à–µ–ª—ë–∫</div>
      <div class="deposit-percent"><div>–∫–æ–º–∏—Å—Å–∏—è</div><strong>0%</strong></div>
    </div>
    <div class="deposit-option" onclick="addBalance('CryptoBot')">
      <div class="deposit-left"><img src="icons/cryptobot.svg"> Crypto Bot</div>
      <div class="deposit-percent"><div>–∫–æ–º–∏—Å—Å–∏—è</div><strong>5%</strong></div>
    </div>
    <div class="deposit-option" onclick="addBalance('Stars')">
      <div class="deposit-left"><img src="icons/stars.svg"> Telegram Stars</div>
      <div class="deposit-percent"><div>–∫–æ–º–∏—Å—Å–∏—è</div><strong>20%</strong></div>
    </div>
  </div>

  <div style="margin:15px 0;">
    <h3>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h3>
    <p style="color:#ccc;font-size:0.9em;">
      +0.5% —Å –¥–µ–ø–æ–∑–∏—Ç–æ–≤ –¥—Ä—É–∑–µ–π –∑–∞ –∫–∞–∂–¥—ã–π —Å–ª–æ–º–∞–Ω–Ω—ã–π –±–ª–æ–∫.<br>
      –¢–µ–∫—É—â–∏–π –±–æ–Ω—É—Å: <span id="refPercent">1%</span> (–º–∞–∫—Å 20%).
    </p>
  </div>

  <div style="margin:15px 0;">
    <h3>–ü—Ä–æ–º–æ–∫–æ–¥</h3>
    <input type="text" id="promoCode" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥">
    <button onclick="redeemPromo()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
  </div>

  <div>
    <h3>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
    <div id="transactionHistory" style="font-size:0.9em;color:#ddd;"></div>
  </div>
</main>

<div class="tab-bar">
  <button onclick="showTab('menu')" id="tab-menu" class="active">–ú–µ–Ω—é</button>
  <button onclick="showTab('mine')" id="tab-mine">–®–∞—Ö—Ç–∞</button>
  <button onclick="showTab('inventory')" id="tab-inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
  <button onclick="showTab('balanceTab')" id="tab-balanceTab">–ë–∞–ª–∞–Ω—Å</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>
<script>
let balance=0,transactions=[],inventory=[],brokenBlocks=0,refPercent=1;
const animationMap={};

const backgrounds={menu:'images/menu.jpg',mine:'images/mine.jpg',inventory:'images/inventory.jpg',balanceTab:'images/mobs.jpg'};
document.body.style.backgroundImage=`url(${backgrounds.menu})`;

const oreTypes=[
  {img:"images/ores/coal.png",hits:3},
  {img:"images/ores/iron.png",hits:4},
  {img:"images/ores/gold.png",hits:5},
  {img:"images/ores/diamond.png",hits:6},
  {img:"images/ores/emerald.png",hits:7}
];

const gifts = [
      {name:"Hypno Lollipop",price:1.77}, {name:"Desk Calendar",price:1.31},
      {name:"B-Day Candle",price:1.32}, {name:"Lol Pop",price:1.32},
      {name:"Lunar Snake",price:1.38}, {name:"Snake Box",price:1.36},
      {name:"Xmas Stocking",price:1.38}, {name:"Whip Cupcake",price:1.38},
      {name:"Candy Cane",price:1.48}, {name:"Pet Snake",price:1.58},
      {name:"Jester Hat",price:1.62}, {name:"Snoop Dogg",price:1.64},
      {name:"Homemade Cake",price:1.7}, {name:"Holiday Drink",price:1.7},
      {name:"Jingle Bells",price:1.74}, {name:"Cookie Heart",price:1.75},
      {name:"Big Year",price:1.78}, {name:"Party Sparkler",price:1.8},
      {name:"Winter Wreath",price:1.79}, {name:"Swag Bag",price:1.91},
      {name:"Tama Gadget",price:1.93}, {name:"Ginger Cookie",price:1.95},
      {name:"Moon Pendant",price:1.96}, {name:"Jack-in-the-Box",price:2.01},
      {name:"Spiced Wine",price:2.12}, {name:"Stellar Rocket",price:2.19},
      {name:"Star Notepad",price:2.32}, {name:"Easter Egg",price:2.46},
      {name:"Restless Jar",price:2.5}, {name:"Santa Hat",price:2.6},
      {name:"Snow Globe",price:2.65}, {name:"Hex Pot",price:2.7},
      {name:"Joyful Bundle",price:2.71}, {name:"Lush Bouquet",price:2.84},
      {name:"Witch Hat",price:2.86}, {name:"Light Sword",price:3.13},
      {name:"Spy Agaric",price:3.2}, {name:"Bow Tie",price:3.22},
      {name:"Eternal Candle",price:3.38}, {name:"Bunny Muffin",price:3.34},
      {name:"Jelly Bunny",price:3.43}, {name:"Berry Box",price:3.58},
      {name:"Evil Eye",price:3.6}, {name:"Snow Mittens",price:3.67},
      {name:"Valentine Box",price:4.2}, {name:"Snoop Cigar",price:4.26},
      {name:"Sakura Flower",price:4.77}, {name:"Hanging Star",price:5.26},
      {name:"Jolly Chimp",price:5.34}, {name:"Sleigh Bell",price:7.63},
      {name:"Skull Flower",price:7.7}, {name:"Crystal Ball",price:7.86},
      {name:"Record Player",price:7.91}, {name:"Love Candle",price:7.94},
      {name:"Top Hat",price:7.99}, {name:"Trapped Heart",price:8.69},
      {name:"Love Potion",price:8.79}, {name:"Flying Broom",price:9.45},
      {name:"Cupid Charm",price:11.26}, {name:"Eternal Rose",price:13.71},
      {name:"Ionic Dryer",price:14.21}, {name:"Diamond Ring",price:16.39},
      {name:"Voodoo Doll",price:16.43}, {name:"Mad Pumpkin",price:17.91},
      {name:"Toy Bear",price:19.3}, {name:"Vintage Cigar",price:23.98},
      {name:"Low Rider",price:24.8}, {name:"Signet Ring",price:25.1},
      {name:"Neko Helmet",price:26.41}, {name:"Electric Skull",price:31},
      {name:"Kissed Frog",price:34}, {name:"Swiss Watch",price:35},
      {name:"Sharp Tongue",price:39.69}, {name:"Scared Cat",price:43.6},
      {name:"Genie Lamp",price:47.07}, {name:"Westside Sign",price:51.27},
      {name:"Bonded Ring",price:54.99}, {name:"Gem Signet",price:72.98},
      {name:"Magic Potion",price:72.98}, {name:"Ion Gem",price:83},
      {name:"Astral Shard",price:95.97}, {name:"Perfume Bottle",price:95.99},
      {name:"Loot Bag",price:90.1}, {name:"Mini Oscar",price:123.89},
      {name:"Nail Bracelet",price:129.84}, {name:"Heroic Helmet",price:219.99},
      {name:"Precious Peach",price:379.99}, {name:"Durov‚Äôs Cap",price:794.9},
      {name:"Heart Locket",price:1450}, {name:"Plush Pepe",price:5199}
    ];

function updateBalance(){
  document.getElementById('balance').innerHTML=`–ë–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} <img src="ton.svg" style="width:16px;vertical-align:middle">`;
}
function updateTransactionHistory(){
  const el=document.getElementById('transactionHistory');
  el.innerHTML='';
  transactions.forEach(t=>{
    const div=document.createElement('div');
    div.style.padding="4px 0";
    div.textContent=t;
    el.appendChild(div);
  });
}
function updateBrokenBlocks(){
  document.getElementById('brokenBlocks').textContent=`–°–ª–æ–º–∞–Ω–æ –±–ª–æ–∫–æ–≤: ${brokenBlocks}`;
  updateRefBonus();
}
function updateRefBonus(){
  document.getElementById('refPercent').textContent=refPercent.toFixed(1)+"%";
}

function showTab(id){
  document.querySelectorAll('main').forEach(m=>m.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.tab-bar button').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+id).classList.add('active');
  document.body.style.backgroundImage=`url(${backgrounds[id]})`;
  if(id==='inventory') renderInventory();
}

function spawnBlock(cell,index){
  const ore=oreTypes[Math.floor(Math.random()*oreTypes.length)];
  const price=+(1+Math.random()*10).toFixed(2);
  cell.className="block";
  cell.style.backgroundImage=`url(${ore.img})`;
  cell.innerHTML=`<div class="block-price">${price}<img src="ton.svg" style="width:12px;vertical-align:middle"></div>`;
  let hits=0;
  const destroyStages=[0,9]; // default
  if(ore.hits>1){
    destroyStages.length=0;
    for(let i=0;i<ore.hits;i++){
      destroyStages.push(Math.round(i*(9/(ore.hits-1))));
    }
  }
  const canvas=document.createElement('canvas');
  canvas.width=64; canvas.height=64; canvas.className="pixelated";
  cell.appendChild(canvas);
  const ctx=canvas.getContext('2d');

  cell.onclick=()=>{
    if(cell.classList.contains("cooldown")) return;
    hits++;
    const stage=destroyStages[Math.min(hits-1,destroyStages.length-1)];
    const img=new Image();
    img.onload=()=>{ctx.clearRect(0,0,64,64); ctx.drawImage(img,0,0,64,64);}
    img.src=`destroy/destroy_stage_${stage}.png`;

    if(hits>=ore.hits){
      brokenBlocks++; updateBrokenBlocks();
      if(balance>=price){ balance-=price; }
      let gift=gifts[Math.floor(Math.random()*gifts.length)];
      inventory.push(gift); renderInventory();
      flyGift(gift,cell);
      transactions.unshift(`–õ–æ–º–∞–Ω–∏–µ –±–ª–æ–∫–∞ -${price} TON`);
      updateBalance(); updateTransactionHistory();
      let respawn=(60+Math.random()*300)*1000;
      cell.classList.add("cooldown");
      cell.innerHTML=`<div style="position:absolute;top:2px;left:2px;font-size:0.7em;">${Math.round(respawn/60000)}m</div>`;
      setTimeout(()=>{ cell.classList.remove("cooldown"); spawnBlock(cell,index); },respawn);
    }
  }
}

function generateMineGrid(){
  const grid=document.getElementById('mineGrid');
  grid.innerHTML='';
  for(let i=0;i<16;i++){
    let cell=document.createElement('div');
    spawnBlock(cell,i);
    grid.appendChild(cell);
  }
}

function flyGift(gift,fromCell){
  const rect=fromCell.getBoundingClientRect();
  const fly=document.createElement('div');
  fly.className='flying';
  fly.style.left=rect.left+rect.width/2-30+'px';
  fly.style.top=rect.top+rect.height/2-30+'px';
  document.body.appendChild(fly);
  lottie.loadAnimation({container:fly,renderer:'svg',loop:true,autoplay:true,path:`emoji/${gift.name}.json`});
  const invBtn=document.getElementById('tab-inventory').getBoundingClientRect();
  const targetX=invBtn.left+invBtn.width/2-30;
  const targetY=invBtn.top+invBtn.height/2-30;
  fly.animate([{transform:'translate(0,0)'},{transform:`translate(${targetX-(rect.left+rect.width/2-30)}px,${targetY-(rect.top+rect.height/2-30)}px)`}],{duration:1500,easing:'ease-in-out'});
  setTimeout(()=>fly.remove(),1500);
}

function renderInventory(){
  const list=document.getElementById('inventoryList');
  list.innerHTML='';
  inventory.forEach((gift,idx)=>{
    const div=document.createElement('div'); div.className='gift-item';
    const top=document.createElement('div'); top.className='gift-top';
    const prev=document.createElement('div'); prev.className='gift-preview';
    prev.textContent=gift.name;
    const info=document.createElement('div'); info.className='gift-info';
    info.innerHTML=`<div class="gift-name">${gift.name}</div><div class="gift-price">–¶–µ–Ω–∞: ${gift.price.toFixed(2)} TON</div>`;
    top.appendChild(prev); top.appendChild(info);
    const actions=document.createElement('div'); actions.className='gift-actions';
    const sell=document.createElement('button'); sell.textContent='–ü—Ä–æ–¥–∞—Ç—å';
    sell.onclick=()=>{balance+=gift.price;updateBalance();inventory.splice(idx,1);renderInventory();transactions.unshift(`–ü—Ä–æ–¥–∞–∂–∞: ${gift.name} +${gift.price} TON`);updateTransactionHistory();}
    const withdraw=document.createElement('button'); withdraw.textContent='–í—ã–≤–µ—Å—Ç–∏';
    withdraw.onclick=()=>{alert('–í—ã–≤–æ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω!');inventory.splice(idx,1);renderInventory();transactions.unshift(`–í—ã–≤–æ–¥: ${gift.name}`);updateTransactionHistory();}
    actions.appendChild(sell);actions.appendChild(withdraw);
    div.appendChild(top);div.appendChild(actions);list.appendChild(div);
  });
}

function redeemPromo(){
  const code=document.getElementById('promoCode').value.trim();
  if(code==='BONUS10'){
    balance+=10; updateBalance();
    transactions.unshift("–ü—Ä–æ–º–æ–∫–æ–¥ BONUS10 +10 TON"); updateTransactionHistory();
    alert("–ü—Ä–æ–º–æ–∫–æ–¥ —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!");
  } else alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥");
}

function addBalance(method){
  let sum=+prompt("–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:");
  if(!sum||sum<=0)return;
  let com=0;
  if(method==='CryptoBot') sum*=0.95;
  if(method==='Stars') sum*=0.8;
  const bonus=(sum*refPercent/100);
  balance+=sum+bonus;
  transactions.unshift(`–î–µ–ø–æ–∑–∏—Ç —á–µ—Ä–µ–∑ ${method} +${sum.toFixed(2)} TON (–±–æ–Ω—É—Å ${bonus.toFixed(2)})`);
  updateBalance(); updateTransactionHistory();
}

window.addEventListener("load",()=>{ preloadResources(); });

function preloadResources(){
  const imagePaths=[...oreTypes.map(o=>o.img)];
  for(let i=0;i<10;i++) imagePaths.push(`destroy/destroy_stage_${i}.png`);
  const lottiePaths=gifts.map(g=>`emoji/${g.name}.json`);
  const total=imagePaths.length+lottiePaths.length; let loaded=0;
  const progBar=document.getElementById("loaderProgressBar");
  function tick(){ loaded++; if(progBar) progBar.style.width=(loaded/total*100)+"%";
    if(loaded>=total){ setTimeout(()=>{document.getElementById("loader").classList.add("hidden");generateMineGrid();updateBalance();updateRefBonus();updateBrokenBlocks();},300);}}
  imagePaths.forEach(src=>{const img=new Image();img.onload=tick;img.onerror=tick;img.src=src;});
  lottiePaths.forEach(path=>{fetch(path).then(r=>r.ok?r.json():null).then(json=>{if(json){const name=path.split("/").pop().replace(".json","");animationMap[name]=path;}tick();}).catch(()=>tick());});
}
</script>
</body>
</html>
