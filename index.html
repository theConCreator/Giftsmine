<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GiftsMine üéÅ</title>
<style>
@font-face {
    font-family: 'Minecraft';
    src: url('minecraft.ttf') format('truetype');
}
body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Minecraft', sans-serif;
    color: #fff; overflow: hidden;
    display: flex; flex-direction: column;
    background: #000; background-size: cover; background-position: center;
    transition: background 0.5s;
}
/* –ë–∞–ª–∞–Ω—Å */
#balance {
    padding: 15px; text-align: right; font-size: 1.2em; font-weight: bold;
    background: rgba(0,0,0,0.15); backdrop-filter: blur(5px); box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
/* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
main {
    flex: 1; overflow-y: auto; padding: 10px; margin-bottom: 60px;
    display: none; background: rgba(0,0,0,0.2);
}
main.active { display: block; }
/* –í–∫–ª–∞–¥–∫–∏ */
.tab-bar {
    position: fixed; bottom: 0; width: 100%; display: flex; justify-content: space-around;
    background: rgba(0,0,0,0.2); padding: 10px; border-top: 2px solid #fff; z-index: 1000;
}
.tab-bar button {
    flex: 1; margin: 0 5px; padding: 10px; border: none;
    background: linear-gradient(135deg,#ff9a9e,#fad0c4); color: #fff;
    font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1em;
}
.tab-bar button.active {
    background: linear-gradient(135deg,#a1c4fd,#c2e9fb);
}
/* –°–µ—Ç–∫–∏ */
.grid { display: grid; gap: 5px; justify-content: center; }
.mines-grid { grid-template-columns: repeat(5, minmax(50px,1fr)); }
#mineGrid { grid-template-columns: repeat(4, minmax(60px,1fr)); }
/* –ë–ª–æ–∫ —à–∞—Ö—Ç—ã */
.mine-cell, .block {
    aspect-ratio: 1/1; background: #333;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: 0.2s; position: relative; overflow: hidden;
    background-size: cover; background-position: center; border-radius: 6px;
}
.mine-cell.disabled { pointer-events: none; opacity: 0.6; }
.mine-cell.revealed.safe { background: #4caf50; }
.mine-cell.revealed.mine { background: #f44336; }
.block-price {
    position: absolute; bottom: 2px; right: 2px;
    background: rgba(0,0,0,0.5); padding: 2px 4px; font-size: 0.7em;
    border-radius: 2px; display: flex; align-items: center; gap: 2px;
}
.block.cooldown { filter: brightness(0.5); cursor: not-allowed; }
/* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
.inventory-list { display: flex; flex-wrap: wrap; gap: 10px; }
.gift-item {
    background: #222; padding: 10px; box-shadow: 0 6px 16px rgba(0,0,0,0.5);
    font-size: 0.9em; flex: 1 1 45%; display: flex; align-items: center; gap: 10px;
    transition: 0.3s; position: relative; color: #fff;
}
.gift-preview { width: 50px; height: 50px; }
.gift-actions { display: flex; flex-direction: column; gap: 4px; }
.gift-actions button {
    padding: 4px 6px; font-size: 0.75em; cursor: pointer; border: none; border-radius: 4px;
    background: linear-gradient(135deg,#ff9a9e,#fad0c4); color: #fff;
}
/* –°—Ç–∞–≤–∫–∏ –º–∏–Ω—ã */
.stake-options { margin-bottom: 10px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
#mineReward {
    border: 2px dashed #aaa; padding: 10px; margin-left: 10px;
    border-radius: 10px; min-width: 150px; text-align: center; font-weight: bold;
    position: relative; color: #fff;
}
button#collectReward {
    padding: 10px; background: linear-gradient(135deg,#ff9a9e,#fad0c4);
    border: none; color: #fff; font-weight: bold; cursor: pointer; border-radius: 8px;
    margin-left: 10px; transition: 0.3s;
}
button#collectReward:hover { background: linear-gradient(135deg,#a1c4fd,#c2e9fb); }
/* –õ–æ–∞–¥–µ—Ä */
#loader {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    display: flex; align-items: center; justify-content: center; flex-direction: column;
    z-index: 9999; background: #000; transition: opacity 0.6s ease;
}
#loader.hidden { opacity: 0; pointer-events: none; }
#loaderAnimation { width: 150px; height: 150px; margin-bottom: 20px; }
#loaderProgress {
    width: 60%; height: 20px; background: #444; border-radius: 10px; overflow: hidden; margin-top: 10px;
}
#loaderProgressBar {
    width: 0%; height: 100%; background: #ff9a9e;
}
/* –õ–µ—Ç–∞—é—â–∏–π –ø–æ–¥–∞—Ä–æ–∫ */
.flying { position: absolute; width: 80px; height: 80px; pointer-events: none; z-index: 10000; }
/* –ú–æ–±—ã */
.mobs-grid { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-bottom: 15px; }
.mob-card { background: #222; padding: 10px; border-radius: 8px; flex: 1 1 100px; text-align: center; cursor: pointer; transition: 0.3s; }
.mob-card:hover { background: #444; }
#rouletteCanvas { background: #222; border-radius: 50%; display:block; margin: 0 auto; }
#spinButton { padding: 10px; margin-top: 10px; background: linear-gradient(135deg,#ff9a9e,#fad0c4); border: none; color: #fff; font-weight: bold; cursor: pointer; border-radius: 8px; }
@media (max-width:500px) {
    .tab-bar button { font-size: 0.85em; padding: 8px; }
    #balance { font-size: 1em; padding: 10px; }
    #mineGrid,.mines-grid{gap:3px;}
}
</style>
</head>
<body>

<div id="loader">
    <div id="loaderAnimation"></div>
    <div id="loaderProgress"><div id="loaderProgressBar"></div></div>
    <p style="color:#fff;font-size:1.2em;">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤...</p>
</div>

<div id="balance">–ë–∞–ª–∞–Ω—Å: 10000 <img src="ton.svg" style="width:16px;vertical-align:middle"></div>

<main id="menu" class="active">
<h2>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h2>
<p>–í—ã–±–∏—Ä–∞–π —Ä–µ–∂–∏–º –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –ø–æ–¥–∞—Ä–∫–∏!</p>
</main>

<main id="mines">
<h2>–ú–∏–Ω—ã üí£</h2>
<div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:10px;">
<div class="stake-options">
<label><input type="radio" name="stakeType" value="ton" checked onchange="updateStakeInput()"> TON</label>
<label><input type="radio" name="stakeType" value="gift" onchange="updateStakeInput()"> –ü–æ–¥–∞—Ä–æ–∫</label>
<input type="number" id="tonStake" min="0.5" step="0.1" placeholder="–°—Ç–∞–≤–∫–∞ TON">
<select id="giftStake" style="display:none"></select>
<button onclick="startMines()">–ò–≥—Ä–∞—Ç—å</button>
</div>
<div>
<div id="mineReward">–í—ã–∏–≥—Ä—ã—à: ‚Äì</div>
<button id="collectReward" onclick="collectReward()">–ó–∞–±—Ä–∞—Ç—å</button>
</div>
</div>
<div class="grid mines-grid" id="minesGrid"></div>
<p id="minesStatus"></p>
</main>

<main id="mine">
<h2>–®–∞—Ö—Ç–∞ ‚õèÔ∏è</h2>
<div class="grid" id="mineGrid"></div>
</main>

<main id="inventory">
<h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å üéí</h2>
<div class="inventory-list" id="inventoryList"></div>
</main>

<main id="mobs">
<h2>–ú–æ–±—ã üêæ</h2>
<div class="mobs-grid" id="mobsGrid"></div>
<canvas id="rouletteCanvas" width="400" height="400"></canvas>
<div style="text-align:center;">
    <button id="spinButton">–†–∞—Å–∫—Ä—É—Ç–∏—Ç—å</button>
</div>
</main>

<div class="tab-bar">
<button onclick="showTab('menu')" id="tab-menu" class="active">–ú–µ–Ω—é</button>
<button onclick="showTab('mines')" id="tab-mines">–ú–∏–Ω—ã</button>
<button onclick="showTab('mine')" id="tab-mine">–®–∞—Ö—Ç–∞</button>
<button onclick="showTab('inventory')" id="tab-inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
<button onclick="showTab('mobs')" id="tab-mobs">–ú–æ–±—ã</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>
<script>
// -------------------- –õ–æ–∞–¥–µ—Ä --------------------
let loaderAnim = lottie.loadAnimation({
    container: document.getElementById('loaderAnimation'),
    renderer: 'svg',
    loop: true,
    autoplay: true,
    path: 'animations/myLoader.json'
});

// -------------------- –ë–∞–ª–∞–Ω—Å --------------------
let balance = 10000;
function updateBalance(){
    document.getElementById('balance').innerHTML =
        `–ë–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} <img src="ton.svg" style="width:16px;vertical-align:middle">`;
}

// -------------------- –í–∫–ª–∞–¥–∫–∏ --------------------
const backgrounds = {
    menu: 'images/menu.jpg',
    mines: 'images/mines.jpg',
    mine: 'images/mine.jpg',
    inventory: 'images/inventory.jpg',
    mobs: 'images/mobs.jpg'
};
function showTab(id){
    document.querySelectorAll('main').forEach(m => m.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.tab-bar button').forEach(b => b.classList.remove('active'));
    document.getElementById('tab-'+id).classList.add('active');
    document.body.style.backgroundImage = `url(${backgrounds[id]})`;
    if(id==='inventory') renderInventory();
    if(id==='mobs') renderMobs();
}

// -------------------- –ü–æ–¥–∞—Ä–∫–∏ --------------------
const gifts=[ /* –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤ –∫–∞–∫ –≤ —Ç–≤–æ–µ–º –∫–æ–¥–µ –≤—ã—à–µ */ ];
let inventory = [];

// -------------------- –®–∞—Ö—Ç–∞ --------------------
const oreTypes=[
    {img:"images/ores/coal.png",hits:3},
    {img:"images/ores/iron.png",hits:4},
    {img:"images/ores/gold.png",hits:5},
    {img:"images/ores/diamond.png",hits:6},
    {img:"images/ores/emerald.png",hits:7}
];
function getGiftByPrice(price,isFirst=false){
    let min=price*0.5, max=price*1.45;
    let possible=gifts.filter(g=>g.price>=min && g.price<=max);
    if(isFirst){ possible=gifts.filter(g=>g.price>=price); if(possible.length===0) possible=gifts; }
    if(possible.length===0) possible=gifts;
    return possible[Math.floor(Math.random()*possible.length)];
}
function spawnBlock(cell,index=0){
    const ore = oreTypes[Math.floor(Math.random()*oreTypes.length)];
    let price = +(1+Math.random()*10).toFixed(2);
    cell.className="block";
    cell.style.backgroundImage=`url(${ore.img})`;
    cell.innerHTML=`<div class="block-price">${price}<img src="ton.svg" style="width:12px;vertical-align:middle"></div>`;
    let hits = 0;
    cell.onclick = () => {
        hits++;
        if(hits >= ore.hits){
            if(balance >= price){ balance -= price; updateBalance(); }
            let gift = getGiftByPrice(price,index===0);
            inventory.push(gift); renderInventory();
            flyGift(gift,cell);
            let respawn = (60+Math.random()*1740)*1000;
            cell.classList.add("cooldown");
            cell.innerHTML=`<div style="position:absolute;top:2px;left:2px;font-size:0.7em;">${Math.round(respawn/60000)}m</div>`;
            cell.onclick = null;
            setTimeout(()=>{cell.classList.remove("cooldown"); spawnBlock(cell,index);},respawn);
        }
    };
}
function generateMineGrid(){
    const grid=document.getElementById("mineGrid"); grid.innerHTML="";
    for(let i=0;i<16;i++){
        let cell=document.createElement("div"); spawnBlock(cell,i); grid.appendChild(cell);
    }
}

// -------------------- –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥–∞—Ä–∫–∞ --------------------
function flyGift(gift,fromCell){
    const rect = fromCell.getBoundingClientRect();
    const fly = document.createElement("div");
    fly.className="flying";
    fly.style.left=rect.left+"px"; fly.style.top=rect.top+"px";
    document.body.appendChild(fly);
    lottie.loadAnimation({container:fly,renderer:"svg",loop:false,autoplay:true,path:`emoji/${gift.name}.json`});
    const inv = document.getElementById("tab-inventory").getBoundingClientRect();
    fly.animate([{transform:`translate(0,0)`},{transform:`translate(${inv.left-rect.left}px,${inv.top-rect.top}px)`}],
        {duration:1000,easing:"ease-in-out"});
    setTimeout(()=>fly.remove(),1000);
}

// -------------------- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å --------------------
function renderInventory(){
    let list=document.getElementById("inventoryList"); list.innerHTML="";
    inventory.forEach((gift,idx)=>{
        let div=document.createElement("div"); div.className="gift-item";
        let prev=document.createElement("div"); prev.className="gift-preview";
        lottie.loadAnimation({container:prev,renderer:"svg",loop:false,autoplay:true,path:`emoji/${gift.name}.json`});
        let info=document.createElement("div");
        info.innerHTML=`${gift.name} ‚Äì ${gift.price} <img src="ton.svg" style="width:14px;vertical-align:middle">`;
        let actions=document.createElement("div"); actions.className="gift-actions";
        let sellBtn=document.createElement("button"); sellBtn.textContent="–ü—Ä–æ–¥–∞—Ç—å";
        sellBtn.onclick=()=>{ balance+=gift.price; updateBalance(); inventory.splice(idx,1); renderInventory(); };
        let withdrawBtn=document.createElement("button"); withdrawBtn.textContent="–í—ã–≤–µ—Å—Ç–∏";
        withdrawBtn.onclick=()=>{ alert("–í—ã–≤–æ–¥ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω"); };
        actions.appendChild(sellBtn); actions.appendChild(withdrawBtn);
        div.appendChild(prev); div.appendChild(info); div.appendChild(actions);
        list.appendChild(div);
    });
}

// -------------------- –ú–∏–Ω—ã --------------------
let minesActive=false, minesLost=false, mineMultiplier=1, currentStake=0;
function generateMines(){
    const grid=document.getElementById("minesGrid"); grid.innerHTML="";
    let mines=[]; while(mines.length<5){ let idx=Math.floor(Math.random()*25); if(!mines.includes(idx)) mines.push(idx); }
    for(let i=0;i<25;i++){
        let cell=document.createElement("div");
        cell.className="mine-cell disabled";
        cell.dataset.mine=mines.includes(i);
        cell.onclick=()=>clickMine(cell);
        grid.appendChild(cell);
    }
}
function clickMine(cell){
    if(!minesActive||cell.classList.contains("revealed")) return;
    cell.classList.add("revealed");
    if(cell.dataset.mine==="true"){
        cell.classList.add("mine"); document.getElementById("minesStatus").innerText="üí• –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!";
        minesLost=true; minesActive=false;
    } else {
        cell.classList.add("safe"); mineMultiplier+=0.5;
        document.getElementById("mineReward").innerText="–í—ã–∏–≥—Ä—ã—à: "+(currentStake*mineMultiplier).toFixed(2);
    }
}
function startMines(){
    const stakeType=document.querySelector('input[name="stakeType"]:checked').value;
    let stake=stakeType==="ton"?parseFloat(document.getElementById("tonStake").value):null;
    if(stakeType==="ton"&&!stake){ alert("–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É"); return; }
    if(stakeType==="ton"&&balance<stake){ alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤"); return; }
    if(stakeType==="ton"){ balance-=stake; updateBalance(); }
    currentStake=stake; mineMultiplier=1; minesLost=false; minesActive=true;
    generateMines(); document.querySelectorAll(".mine-cell").forEach(c=>c.classList.remove("disabled"));
    document.getElementById("mineReward").innerText="–í—ã–∏–≥—Ä—ã—à: ‚Äì"; document.getElementById("minesStatus").innerText="";
}
function collectReward(){
    if(!minesActive&&!minesLost&&currentStake>0){
        let win=currentStake*mineMultiplier;
        if(win>=1.5){ let gift=getGiftByPrice(win); inventory.push(gift); renderInventory(); alert("–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –ø–æ–¥–∞—Ä–æ–∫: "+gift.name); }
        else{ balance+=win; updateBalance(); alert("–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ "+win.toFixed(2)+" TON"); }
    }
    minesActive=false; currentStake=0; document.getElementById("mineReward").innerText="–í—ã–∏–≥—Ä—ã—à: ‚Äì";
}

// -------------------- –†—É–ª–µ—Ç–∫–∞ –ú–æ–±—ã --------------------
const mobsData=[
    {name:"–ó–æ–º–±–∏",price:1,lose:0.4,win:0.4,epicGift:"Restless Jar",color:"#0a7a0a"},
    {name:"–ü–∞—É–∫",price:2,lose:0.3,win:0.6,epicGift:"Witch Hat",color:"#0f9a0f"},
    {name:"–°–∫–µ–ª–µ—Ç",price:3,lose:0.9,win:0,epicGift:"Crystal Ball",color:"#aaaaaa"},
    {name:"–ö—Ä–∏–ø–µ—Ä",price:5,lose:0.7,win:0.25,epicGift:"Mad Pumpkin",color:"#7fff7f"}
];
let selectedMob=null, spinning=false;
const canvas=document.getElementById("rouletteCanvas");
const ctx=canvas.getContext("2d");
const center=canvas.width/2;
const radius=canvas.width/2-10;
function renderMobs(){
    const grid=document.getElementById("mobsGrid");
    if(grid.childElementCount>0) return;
    mobsData.forEach(mob=>{
        const div=document.createElement("div"); div.className="mob-card";
        div.innerHTML=`<img src="mobs/${mob.name}.png" style="width:80px"><br>${mob.name} (${mob.price} TON)`;
        div.onclick=()=>selectMob(mob);
        grid.appendChild(div);
    });
}
function selectMob(mob){
    selectedMob=mob;
    drawRoulette();
}
function drawRoulette(){
    if(!selectedMob) return;
    ctx.clearRect(0,0,canvas.width,canvas.height);
    let startAngle=0;
    const segments=[
        {label:"–ü—Ä–æ–∏–≥—Ä—ã—à",value:selectedMob.lose,color:"#f44336"},
        {label:"–í—ã–∏–≥—Ä—ã—à",value:selectedMob.win,color:selectedMob.color},
        {label:"–≠–ø–∏–∫",value:1-selectedMob.lose-selectedMob.win,color:"#c2ff00"}
    ];
    segments.forEach(seg=>{
        const endAngle=startAngle+seg.value*2*Math.PI;
        ctx.beginPath(); ctx.moveTo(center,center); ctx.arc(center,center,radius,startAngle,endAngle);
        ctx.fillStyle=seg.color; ctx.fill(); ctx.closePath();
        startAngle=endAngle;
    });
    const img=new Image(); img.src=`mobs/${selectedMob.name}.png`;
    img.onload=()=>{ctx.drawImage(img,center-40,center-40,80,80);};
}
function spinRoulette(){
    if(!selectedMob||spinning) return;
    spinning=true;
    const segments=[
        {label:"–ü—Ä–æ–∏–≥—Ä—ã—à",value:selectedMob.lose,color:"#f44336"},
        {label:"–í—ã–∏–≥—Ä—ã—à",value:selectedMob.win,color:selectedMob.color},
        {label:"–≠–ø–∏–∫",value:1-selectedMob.lose-selectedMob.win,color:"#c2ff00"}
    ];
    let rand=Math.random(), result;
    if(rand<segments[0].value) result=0;
    else if(rand<segments[0].value+segments[1].value) result=1;
    else result=2;
    let rotation=0, target=Math.random()*Math.PI*2+(5*Math.PI*2);
    const targetSegment=segments.slice(0,result).reduce((acc,s)=>acc+s.value*2*Math.PI,0)+segments[result].value*Math.PI;
    const finalRotation=target-targetSegment;
    const step=()=>{
        rotation+=(finalRotation-rotation)*0.1;
        ctx.save(); ctx.translate(center,center); ctx.rotate(rotation); ctx.translate(-center,-center); drawRoulette(); ctx.restore();
        if(Math.abs(finalRotation-rotation)<0.001){ finishSpin(result); spinning=false; }
        else requestAnimationFrame(step);
    };
    step();
}
function finishSpin(result){
    if(result===0){ alert("–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!"); }
    else if(result===1){ balance+=selectedMob.price; updateBalance(); alert("–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ —Å–≤–æ—é —Å—Ç–∞–≤–∫—É: "+selectedMob.price+" TON"); }
    else if(result===2){
        const gift=gifts.find(g=>g.name===selectedMob.epicGift);
        if(gift){ inventory.push(gift); renderInventory(); alert("–≠–ø–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–∑: "+gift.name); }
    }
}
document.getElementById("spinButton").onclick=spinRoulette;

// -------------------- –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ --------------------
function preloadImages(paths, onProgress){
    let loaded=0; return Promise.all(paths.map(src=>new Promise(res=>{
        const img=new Image(); img.onload=img.onerror=function(){ loaded++; onProgress(loaded/paths.length); res(); }; img.src=src;
    })));
}
function preloadAssets(){
    const imagePaths=[ ...Object.values(backgrounds),"ton.svg", ...oreTypes.map(o=>o.img), ...mobsData.map(m=>"mobs/"+m.name+".png")];
    preloadImages(imagePaths,p=>document.getElementById("loaderProgressBar").style.width=(p*100)+"%")
        .then(()=>{ document.getElementById("loader").classList.add("hidden"); generateMineGrid(); updateBalance(); });
}
preloadAssets();
</script>
</body>
</html>
