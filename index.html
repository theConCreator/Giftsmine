<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GiftsMine üéÅ</title>
<style>
@font-face { font-family: 'Minecraft'; src: url('minecraft.ttf'); }
body, html { margin:0; padding:0; height:100%; font-family:'Minecraft', sans-serif; color:#fff; overflow:hidden; display:flex; flex-direction:column; background:#000; background-size:cover; background-position:center; }
#balance{padding:15px;text-align:right;font-size:1.2em;font-weight:bold;background:rgba(0,0,0,0.15);backdrop-filter:blur(5px);box-shadow:0 2px 8px rgba(0,0,0,0.3);}
main{flex:1;overflow-y:auto;padding:10px;margin-bottom:60px;display:none;background: rgba(0,0,0,0.2);}
main.active{display:block;}
.tab-bar{position:fixed;bottom:0;width:100%;display:flex;justify-content:space-around;background:rgba(0,0,0,0.2);padding:10px;border-top:2px solid #fff;z-index:1000;}
.tab-bar button{flex:1;margin:0 5px;padding:10px;border:none;background:linear-gradient(135deg,#ff9a9e,#fad0c4);color:#fff;font-weight:bold;cursor:pointer;transition:0.3s;font-size:1em;}
.tab-bar button.active{background:linear-gradient(135deg,#a1c4fd,#c2e9fb);}
.grid{display:grid;gap:5px;justify-content:center;}
.mines-grid{grid-template-columns: repeat(5, minmax(50px,1fr));}
#mineGrid{grid-template-columns: repeat(4, minmax(60px,1fr));}
.mine-cell,.block{aspect-ratio:1/1;background:#333;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:0.2s;position: relative;overflow:hidden;background-size:cover;background-position:center;border-radius:6px;}
.mine-cell.disabled{pointer-events:none;opacity:0.6;}
.mine-cell.revealed.safe{background:#4caf50;}
.mine-cell.revealed.mine{background:#f44336;}
.block-price{position:absolute;bottom:2px;right:2px;background:rgba(0,0,0,0.5);padding:2px 4px;font-size:0.7em;border-radius:2px;display:flex;align-items:center;gap:2px;}
.block.cooldown{filter:brightness(0.5);cursor:not-allowed;}
.inventory-list{display:flex;flex-wrap:wrap;gap:10px;}
.gift-item{background:#222;padding:10px;box-shadow:0 6px 16px rgba(0,0,0,0.5);font-size:0.9em;flex:1 1 45%;display:flex;align-items:center;gap:10px;transition:0.3s;position:relative;color:#fff;}
.gift-preview{width:50px;height:50px;}
.gift-actions{display:flex;flex-direction:column;gap:4px;}
.gift-actions button{padding:4px 6px;font-size:0.75em;cursor:pointer;border:none;border-radius:4px;background:linear-gradient(135deg,#ff9a9e,#fad0c4);color:#fff;}
.stake-options{margin-bottom:10px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
#mineReward{border:2px dashed #aaa;padding:10px;margin-left:10px;border-radius:10px;min-width:150px;text-align:center;font-weight:bold;position:relative;color:#fff;}
button#collectReward{padding:10px;background:linear-gradient(135deg,#ff9a9e,#fad0c4);border:none;color:#fff;font-weight:bold;cursor:pointer;border-radius:8px;margin-left:10px;transition:0.3s;}
button#collectReward:hover{background:linear-gradient(135deg,#a1c4fd,#c2e9fb);}
#loader{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:9999;background:#000;transition:opacity 0.6s ease;}
#loader.hidden{opacity:0;pointer-events:none;}
#loaderAnimation{width:150px;height:150px;margin-bottom:20px;}
#loaderProgressContainer{width:60%;height:20px;background:#222;border-radius:10px;overflow:hidden;margin-top:20px;}
#loaderProgress{width:0%;height:100%;background:linear-gradient(135deg,#ff9a9e,#fad0c4);transition:width 0.2s;}
.flying{position:absolute;width:80px;height:80px;pointer-events:none;z-index:10000;}
.mobs-grid{display:flex;gap:15px;justify-content:center;flex-wrap:wrap;margin-bottom:15px;}
.mob-card{background:#222;padding:10px;border-radius:8px;flex:1 1 100px;text-align:center;cursor:pointer;transition:0.3s;}
.mob-card:hover{background:#444;}
#rouletteCanvas{background:#222;border-radius:50%;}
#spinButton{padding:10px;margin-top:10px;background:linear-gradient(135deg,#ff9a9e,#fad0c4);border:none;color:#fff;font-weight:bold;cursor:pointer;border-radius:8px;}
@media (max-width:500px){.tab-bar button{font-size:0.85em;padding:8px;}#balance{font-size:1em;padding:10px;}#mineGrid,.mines-grid{gap:3px;}}
</style>
</head>
<body>

<div id="loader">
  <div id="loaderAnimation"></div>
  <p style="color:#fff;font-size:1.2em;">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤...</p>
  <div id="loaderProgressContainer"><div id="loaderProgress"></div></div>
</div>

<div id="balance">–ë–∞–ª–∞–Ω—Å: 10000 <img src="ton.svg" style="width:16px;vertical-align:middle"></div>

<main id="menu" class="active">
<h2>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h2>
<p>–í—ã–±–∏—Ä–∞–π —Ä–µ–∂–∏–º –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –ø–æ–¥–∞—Ä–∫–∏!</p>
</main>

<main id="mines">
<h2>–ú–∏–Ω—ã üí£</h2>
<div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;margin-bottom:10px;">
<div class="stake-options">
<label><input type="radio" name="stakeType" value="ton" checked onchange="updateStakeInput()"> TON</label>
<label><input type="radio" name="stakeType" value="gift" onchange="updateStakeInput()"> –ü–æ–¥–∞—Ä–æ–∫</label>
<input type="number" id="tonStake" min="0.5" step="0.1" placeholder="–°—Ç–∞–≤–∫–∞ TON">
<select id="giftStake" style="display:none"></select>
<button onclick="startMines()">–ò–≥—Ä–∞—Ç—å</button>
</div>
<div>
<div id="mineReward">–í—ã–∏–≥—Ä—ã—à: ‚Äì</div>
<button id="collectReward" onclick="collectReward()">–ó–∞–±—Ä–∞—Ç—å</button>
</div>
</div>
<div class="grid mines-grid" id="minesGrid"></div>
<p id="minesStatus"></p>
</main>

<main id="mine">
<h2>–®–∞—Ö—Ç–∞ ‚õèÔ∏è</h2>
<div class="grid" id="mineGrid"></div>
</main>

<main id="inventory">
<h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å üéí</h2>
<div class="inventory-list" id="inventoryList"></div>
</main>

<main id="mobs">
<h2>–ú–æ–±—ã üêæ</h2>
<div class="mobs-grid" id="mobsGrid"></div>
<canvas id="rouletteCanvas" width="400" height="400"></canvas>
<div style="text-align:center;">
  <button id="spinButton">–†–∞—Å–∫—Ä—É—Ç–∏—Ç—å</button>
</div>
</main>

<div class="tab-bar">
<button onclick="showTab('menu')" id="tab-menu" class="active">–ú–µ–Ω—é</button>
<button onclick="showTab('mines')" id="tab-mines">–ú–∏–Ω—ã</button>
<button onclick="showTab('mine')" id="tab-mine">–®–∞—Ö—Ç–∞</button>
<button onclick="showTab('inventory')" id="tab-inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
<button onclick="showTab('mobs')" id="tab-mobs">–ú–æ–±—ã</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>
<script>

// ---------------------- –ë–∞–ª–∞–Ω—Å ----------------------
let balance = 10000;
function updateBalance(){
  document.getElementById('balance').innerHTML = `–ë–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} <img src="ton.svg" style="width:16px;vertical-align:middle">`;
}

// ---------------------- –í–∫–ª–∞–¥–∫–∏ ----------------------
const backgrounds = {
  menu:'images/menu.jpg', mines:'images/mines.jpg', mine:'images/mine.jpg',
  inventory:'images/inventory.jpg', mobs:'images/mobs.jpg'
};
function showTab(id){
  document.querySelectorAll('main').forEach(m=>m.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.tab-bar button').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+id).classList.add('active');
  document.body.style.backgroundImage=`url(${backgrounds[id]})`;
  if(id==='inventory') renderInventory();
  if(id==='mobs') renderMobs();
}

// ---------------------- –ü–æ–¥–∞—Ä–∫–∏ ----------------------
const gifts=[
  {name:"Hypno Lollipop",price:1.77},{name:"Desk Calendar",price:1.31},
  {name:"B-Day Candle",price:1.32},{name:"Lol Pop",price:1.32},
  {name:"Lunar Snake",price:1.38},{name:"Snake Box",price:1.36},
  {name:"Xmas Stocking",price:1.38},{name:"Whip Cupcake",price:1.38},
  {name:"Candy Cane",price:1.48},{name:"Pet Snake",price:1.58},
  {name:"Jester Hat",price:1.62},{name:"Snoop Dogg",price:1.64},
  {name:"Homemade Cake",price:1.7},{name:"Holiday Drink",price:1.7},
  {name:"Jingle Bells",price:1.74},{name:"Cookie Heart",price:1.75},
  {name:"Big Year",price:1.78},{name:"Party Sparkler",price:1.8},
  {name:"Winter Wreath",price:1.79},{name:"Swag Bag",price:1.91},
  {name:"Tama Gadget",price:1.93},{name:"Ginger Cookie",price:1.95},
  {name:"Moon Pendant",price:1.96},{name:"Jack-in-the-Box",price:2.01},
  {name:"Spiced Wine",price:2.12},{name:"Stellar Rocket",price:2.19},
  {name:"Star Notepad",price:2.32},{name:"Easter Egg",price:2.46},
  {name:"Restless Jar",price:2.5},{name:"Santa Hat",price:2.6},
  {name:"Snow Globe",price:2.65},{name:"Hex Pot",price:2.7},
  {name:"Joyful Bundle",price:2.71},{name:"Lush Bouquet",price:2.84},
  {name:"Witch Hat",price:2.86},{name:"Light Sword",price:3.13},
  {name:"Spy Agaric",price:3.2},{name:"Bow Tie",price:3.22},
  {name:"Eternal Candle",price:3.38},{name:"Bunny Muffin",price:3.34},
  {name:"Jelly Bunny",price:3.43},{name:"Berry Box",price:3.58},
  {name:"Evil Eye",price:3.6},{name:"Snow Mittens",price:3.67},
  {name:"Valentine Box",price:4.2},{name:"Snoop Cigar",price:4.26},
  {name:"Sakura Flower",price:4.77},{name:"Hanging Star",price:5.26},
  {name:"Jolly Chimp",price:5.34},{name:"Sleigh Bell",price:7.63},
  {name:"Skull Flower",price:7.7},{name:"Crystal Ball",price:7.86},
  {name:"Record Player",price:7.91},{name:"Love Candle",price:7.94},
  {name:"Top Hat",price:7.99},{name:"Trapped Heart",price:8.69},
  {name:"Love Potion",price:8.79},{name:"Flying Broom",price:9.45},
  {name:"Cupid Charm",price:11.26},{name:"Eternal Rose",price:13.71},
  {name:"Ionic Dryer",price:14.21},{name:"Diamond Ring",price:16.39},
  {name:"Voodoo Doll",price:16.43},{name:"Mad Pumpkin",price:17.91},
  {name:"Toy Bear",price:19.3},{name:"Vintage Cigar",price:23.98},
  {name:"Low Rider",price:24.8},{name:"Signet Ring",price:25.1},
  {name:"Neko Helmet",price:26.41},{name:"Electric Skull",price:31},
  {name:"Kissed Frog",price:34},{name:"Swiss Watch",price:35},
  {name:"Sharp Tongue",price:39.69},{name:"Scared Cat",price:43.6},
  {name:"Genie Lamp",price:47.07},{name:"Westside Sign",price:51.27},
  {name:"Bonded Ring",price:54.99},{name:"Gem Signet",price:72.98},
  {name:"Magic Potion",price:72.98},{name:"Ion Gem",price:83},
  {name:"Astral Shard",price:95.97},{name:"Perfume Bottle",price:95.99},
  {name:"Loot Bag",price:90.1},{name:"Mini Oscar",price:123.89},
  {name:"Nail Bracelet",price:129.84},{name:"Heroic Helmet",price:219.99},
  {name:"Precious Peach",price:379.99},{name:"Durov‚Äôs Cap",price:794.9},
  {name:"Heart Locket",price:1450},{name:"Plush Pepe",price:5199}
];
let inventory=[];

// ---------------------- –®–∞—Ö—Ç–∞ ----------------------
const oreTypes=[
  {img:"images/ores/coal.png",hits:3},{img:"images/ores/iron.png",hits:4},{img:"images/ores/gold.png",hits:5},
  {img:"images/ores/diamond.png",hits:6},{img:"images/ores/emerald.png",hits:7}
];
function getGiftByPrice(price,isFirst=false){
  let min=price*0.5, max=price*1.45;
  let possible=gifts.filter(g=>g.price>=min&&g.price<=max);
  if(isFirst){possible=gifts.filter(g=>g.price>=price); if(possible.length===0) possible=gifts;}
  if(possible.length===0) possible=gifts;
  return possible[Math.floor(Math.random()*possible.length)];
}
function spawnBlock(cell,index=0){
  const ore=oreTypes[Math.floor(Math.random()*oreTypes.length)];
  let price=+(1+Math.random()*10).toFixed(2);
  cell.className="block";
  cell.style.backgroundImage=`url(${ore.img})`;
  cell.innerHTML=`<div class="block-price">${price}<img src="ton.svg" style="width:12px;vertical-align:middle"></div>`;
  let hits=0;
  cell.onclick=()=>{
    hits++;
    if(hits>=ore.hits){
      if(balance>=price){balance-=price; updateBalance();}
      let gift=getGiftByPrice(price,index===0);
      inventory.push(gift); renderInventory();
      flyGift(gift,cell);
      let respawn=(60+Math.random()*1740)*1000;
      cell.classList.add("cooldown");
      cell.innerHTML=`<div style="position:absolute;top:2px;left:2px;font-size:0.7em;">${Math.round(respawn/60000)}m</div>`;
      cell.onclick=null;
      setTimeout(()=>{cell.classList.remove("cooldown"); spawnBlock(cell,index);},respawn);
    }
  };
}
function generateMineGrid(){
  const grid=document.getElementById("mineGrid"); grid.innerHTML="";
  for(let i=0;i<16;i++){ let cell=document.createElement("div"); spawnBlock(cell,i); grid.appendChild(cell); }
}

// ---------------------- –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥–∞—Ä–∫–∞ ----------------------
function flyGift(gift,fromCell){
  const rect=fromCell.getBoundingClientRect();
  const fly=document.createElement("div");
  fly.className="flying";
  fly.style.left=rect.left+"px"; fly.style.top=rect.top+"px";
  document.body.appendChild(fly);
  lottie.loadAnimation({container:fly,renderer:"svg",loop:false,autoplay:true,path:`emoji/${gift.name}.json`});
  const inv=document.getElementById("tab-inventory").getBoundingClientRect();
  fly.animate([{transform:`translate(0,0)`},{transform:`translate(${inv.left-rect.left}px,${inv.top-rect.top}px)`}],{duration:1000,easing:"ease-in-out"});
  setTimeout(()=>fly.remove(),1000);
}

// ---------------------- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å ----------------------
function renderInventory(){
  let list=document.getElementById("inventoryList"); list.innerHTML="";
  inventory.forEach((gift,idx)=>{
    let div=document.createElement("div"); div.className="gift-item";
    let prev=document.createElement("div"); prev.className="gift-preview";
    lottie.loadAnimation({container:prev,renderer:"svg",loop:false,autoplay:true,path:`emoji/${gift.name}.json`});
    let info=document.createElement("div");
    info.innerHTML=`${gift.name} ‚Äì ${gift.price} <img src="ton.svg" style="width:14px;vertical-align:middle">`;
    let actions=document.createElement("div"); actions.className="gift-actions";
    let sellBtn=document.createElement("button"); sellBtn.textContent="–ü—Ä–æ–¥–∞—Ç—å"; sellBtn.onclick=()=>{balance+=gift.price; updateBalance(); inventory.splice(idx,1); renderInventory();};
    let withdrawBtn=document.createElement("button"); withdrawBtn.textContent="–í—ã–≤–µ—Å—Ç–∏"; withdrawBtn.onclick=()=>{alert("–í—ã–≤–æ–¥ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω");};
    actions.appendChild(sellBtn); actions.appendChild(withdrawBtn);
    div.appendChild(prev); div.appendChild(info); div.appendChild(actions); list.appendChild(div);
  });
}

// ---------------------- –ú–∏–Ω—ã ----------------------
let minesActive=false, minesLost=false, mineMultiplier=1, currentStake=0;
function generateMines(){
  const grid=document.getElementById("minesGrid"); grid.innerHTML="";
  let mines=[]; while(mines.length<5){let idx=Math.floor(Math.random()*25); if(!mines.includes(idx)) mines.push(idx);}
  for(let i=0;i<25;i++){
    let cell=document.createElement("div"); cell.className="mine-cell disabled"; cell.dataset.mine=mines.includes(i); cell.onclick=()=>clickMine(cell); grid.appendChild(cell);
  }
}
function clickMine(cell){
  if(!minesActive||cell.classList.contains("revealed")) return;
  cell.classList.add("revealed");
  if(cell.dataset.mine==="true"){ cell.classList.add("mine"); document.getElementById("minesStatus").innerText="üí• –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!"; minesLost=true; minesActive=false; }
  else { cell.classList.add("safe"); mineMultiplier+=0.5; document.getElementById("mineReward").innerText="–í—ã–∏–≥—Ä—ã—à: "+(currentStake*mineMultiplier).toFixed(2); }
}
function startMines(){
  const stakeType=document.querySelector('input[name="stakeType"]:checked').value;
  let stake=stakeType==="ton"?parseFloat(document.getElementById("tonStake").value):null;
  if(stakeType==="ton"&&!stake){alert("–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É"); return;}
  if(stakeType==="ton"&&balance<stake){alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤"); return;}
  if(stakeType==="ton"){balance-=stake; updateBalance();}
  currentStake=stake; mineMultiplier=1; minesLost=false; minesActive=true;
  generateMines(); document.querySelectorAll(".mine-cell").forEach(c=>c.classList.remove("disabled"));
  document.getElementById("mineReward").innerText="–í—ã–∏–≥—Ä—ã—à: ‚Äì"; document.getElementById("minesStatus").innerText="";
}
function collectReward(){
  if(!minesActive&&!minesLost&&currentStake>0){
    let win=currentStake*mineMultiplier;
    if(win>=1.5){let gift=getGiftByPrice(win); inventory.push(gift); renderInventory(); alert("–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –ø–æ–¥–∞—Ä–æ–∫: "+gift.name);}
    else{balance+=win; updateBalance();}
    currentStake=0; minesActive=false;
    document.getElementById("mineReward").innerText="–í—ã–∏–≥—Ä—ã—à: ‚Äì";
    document.getElementById("minesStatus").innerText="üí∞ –í—ã –∑–∞–±—Ä–∞–ª–∏ –≤—ã–∏–≥—Ä—ã—à!";
  }
}

<!-- ======= –ú–æ–±—ã ======= -->
<main id="mobs">
  <h2>–ú–æ–±—ã üêæ</h2>
  <div class="mobs-grid" id="mobsGrid"></div>
  <canvas id="rouletteCanvas" width="400" height="400"></canvas>
  <div style="text-align:center;">
    <button id="spinButton">–†–∞—Å–∫—Ä—É—Ç–∏—Ç—å</button>
  </div>
</main>

// --- –î–∞–Ω–Ω—ã–µ –º–æ–±–æ–≤ ---
const mobsData = [
  {name:"–ó–æ–º–±–∏", price:1, lose:0.4, win:0.4, epicGift:"Restless Jar", color:"#0a5a0a"},
  {name:"–ü–∞—É–∫", price:2, lose:0.3, win:0.6, epicGift:"Witch Hat", color:"#222222"},
  {name:"–°–∫–µ–ª–µ—Ç", price:3, lose:0.9, win:0, epicGift:"Crystal Ball", color:"#aaaaaa"},
  {name:"–ö—Ä–∏–ø–µ—Ä", price:5, lose:0.7, win:0.25, epicGift:"Mad Pumpkin", color:"#3fa93f"}
];

let selectedMob = null;
let spinning = false;

const canvas = document.getElementById("rouletteCanvas");
const ctx = canvas.getContext("2d");
const center = canvas.width / 2;
const radius = canvas.width / 2 - 10;

// --- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–æ–±–æ–≤ ---
function renderMobs() {
  const grid = document.getElementById("mobsGrid");
  if (grid.childElementCount > 0) return;

  mobsData.forEach(mob => {
    const div = document.createElement("div");
    div.className = "mob-card";
    div.innerHTML = `
      <img src="mobs/${mob.name}.png" style="width:80px"><br>
      ${mob.name} (${mob.price} TON)
    `;
    div.onclick = () => selectMob(mob);
    grid.appendChild(div);
  });
}

// --- –í—ã–±–æ—Ä –º–æ–±–∞ ---
function selectMob(mob) {
  if (balance < mob.price) {
    alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON –¥–ª—è —Å—Ç–∞–≤–∫–∏!");
    return;
  }
  selectedMob = mob;
  drawRoulette();
}

// --- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ä—É–ª–µ—Ç–∫–∏ ---
function drawRoulette() {
  if (!selectedMob) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  const baseColor = selectedMob.color;
  const epicColor = lightenColor(baseColor, 40);

  const segments = [
    {label: "–ü—Ä–æ–∏–≥—Ä—ã—à", value: selectedMob.lose, color: "#f44336"},
    {label: "–í—ã–∏–≥—Ä—ã—à", value: selectedMob.win, color: baseColor},
    {label: "–≠–ø–∏–∫", value: 1 - selectedMob.lose - selectedMob.win, color: epicColor}
  ];

  let startAngle = 0;
  segments.forEach(seg => {
    const endAngle = startAngle + seg.value * 2 * Math.PI;
    ctx.beginPath();
    ctx.moveTo(center, center);
    ctx.arc(center, center, radius, startAngle, endAngle);
    ctx.fillStyle = seg.color;
    ctx.fill();
    ctx.closePath();
    startAngle = endAngle;
  });

  // –†–∏—Å—É–µ–º –º–æ–±–∞ –≤ —Ü–µ–Ω—Ç—Ä–µ
  const img = new Image();
  img.src = `mobs/${selectedMob.name}.png`;
  img.onload = () => {
    ctx.drawImage(img, center - 40, center - 40, 80, 80);
  };
}

// --- –í—Ä–∞—â–µ–Ω–∏–µ —Ä—É–ª–µ—Ç–∫–∏ ---
function spinRoulette() {
  if (!selectedMob || spinning) return;
  if (balance < selectedMob.price) {
    alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ TON –¥–ª—è —Å—Ç–∞–≤–∫–∏!");
    return;
  }

  balance -= selectedMob.price;
  updateBalance();

  spinning = true;

  const baseColor = selectedMob.color;
  const epicColor = lightenColor(baseColor, 40);

  const segments = [
    {label: "–ü—Ä–æ–∏–≥—Ä—ã—à", value: selectedMob.lose, color: "#f44336"},
    {label: "–í—ã–∏–≥—Ä—ã—à", value: selectedMob.win, color: baseColor},
    {label: "–≠–ø–∏–∫", value: 1 - selectedMob.lose - selectedMob.win, color: epicColor}
  ];

  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  let rand = Math.random();
  let result;
  if (rand < segments[0].value) result = 0;
  else if (rand < segments[0].value + segments[1].value) result = 1;
  else result = 2;

  // –ù–∞—Ö–æ–¥–∏–º —É–≥–æ–ª –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
  const startAngles = [
    0,
    segments[0].value * 2 * Math.PI,
    (segments[0].value + segments[1].value) * 2 * Math.PI
  ];
  const targetAngle = startAngles[result] + (segments[result].value * Math.PI);

  let rotation = 0;
  const finalRotation = (5 * Math.PI * 2) - targetAngle;
  
  function step() {
    rotation += (finalRotation - rotation) * 0.1;
    ctx.save();
    ctx.translate(center, center);
    ctx.rotate(rotation);
    ctx.translate(-center, -center);
    drawRoulette();
    ctx.restore();

    if (Math.abs(finalRotation - rotation) < 0.002) {
      finishSpin(result);
      spinning = false;
    } else {
      requestAnimationFrame(step);
    }
  }
  step();
}

// --- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–ø–∏–Ω–∞ ---
function finishSpin(result) {
  if (result === 0) {
    alert("‚ùå –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!");
  } else if (result === 1) {
    balance += selectedMob.price;
    updateBalance();
    alert(`‚úÖ –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –∏ –≤–µ—Ä–Ω—É–ª–∏ ${selectedMob.price} TON`);
  } else if (result === 2) {
    const gift = gifts.find(g => g.name === selectedMob.epicGift);
    if (gift) {
      inventory.push(gift);
      renderInventory();
      alert(`üåü –≠–ø–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–∑: ${gift.name}`);
    }
  }
}

// --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Å–≤–µ—Ç–ª–µ–Ω–∏—è —Ü–≤–µ—Ç–∞ ---
function lightenColor(hex, percent) {
  let num = parseInt(hex.replace("#", ""), 16),
      amt = Math.round(2.55 * percent),
      R = (num >> 16) + amt,
      G = (num >> 8 & 0x00FF) + amt,
      B = (num & 0x0000FF) + amt;
  return "#" + (
    0x1000000 +
    (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +
    (G < 255 ? (G < 1 ? 0 : G) : 255) * 0x100 +
    (B < 255 ? (B < 1 ? 0 : B) : 255)
  ).toString(16).slice(1);
}

// –ö–Ω–æ–ø–∫–∞ —Å–ø–∏–Ω–∞
document.getElementById("spinButton").onclick = spinRoulette;
</script>

// ---------------------- –†—É–ª–µ—Ç–∫–∞ ----------------------
const rouletteCanvas=document.getElementById("rouletteCanvas"); const ctx=rouletteCanvas.getContext("2d");
let rouletteSpinning=false;
function drawRoulette(angle=0){
  const radius=rouletteCanvas.width/2; const num=gifts.length; ctx.clearRect(0,0,rouletteCanvas.width,rouletteCanvas.height); ctx.save(); ctx.translate(radius,radius); ctx.rotate(angle);
  const sliceAngle=2*Math.PI/num;
  for(let i=0;i<num;i++){ctx.beginPath(); ctx.moveTo(0,0); ctx.arc(0,0,radius,i*sliceAngle,(i+1)*sliceAngle); ctx.fillStyle=i%2?"#333":"#444"; ctx.fill();}
  ctx.restore();
}
drawRoulette();
document.getElementById("spinButton").onclick=()=>{if(rouletteSpinning)return; rouletteSpinning=true; let angle=0; let duration=5000; let start=performance.now(); function anim(time){let t=(time-start)/duration; if(t>1){rouletteSpinning=false; finishSpin(angle); return;} angle+=0.3; drawRoulette(angle); requestAnimationFrame(anim);} requestAnimationFrame(anim);}
function finishSpin(angle){let idx=Math.floor(Math.random()*gifts.length); alert("–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏: "+gifts[idx].name); inventory.push(gifts[idx]); renderInventory();}

// ---------------------- –ü—Ä–æ–≥—Ä–µ—Å—Å–±–∞—Ä –∑–∞–≥—Ä—É–∑–∫–∏ ----------------------
let loaderAnim=lottie.loadAnimation({container:document.getElementById('loaderAnimation'),renderer:'svg',loop:true,autoplay:true,path:'animations/myLoader.json'});
function preloadAssets(){
  const imagePaths=[...Object.values(backgrounds),"ton.svg",...oreTypes.map(o=>o.img)];
  const progressFill=document.getElementById("loaderProgress");
  let loadedCount=0;
  const promises=imagePaths.map(src=>new Promise(res=>{const img=new Image(); img.onload=img.onerror=()=>{loadedCount++; progressFill.style.width=((loadedCount/imagePaths.length)*100).toFixed(2)+"%"; res();}; img.src=src;}));
  Promise.all(promises).then(()=>{setTimeout(()=>{document.getElementById("loader").classList.add("hidden"); document.body.style.backgroundImage=`url(${backgrounds['menu']})`; updateBalance(); generateMineGrid(); generateMines();},300);});
}
preloadAssets();

// ---------------------- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–æ–π ----------------------
function updateStakeInput(){
  let type=document.querySelector('input[name="stakeType"]:checked').value;
  document.getElementById("tonStake").style.display=type==="ton"?"inline-block":"none";
  document.getElementById("giftStake").style.display=type==="gift"?"inline-block":"none";
}

</script>
</body>
</html>
