<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GiftsMine üéÅ</title>
<style>
@font-face {
  font-family: 'Minecraft';
  src: url('minecraft.ttf') format('truetype');
}
body, html {
  margin:0; padding:0; height:100%;
  font-family:'Minecraft', sans-serif;
  color:#fff; overflow:hidden;
  display:flex; flex-direction:column;
  background:#000 center/cover no-repeat;
}
#balance{padding:15px;text-align:right;font-size:1.2em;font-weight:bold;background:rgba(0,0,0,0.2);}
main{flex:1;overflow-y:auto;padding:10px;margin-bottom:60px;display:none;background:rgba(0,0,0,0.2);}
main.active{display:block;}
.tab-bar{position:fixed;bottom:0;width:100%;display:flex;justify-content:space-around;background:rgba(0,0,0,0.2);padding:10px;border-top:2px solid #fff;}
.tab-bar button{flex:1;margin:0 5px;padding:10px;border:none;background:#444;color:#fff;font-weight:bold;cursor:pointer;transition:0.3s;}
.tab-bar button.active{background:#888;}
.grid{display:grid;gap:5px;justify-content:center;}
.mines-grid{grid-template-columns:repeat(5,minmax(50px,1fr));}
#mineGrid{grid-template-columns:repeat(4,minmax(60px,1fr));}
.mine-cell,.block{aspect-ratio:1/1;background:#333;display:flex;align-items:center;justify-content:center;cursor:pointer;position:relative;overflow:hidden;border-radius:6px;}
.mine-cell.disabled{pointer-events:none;opacity:0.6;}
.mine-cell.revealed.safe{background:#4caf50;}
.mine-cell.revealed.mine{background:#f44336;}
.block-price{position:absolute;bottom:2px;right:2px;background:rgba(0,0,0,0.5);padding:2px 4px;font-size:0.7em;border-radius:2px;}
.block.cooldown{filter:brightness(0.5);cursor:not-allowed;}
.inventory-list{display:flex;flex-wrap:wrap;gap:10px;}
.gift-item{background:#222;padding:10px;font-size:0.9em;flex:1 1 45%;display:flex;align-items:center;gap:10px;color:#fff;border-radius:8px;}
.gift-preview{width:50px;height:50px;}
.gift-actions{display:flex;flex-direction:column;gap:4px;}
.gift-actions button{padding:4px 6px;font-size:0.75em;cursor:pointer;border:none;border-radius:4px;background:#666;color:#fff;}
.stake-options{margin-bottom:10px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
#mineReward{border:2px dashed #aaa;padding:10px;margin-left:10px;border-radius:10px;min-width:150px;text-align:center;font-weight:bold;color:#fff;}
button#collectReward{padding:10px;background:#666;border:none;color:#fff;font-weight:bold;cursor:pointer;border-radius:8px;margin-left:10px;}
#loader{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:9999;background:#000;}
#loader.hidden{display:none;}
#loaderAnimation{width:150px;height:150px;margin-bottom:20px;}
/* –ú–æ–±—ã */
.mob-selection{display:flex;gap:15px;flex-wrap:wrap;justify-content:center;margin-top:20px;}
.mob-card{background:rgba(0,0,0,0.4);padding:15px;border-radius:10px;text-align:center;cursor:pointer;}
.mob-card img{width:80px;height:80px;}
#rouletteContainer{display:none;flex-direction:column;align-items:center;gap:20px;margin-top:20px;}
#rouletteCanvas{width:300px;height:300px;}
.spin-btn{padding:12px 20px;font-size:1.1em;border:none;border-radius:10px;background:#666;color:#fff;cursor:pointer;font-weight:bold;}
.flying{position:absolute;width:80px;height:80px;pointer-events:none;z-index:10000;}
</style>
</head>
<body>

<div id="loader">
  <div id="loaderAnimation"></div>
  <p style="color:#fff">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
</div>

<div id="balance">–ë–∞–ª–∞–Ω—Å: 10000 <img src="ton.svg" width="16"></div>

<main id="menu" class="active"><h2>–ú–µ–Ω—é</h2></main>

<main id="mines">
<h2>–ú–∏–Ω—ã</h2>
<div class="stake-options">
<label><input type="radio" name="stakeType" value="ton" checked onchange="updateStakeInput()"> TON</label>
<label><input type="radio" name="stakeType" value="gift" onchange="updateStakeInput()"> –ü–æ–¥–∞—Ä–æ–∫</label>
<input type="number" id="tonStake" min="0.5" step="0.1" placeholder="–°—Ç–∞–≤–∫–∞ TON">
<select id="giftStake" style="display:none"></select>
<button onclick="startMines()">–ò–≥—Ä–∞—Ç—å</button>
<div id="mineReward">–í—ã–∏–≥—Ä—ã—à: ‚Äì</div>
<button id="collectReward" onclick="collectReward()">–ó–∞–±—Ä–∞—Ç—å</button>
</div>
<div class="grid mines-grid" id="minesGrid"></div>
<p id="minesStatus"></p>
</main>

<main id="mine">
<h2>–®–∞—Ö—Ç–∞</h2>
<div class="grid" id="mineGrid"></div>
</main>

<main id="mobs">
<h2>–ú–æ–±—ã</h2>
<div id="mobSelect" class="mob-selection"></div>
<div id="rouletteContainer">
  <canvas id="rouletteCanvas" width="300" height="300"></canvas>
  <button id="spinButton" class="spin-btn">–ö—Ä—É—Ç–∏—Ç—å</button>
</div>
</main>

<main id="inventory">
<h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
<div class="inventory-list" id="inventoryList"></div>
</main>

<div class="tab-bar">
<button onclick="showTab('menu')" id="tab-menu" class="active">–ú–µ–Ω—é</button>
<button onclick="showTab('mines')" id="tab-mines">–ú–∏–Ω—ã</button>
<button onclick="showTab('mine')" id="tab-mine">–®–∞—Ö—Ç–∞</button>
<button onclick="showTab('mobs')" id="tab-mobs">–ú–æ–±—ã</button>
<button onclick="showTab('inventory')" id="tab-inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>
<script>
/* --- –ë–∞–ª–∞–Ω—Å --- */
let balance=10000;
function updateBalance(){
  document.getElementById('balance').innerHTML=`–ë–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} <img src="ton.svg" width="16">`;
}

/* --- –§–æ–Ω—ã --- */
const backgrounds={
  menu:'images/menu.jpg',mines:'images/mines.jpg',mine:'images/mine.jpg',
  mobs:'images/mobs.jpg',inventory:'images/inventory.jpg'
};
function showTab(id){
  document.querySelectorAll('main').forEach(m=>m.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.querySelectorAll('.tab-bar button').forEach(b=>b.classList.remove('active'));
  document.getElementById('tab-'+id).classList.add('active');
  document.body.style.backgroundImage=`url(${backgrounds[id]})`;
  if(id==='inventory') renderInventory();
}

/* --- –ü–æ–¥–∞—Ä–∫–∏ (–ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫) --- */
const gifts=[
  {name:"Hypno Lollipop",price:1.77},{name:"Desk Calendar",price:1.31},
  {name:"B-Day Candle",price:1.32},{name:"Lol Pop",price:1.32},
  {name:"Lunar Snake",price:1.38},{name:"Snake Box",price:1.36},
  {name:"Xmas Stocking",price:1.38},{name:"Whip Cupcake",price:1.38},
  {name:"Candy Cane",price:1.48},{name:"Pet Snake",price:1.58},
  {name:"Jester Hat",price:1.62},{name:"Snoop Dogg",price:1.64},
  {name:"Homemade Cake",price:1.7},{name:"Holiday Drink",price:1.7},
  {name:"Jingle Bells",price:1.74},{name:"Cookie Heart",price:1.75},
  {name:"Big Year",price:1.78},{name:"Party Sparkler",price:1.8},
  {name:"Winter Wreath",price:1.79},{name:"Swag Bag",price:1.91},
  {name:"Tama Gadget",price:1.93},{name:"Ginger Cookie",price:1.95},
  {name:"Moon Pendant",price:1.96},{name:"Jack-in-the-Box",price:2.01},
  {name:"Spiced Wine",price:2.12},{name:"Stellar Rocket",price:2.19},
  {name:"Star Notepad",price:2.32},{name:"Easter Egg",price:2.46},
  {name:"Restless Jar",price:2.5},{name:"Santa Hat",price:2.6},
  {name:"Snow Globe",price:2.65},{name:"Hex Pot",price:2.7},
  {name:"Joyful Bundle",price:2.71},{name:"Lush Bouquet",price:2.84},
  {name:"Witch Hat",price:2.86},{name:"Light Sword",price:3.13},
  {name:"Spy Agaric",price:3.2},{name:"Bow Tie",price:3.22},
  {name:"Eternal Candle",price:3.38},{name:"Bunny Muffin",price:3.34},
  {name:"Jelly Bunny",price:3.43},{name:"Berry Box",price:3.58},
  {name:"Evil Eye",price:3.6},{name:"Snow Mittens",price:3.67},
  {name:"Valentine Box",price:4.2},{name:"Snoop Cigar",price:4.26},
  {name:"Sakura Flower",price:4.77},{name:"Hanging Star",price:5.26},
  {name:"Jolly Chimp",price:5.34},{name:"Sleigh Bell",price:7.63},
  {name:"Skull Flower",price:7.7},{name:"Crystal Ball",price:7.86},
  {name:"Record Player",price:7.91},{name:"Love Candle",price:7.94},
  {name:"Top Hat",price:7.99},{name:"Trapped Heart",price:8.69},
  {name:"Love Potion",price:8.79},{name:"Flying Broom",price:9.45},
  {name:"Cupid Charm",price:11.26},{name:"Eternal Rose",price:13.71},
  {name:"Ionic Dryer",price:14.21},{name:"Diamond Ring",price:16.39},
  {name:"Voodoo Doll",price:16.43},{name:"Mad Pumpkin",price:17.91},
  {name:"Toy Bear",price:19.3},{name:"Vintage Cigar",price:23.98},
  {name:"Low Rider",price:24.8},{name:"Signet Ring",price:25.1},
  {name:"Neko Helmet",price:26.41},{name:"Electric Skull",price:31},
  {name:"Kissed Frog",price:34},{name:"Swiss Watch",price:35},
  {name:"Sharp Tongue",price:39.69},{name:"Scared Cat",price:43.6},
  {name:"Genie Lamp",price:47.07},{name:"Westside Sign",price:51.27},
  {name:"Bonded Ring",price:54.99},{name:"Gem Signet",price:72.98},
  {name:"Magic Potion",price:72.98},{name:"Ion Gem",price:83},
  {name:"Astral Shard",price:95.97},{name:"Perfume Bottle",price:95.99},
  {name:"Loot Bag",price:90.1},{name:"Mini Oscar",price:123.89},
  {name:"Nail Bracelet",price:129.84},{name:"Heroic Helmet",price:219.99},
  {name:"Precious Peach",price:379.99},{name:"Durov‚Äôs Cap",price:794.9},
  {name:"Heart Locket",price:1450},{name:"Plush Pepe",price:5199}
];
let inventory=[];
function renderInventory(){
  const c=document.getElementById("inventoryList"); c.innerHTML="";
  inventory.forEach((gift,idx)=>{
    let div=document.createElement("div"); div.className="gift-item";
    let prev=document.createElement("div"); prev.className="gift-preview"; prev.textContent=gift.name;
    let info=document.createElement("div"); info.textContent=`${gift.price} TON`;
    let actions=document.createElement("div"); actions.className="gift-actions";
    let sell=document.createElement("button"); sell.textContent="–ü—Ä–æ–¥–∞—Ç—å";
    sell.onclick=()=>{balance+=gift.price;updateBalance();inventory.splice(idx,1);renderInventory();};
    let withdraw=document.createElement("button"); withdraw.textContent="–í—ã–≤–µ—Å—Ç–∏";
    withdraw.onclick=()=>alert("–í—ã–≤–æ–¥ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω");
    actions.appendChild(sell);actions.appendChild(withdraw);
    div.appendChild(prev);div.appendChild(info);div.appendChild(actions);
    c.appendChild(div);
  });
}

/* --- –®–∞—Ö—Ç–∞ --- */
const oreTypes=[{img:"images/ores/coal.png",hits:3},{img:"images/ores/iron.png",hits:4},{img:"images/ores/gold.png",hits:5},{img:"images/ores/diamond.png",hits:6},{img:"images/ores/emerald.png",hits:7}];
function getGiftByPrice(price){let possible=gifts.filter(g=>g.price>=price*0.5&&g.price<=price*1.5);return possible.length?possible[Math.floor(Math.random()*possible.length)]:gifts[0];}
function spawnBlock(cell){const ore=oreTypes[Math.floor(Math.random()*oreTypes.length)];let price=+(1+Math.random()*10).toFixed(2);cell.className="block";cell.style.backgroundImage=`url(${ore.img})`;cell.innerHTML=`<div class="block-price">${price}</div>`;let hits=0;cell.onclick=()=>{if(++hits>=ore.hits){if(balance>=price){balance-=price;updateBalance();}let gift=getGiftByPrice(price);inventory.push(gift);renderInventory();let respawn=(30+Math.random()*60)*1000;cell.classList.add("cooldown");cell.onclick=null;setTimeout(()=>spawnBlock(cell),respawn);}};}
function generateMineGrid(){const grid=document.getElementById("mineGrid");grid.innerHTML="";for(let i=0;i<16;i++){let cell=document.createElement("div");spawnBlock(cell);grid.appendChild(cell);}}

/* --- –ú–∏–Ω—ã --- */
let minesActive=false,minesLost=false,mineMultiplier=1,currentStake=0;
function generateMines(){const grid=document.getElementById("minesGrid");grid.innerHTML="";let mines=[];while(mines.length<5){let idx=Math.floor(Math.random()*25);if(!mines.includes(idx))mines.push(idx);}for(let i=0;i<25;i++){let cell=document.createElement("div");cell.className="mine-cell disabled";cell.dataset.mine=mines.includes(i);cell.onclick=()=>clickMine(cell);grid.appendChild(cell);}}
function clickMine(cell){if(!minesActive||cell.classList.contains("revealed"))return;cell.classList.add("revealed");if(cell.dataset.mine==="true"){cell.classList.add("mine");document.getElementById("minesStatus").innerText="üí• –ü—Ä–æ–∏–≥—Ä—ã—à";minesLost=true;minesActive=false;}else{cell.classList.add("safe");mineMultiplier+=0.5;document.getElementById("mineReward").innerText="–í—ã–∏–≥—Ä—ã—à: "+(currentStake*mineMultiplier).toFixed(2);}}
function startMines(){let stake=parseFloat(document.getElementById("tonStake").value);if(!stake||balance<stake){alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤");return;}balance-=stake;updateBalance();currentStake=stake;mineMultiplier=1;minesLost=false;minesActive=true;generateMines();document.querySelectorAll(".mine-cell").forEach(c=>c.classList.remove("disabled"));document.getElementById("mineReward").innerText="–í—ã–∏–≥—Ä—ã—à: ‚Äì";document.getElementById("minesStatus").innerText="";}
function collectReward(){if(!minesActive&&!minesLost&&currentStake>0){let win=currentStake*mineMultiplier;if(win>=1.5){let gift=getGiftByPrice(win);inventory.push(gift);renderInventory();alert("–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –ø–æ–¥–∞—Ä–æ–∫: "+gift.name);}else{balance+=win;updateBalance();alert("–í—ã–∏–≥—Ä—ã—à: "+win.toFixed(2)+" TON");}}minesActive=false;currentStake=0;document.getElementById("mineReward").innerText="–í—ã–∏–≥—Ä—ã—à: ‚Äì";}

/* --- –ú–æ–±—ã —Å —Ä—É–ª–µ—Ç–∫–æ–π --- */
const mobsConfig=[{name:"–ó–æ–º–±–∏",img:"mobs/zombie.png",price:1,lose:0.4,win:0.4,epicGift:"Restless Jar",colors:["#c00","#030"]},{name:"–ü–∞—É–∫",img:"mobs/spider.png",price:2,lose:0.3,win:0.6,epicGift:"Witch Hat",colors:["#c00","#333"]},{name:"–°–∫–µ–ª–µ—Ç",img:"mobs/skeleton.png",price:3,lose:0.9,win:0,epicGift:"Crystal Ball",colors:["#c00","#ccc"]},{name:"–ö—Ä–∏–ø–µ—Ä",img:"mobs/creeper.png",price:5,lose:0.7,win:0.25,epicGift:"Mad Pumpkin",colors:["#c00","#0f0"]}];
let selectedMob=null,angle=0,spinning=false;
const canvas=document.getElementById("rouletteCanvas");const ctx=canvas.getContext("2d");
function renderMobSelection(){const c=document.getElementById("mobSelect");c.innerHTML="";mobsConfig.forEach(m=>{let card=document.createElement("div");card.className="mob-card";card.innerHTML=`<img src="${m.img}"><p>${m.name}<br>${m.price} TON</p>`;card.onclick=()=>selectMob(m);c.appendChild(card);});}
function selectMob(mob){selectedMob=mob;document.getElementById("mobSelect").style.display="none";document.getElementById("rouletteContainer").style.display="flex";document.getElementById("spinButton").textContent=`–ö—Ä—É—Ç–∏—Ç—å (${mob.price} TON)`;drawRoulette();}
function drawRoulette(){if(!selectedMob)return;const {lose,win,epicGift,colors}=selectedMob;const w=canvas.width,h=canvas.height,r=w/2;ctx.clearRect(0,0,w,h);ctx.save();ctx.translate(r,r);ctx.rotate(angle);const sectors=[{prob:lose,color:colors[0],label:"√ó",outcome:"lose"},{prob:win,color:colors[1],label:`${selectedMob.price} TON`,outcome:"win"},{prob:1-lose-win,color:colors[1],label:selectedMob.epicGift,outcome:"epic"}].filter(s=>s.prob>0);let start=0;sectors.forEach(sec=>{const arc=sec.prob*2*Math.PI;ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,r,start,start+arc);ctx.fillStyle=sec.color;ctx.fill();ctx.save();ctx.rotate(start+arc/2);ctx.fillStyle="#fff";ctx.font="16px Minecraft";ctx.textAlign="center";ctx.fillText(sec.label,r/2,0);ctx.restore();sec.start=start;sec.end=start+arc;start+=arc;});ctx.restore();selectedMob._sectors=sectors;}
function spinRoulette(){if(!selectedMob||spinning)return;if(balance<selectedMob.price){alert("–ù–µ—Ç TON");return;}balance-=selectedMob.price;updateBalance();spinning=true;const rnd=Math.random()*2*Math.PI;const sec=selectedMob._sectors.find(s=>rnd>=s.start&&rnd<s.end);const finalOutcome=sec.outcome;const stopAngle=2*Math.PI-rnd;const finalAngle=10*Math.PI+stopAngle;const duration=4000,start=performance.now();function anim(t){const p=Math.min((t-start)/duration,1);angle=finalAngle*(1-Math.pow(1-p,3));drawRoulette();if(p<1)requestAnimationFrame(anim);else{spinning=false;if(finalOutcome==="win"){balance+=selectedMob.price*2;updateBalance();alert("–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ —É–¥–≤–æ–µ–Ω–∏–µ!");}if(finalOutcome==="epic"){let g=gifts.find(x=>x.name===selectedMob.epicGift);if(g){inventory.push(g);renderInventory();alert("–≠–ø–∏–∫: "+g.name);}}if(finalOutcome==="lose"){alert("–ü—Ä–æ–∏–≥—Ä—ã—à");}}}requestAnimationFrame(anim);}
document.getElementById("spinButton").onclick=spinRoulette;

/* --- –õ–æ–∞–¥–µ—Ä –∏ –∞—Å—Å–µ—Ç—ã --- */
function preload(){const imgs=[...Object.values(backgrounds),...mobsConfig.map(m=>m.img),...oreTypes.map(o=>o.img),"ton.svg"];let promises=imgs.map(src=>new Promise(r=>{let i=new Image();i.onload=r;i.onerror=r;i.src=src;}));Promise.all(promises).then(()=>{document.getElementById("loader").classList.add("hidden");updateBalance();generateMineGrid();generateMines();renderMobSelection();});}
window.onload=preload;
</script>
</body>
</html>
