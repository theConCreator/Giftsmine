<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GiftsMine üéÅ</title>
<style>
/* --- –ü–æ–¥–∫–ª—é—á–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π —à—Ä–∏—Ñ—Ç --- */
@font-face {
  font-family: 'Minecraft';
  src: url('minecraft.ttf') format('truetype');
}
body, html {
  margin:0; padding:0; height:100%;
  font-family:'Minecraft',Segoe UI,sans-serif;
  color:#fff; overflow:hidden;
  display:flex; flex-direction:column;
  background:#000; background-size:cover; background-position:center;
}
/* --- –æ—Å—Ç–∞–ª—å–Ω–æ–π CSS –æ—Å—Ç–∞–≤–ª–µ–Ω –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π --- */
#balance{padding:15px;text-align:right;font-size:1.2em;font-weight:bold;background:rgba(0,0,0,0.15);backdrop-filter:blur(5px);box-shadow:0 2px 8px rgba(0,0,0,0.3);}
main{flex:1;overflow-y:auto;padding:10px;margin-bottom:60px;display:none;background: rgba(0,0,0,0.2);}
main.active{display:block;}
.tab-bar{position:fixed;bottom:0;width:100%;display:flex;justify-content:space-around;background:rgba(0,0,0,0.2);padding:10px;border-top:2px solid #fff;z-index:1000;}
.tab-bar button{flex:1;margin:0 5px;padding:10px;border:none;background:linear-gradient(135deg,#ff9a9e,#fad0c4);color:#fff;font-weight:bold;cursor:pointer;transition:0.3s;font-size:1em;}
.tab-bar button.active{background:linear-gradient(135deg,#a1c4fd,#c2e9fb);}
.grid{display:grid;gap:5px;justify-content:center;}
.mobs-grid{display:flex;gap:15px;justify-content:center;flex-wrap:wrap;margin-bottom:15px;}
.mob-card{background:#222;padding:10px;border-radius:8px;flex:1 1 100px;text-align:center;cursor:pointer;transition:0.3s;}
.mob-card:hover{background:#444;}
#rouletteCanvas{background:#222;border-radius:50%;}
#spinButton{padding:10px;margin-top:10px;background:linear-gradient(135deg,#ff9a9e,#fad0c4);border:none;color:#fff;font-weight:bold;cursor:pointer;border-radius:8px;}
</style>
</head>
<body>

<div id="balance">–ë–∞–ª–∞–Ω—Å: 10000 <img src="ton.svg" style="width:16px;vertical-align:middle"></div>

<main id="mobs" class="active">
<h2>–ú–æ–±—ã üêæ</h2>
<div class="mobs-grid" id="mobsGrid"></div>
<canvas id="rouletteCanvas" width="400" height="400"></canvas>
<div style="text-align:center;">
  <button id="spinButton">–†–∞—Å–∫—Ä—É—Ç–∏—Ç—å</button>
</div>
</main>

<script>
// --- –ë–∞–ª–∞–Ω—Å ---
let balance = 10000;
function updateBalance(){
  document.getElementById('balance').innerHTML =
    `–ë–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} <img src="ton.svg" style="width:16px;vertical-align:middle">`;
}

// --- –ú–æ–±—ã –∏ —Ä—É–ª–µ—Ç–∫–∞ ---
const mobsData=[
  {name:"–ó–æ–º–±–∏",price:1,lose:0.4,win:0.4,epicGift:"Restless Jar",color:"#0a5a0a"},
  {name:"–ü–∞—É–∫",price:2,lose:0.3,win:0.6,epicGift:"Witch Hat",color:"#111111"},
  {name:"–°–∫–µ–ª–µ—Ç",price:3,lose:0.9,win:0,epicGift:"Crystal Ball",color:"#aaaaaa"},
  {name:"–ö—Ä–∏–ø–µ—Ä",price:5,lose:0.7,win:0.25,epicGift:"Mad Pumpkin",color:"#7fff7f"}
];

let selectedMob=null, spinning=false;
const canvas=document.getElementById("rouletteCanvas");
const ctx=canvas.getContext("2d");
const center=canvas.width/2;
const radius=canvas.width/2-10;

// --- –†–µ–Ω–¥–µ—Ä–∏–º –º–æ–±—ã ---
function renderMobs(){
  const grid=document.getElementById("mobsGrid");
  if(grid.childElementCount>0) return;
  mobsData.forEach(mob=>{
    const div=document.createElement("div"); div.className="mob-card";
    div.innerHTML=`<img src="mobs/${mob.name}.png" style="width:80px"><br>${mob.name} (${mob.price} TON)`;
    div.onclick=()=>selectMob(mob);
    grid.appendChild(div);
  });
}

// --- –í—ã–±–æ—Ä –º–æ–±–∞ ---
function selectMob(mob){
  selectedMob=mob;
  drawRoulette();
}

// --- –†–∏—Å—É–µ–º —Ä—É–ª–µ—Ç–∫—É ---
function drawRoulette(rotation=0){
  if(!selectedMob) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const segments=[
    {label:"–ü—Ä–æ–∏–≥—Ä—ã—à",value:selectedMob.lose,color:"#f44336"},
    {label:"–í—ã–∏–≥—Ä—ã—à",value:selectedMob.win,color:selectedMob.color},
    {label:"–≠–ø–∏–∫",value:1-selectedMob.lose-selectedMob.win,color:"#ffd700"}
  ];
  let startAngle=rotation;
  segments.forEach(seg=>{
    const endAngle=startAngle+seg.value*2*Math.PI;
    ctx.beginPath(); ctx.moveTo(center,center);
    ctx.arc(center,center,radius,startAngle,endAngle);
    ctx.fillStyle=seg.color; ctx.fill(); ctx.closePath();
    startAngle=endAngle;
  });
  // –¶–µ–Ω—Ç—Ä —Å –º–æ–±–æ–º
  const img=new Image(); img.src=`mobs/${selectedMob.name}.png`;
  img.onload=()=>{ctx.drawImage(img,center-40,center-40,80,80);};
}

// --- –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è ---
function spinRoulette(){
  if(!selectedMob||spinning) return;
  spinning=true;

  // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–∞—Ä–∞–Ω–µ–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  const segments=[
    {label:"–ü—Ä–æ–∏–≥—Ä—ã—à",value:selectedMob.lose,color:"#f44336"},
    {label:"–í—ã–∏–≥—Ä—ã—à",value:selectedMob.win,color:selectedMob.color},
    {label:"–≠–ø–∏–∫",value:1-selectedMob.lose-selectedMob.win,color:"#ffd700"}
  ];
  let rand=Math.random(), resultIndex;
  if(rand<segments[0].value) resultIndex=0;
  else if(rand<segments[0].value+segments[1].value) resultIndex=1;
  else resultIndex=2;

  // –í—ã—á–∏—Å–ª—è–µ–º —É–≥–æ–ª –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ –Ω—É–∂–Ω–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ
  let angleStart=segments.slice(0,resultIndex).reduce((acc,s)=>acc+s.value*2*Math.PI,0);
  let angleEnd=angleStart+segments[resultIndex].value*2*Math.PI;
  let targetRotation=angleStart + Math.random()*(angleEnd-angleStart) + 5*2*Math.PI; // 5 –æ–±–æ—Ä–æ—Ç–æ–≤

  let currentRotation=0;
  function animate(){
    currentRotation += (targetRotation - currentRotation)*0.1;
    drawRoulette(currentRotation);
    if(Math.abs(targetRotation-currentRotation)<0.001){
      finishSpin(resultIndex);
      spinning=false;
    } else requestAnimationFrame(animate);
  }
  animate();
}

// --- –§–∏–Ω–∞–ª —Ä—É–ª–µ—Ç–∫–∏ ---
function finishSpin(result){
  if(result===0){alert("–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!");}
  else if(result===1){balance+=selectedMob.price; updateBalance(); alert("–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ "+selectedMob.price+" TON");}
  else if(result===2){alert("–≠–ø–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–∑: "+selectedMob.epicGift);}
}

document.getElementById("spinButton").onclick=spinRoulette;

// --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
updateBalance();
renderMobs();
</script>
</body>
</html>
