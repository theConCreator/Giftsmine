<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>MiniGames</title>
  <style>
    @font-face {
      font-family: 'Minecraft';
      src: url('minecraft.ttf') format('truetype');
    }

    body {
      margin: 0;
      font-family: 'Minecraft', sans-serif;
      background: #000;
      color: #fff;
      overflow: hidden;
    }

    /* –õ–æ–∞–¥–µ—Ä */
    #loader {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: #111;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    #loader h2 {
      margin-bottom: 20px;
    }
    #loaderBar {
      width: 80%;
      height: 20px;
      background: #333;
      border-radius: 10px;
      overflow: hidden;
    }
    #loaderProgress {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #00ff88, #00aaff);
      transition: width 0.3s;
    }

    /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
    nav {
      display: flex;
      justify-content: center;
      gap: 10px;
      padding: 10px;
      background: rgba(0,0,0,0.7);
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 10;
    }
    nav button {
      padding: 8px 16px;
      border: none;
      border-radius: 8px;
      background: linear-gradient(135deg, #ff9a9e, #fad0c4);
      box-shadow: 0 3px 6px rgba(0,0,0,0.3);
      cursor: pointer;
      font-family: 'Minecraft', sans-serif;
      font-size: 14px;
    }
    nav button:hover {
      opacity: 0.9;
    }

    /* –û–±—â–∏–µ —Å–µ–∫—Ü–∏–∏ */
    .section {
      display: none;
      position: absolute;
      top: 50px;
      left: 0; right: 0; bottom: 0;
      padding: 20px;
      background-size: cover;
      background-position: center;
      overflow-y: auto;
    }
    .active {
      display: block;
    }

    /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
    .gift-item {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
      border-radius: 12px;
      padding: 12px;
      margin: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
      text-align: center;
    }
    .gift-preview {
      width: 80px;
      height: 80px;
      margin: 0 auto 8px;
    }
    .gift-buttons {
      display: flex;
      gap: 6px;
    }
    .gift-buttons button {
      flex: 1;
      border: none;
      border-radius: 6px;
      padding: 6px;
      font-family: 'Minecraft';
      cursor: pointer;
      color: #fff;
    }
    .btn-sell {
      background: linear-gradient(135deg,#ff6a6a,#ff9a9e);
    }
    .btn-withdraw {
      background: linear-gradient(135deg,#4facfe,#00f2fe);
    }

    /* –ë–∞–ª–∞–Ω—Å */
    #balanceValue {
      font-size: 20px;
      margin-bottom: 20px;
    }
    .balance-option {
      margin: 10px 0;
      padding: 12px;
      border-radius: 10px;
      background: rgba(255,255,255,0.1);
      cursor: pointer;
      transition: 0.3s;
    }
    .balance-option:hover {
      background: rgba(255,255,255,0.2);
    }
    #history {
      margin-top: 20px;
    }
    .history-item {
      font-size: 14px;
      margin: 4px 0;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding-bottom: 4px;
    }
  </style>
</head>
<body>
  <!-- –õ–æ–∞–¥–µ—Ä -->
  <div id="loader">
    <h2>–ó–∞–≥—Ä—É–∑–∫–∞...</h2>
    <div id="loaderBar"><div id="loaderProgress"></div></div>
  </div>

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <nav>
    <button onclick="showSection('balance')">–ë–∞–ª–∞–Ω—Å</button>
    <button onclick="showSection('mine')">–®–∞—Ö—Ç–∞</button>
    <button onclick="showSection('mobs')">–ú–æ–±—ã</button>
    <button onclick="showSection('inventory')">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
  </nav>

  <!-- –°–µ–∫—Ü–∏–∏ -->
  <div id="balance" class="section active" style="background-image:url('backgrounds/balance.jpg')">
    <h2>–ë–∞–ª–∞–Ω—Å</h2>
    <div id="balanceValue">–ë–∞–ª–∞–Ω—Å: 0 <img src="ton.svg" style="width:16px;vertical-align:middle"></div>
    <input type="text" id="promoInput" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥">
    <button onclick="applyPromo()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
    <h3>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
    <div class="balance-option" onclick="addBalance(10)">CryptoBot +10 TON</div>
    <div class="balance-option" onclick="addBalance(20)">Ton +20 TON</div>
    <div class="balance-option" onclick="addBalance(5)">Telegram Stars +5 TON</div>
    <h3>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
    <div id="history"></div>
  </div>

  <div id="mine" class="section" style="background-image:url('backgrounds/mine.jpg')">
    <h2>–®–∞—Ö—Ç–∞</h2>
    <div id="mineGrid"></div>
  </div>

  <div id="mobs" class="section" style="background-image:url('backgrounds/mobs.jpg')">
    <h2>–ú–æ–±—ã</h2>
    <div id="mobSelect"></div>
    <canvas id="wheelCanvas" width="400" height="400"></canvas>
    <button id="spinButton">–ö—Ä—É—Ç–∏—Ç—å</button>
  </div>

  <div id="inventory" class="section" style="background-image:url('backgrounds/inventory.jpg')">
    <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
    <div id="inventoryList"></div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.7.6/lottie.min.js"></script>
  <script>
    /* üéÅ –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤ */
    const gifts = [
      {name:"Hypno Lollipop",price:1.77},{name:"Desk Calendar",price:1.31},
      {name:"B-Day Candle",price:1.32},{name:"Lol Pop",price:1.32},
      {name:"Lunar Snake",price:1.38},{name:"Snake Box",price:1.36},
      {name:"Xmas Stocking",price:1.38},{name:"Whip Cupcake",price:1.38},
      {name:"Candy Cane",price:1.48},{name:"Pet Snake",price:1.58},
      {name:"Jester Hat",price:1.62},{name:"Snoop Dogg",price:1.64},
      {name:"Homemade Cake",price:1.7},{name:"Holiday Drink",price:1.7},
      {name:"Jingle Bells",price:1.74},{name:"Cookie Heart",price:1.75},
      {name:"Big Year",price:1.78},{name:"Party Sparkler",price:1.8},
      {name:"Winter Wreath",price:1.79},{name:"Swag Bag",price:1.91},
      {name:"Tama Gadget",price:1.93},{name:"Ginger Cookie",price:1.95},
      {name:"Moon Pendant",price:1.96},{name:"Jack-in-the-Box",price:2.01},
      {name:"Spiced Wine",price:2.12},{name:"Stellar Rocket",price:2.19},
      {name:"Star Notepad",price:2.32},{name:"Easter Egg",price:2.46},
      {name:"Restless Jar",price:2.5},{name:"Santa Hat",price:2.6},
      {name:"Snow Globe",price:2.65},{name:"Hex Pot",price:2.7},
      {name:"Joyful Bundle",price:2.71},{name:"Lush Bouquet",price:2.84},
      {name:"Witch Hat",price:2.86},{name:"Light Sword",price:3.13},
      {name:"Spy Agaric",price:3.2},{name:"Bow Tie",price:3.22},
      {name:"Eternal Candle",price:3.38},{name:"Bunny Muffin",price:3.34},
      {name:"Jelly Bunny",price:3.43},{name:"Berry Box",price:3.58},
      {name:"Evil Eye",price:3.6},{name:"Snow Mittens",price:3.67},
      {name:"Valentine Box",price:4.2},{name:"Snoop Cigar",price:4.26},
      {name:"Sakura Flower",price:4.77},{name:"Hanging Star",price:5.26},
      {name:"Jolly Chimp",price:5.34},{name:"Sleigh Bell",price:7.63},
      {name:"Skull Flower",price:7.7},{name:"Crystal Ball",price:7.86},
      {name:"Record Player",price:7.91},{name:"Love Candle",price:7.94},
      {name:"Top Hat",price:7.99},{name:"Trapped Heart",price:8.69},
      {name:"Love Potion",price:8.79},{name:"Flying Broom",price:9.45},
      {name:"Cupid Charm",price:11.26},{name:"Eternal Rose",price:13.71},
      {name:"Ionic Dryer",price:14.21},{name:"Diamond Ring",price:16.39},
      {name:"Voodoo Doll",price:16.43},{name:"Mad Pumpkin",price:17.91},
      {name:"Toy Bear",price:19.3},{name:"Vintage Cigar",price:23.98},
      {name:"Low Rider",price:24.8},{name:"Signet Ring",price:25.1},
      {name:"Neko Helmet",price:26.41},{name:"Electric Skull",price:31},
      {name:"Kissed Frog",price:34},{name:"Swiss Watch",price:35},
      {name:"Sharp Tongue",price:39.69},{name:"Scared Cat",price:43.6},
      {name:"Genie Lamp",price:47.07},{name:"Westside Sign",price:51.27},
      {name:"Bonded Ring",price:54.99},{name:"Gem Signet",price:72.98},
      {name:"Magic Potion",price:72.98},{name:"Ion Gem",price:83},
      {name:"Astral Shard",price:95.97},{name:"Perfume Bottle",price:95.99},
      {name:"Loot Bag",price:90.1},{name:"Mini Oscar",price:123.89},
      {name:"Nail Bracelet",price:129.84},{name:"Heroic Helmet",price:219.99},
      {name:"Precious Peach",price:379.99},{name:"Durov‚Äôs Cap",price:794.9},
      {name:"Heart Locket",price:1450},{name:"Plush Pepe",price:5199}
    ];

    /* ====== JS ====== */
    let balance = 0;
    let history = [];
    let inventory = [];

    // === –ë–∞–ª–∞–Ω—Å ===
    function updateBalance() {
      document.getElementById("balanceValue").innerHTML =
        `–ë–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} <img src="ton.svg" style="width:16px;vertical-align:middle">`;
    }

    function addBalance(amount) {
      balance += amount;
      history.push({type: "–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ", amount: amount});
      renderHistory();
      updateBalance();
    }

    function applyPromo() {
      const code = document.getElementById("promoInput").value.trim();
      if (!code) return;
      if (code === "FREE10") {
        balance += 10;
        history.push({type: "–ü—Ä–æ–º–æ–∫–æ–¥", amount: 10});
        renderHistory();
        updateBalance();
        alert("–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! +10 TON");
      } else {
        alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥");
      }
      document.getElementById("promoInput").value = "";
    }

    function renderHistory() {
      const list = document.getElementById("history");
      list.innerHTML = "";
      history.slice().reverse().forEach(item => {
        const div = document.createElement("div");
        div.className = "history-item";
        div.textContent = `${item.type}: ${item.amount} TON`;
        list.appendChild(div);
      });
    }

    // === –°–µ–∫—Ü–∏–∏ ===
    function showSection(id) {
      document.querySelectorAll(".section").forEach(sec => sec.classList.remove("active"));
      document.getElementById(id).classList.add("active");
    }

    // === –®–∞—Ö—Ç–∞ ===
    function generateMine() {
      const mine = document.getElementById("mine");
      mine.innerHTML = "";
      for (let i = 0; i < 25; i++) {
        const block = document.createElement("div");
        block.className = "mine-block";
        block.addEventListener("click", () => mineClick(block));
        mine.appendChild(block);
      }
    }

    function mineClick(block) {
      if (block.classList.contains("opened")) return;
      block.classList.add("opened");

      if (Math.random() < 0.2) {
        // –≤—ã–ø–∞–ª –ø–æ–¥–∞—Ä–æ–∫
        const gift = gifts[Math.floor(Math.random() * gifts.length)];
        addToInventory(gift);
        block.style.background = "gold";
      } else {
        block.style.background = "#555";
      }
    }

    // === –ú–æ–±—ã (—Ä—É–ª–µ—Ç–∫–∞) ===
    const mobs = [
      {name:"–ó–æ–º–±–∏", price:1, lose:0.4, win:0.4, epicGift:"Restless Jar", colors:["#003300","#006600"]},
      {name:"–ü–∞—É–∫", price:2, lose:0.3, win:0.6, epicGift:"Witch Hat", colors:["#111111","#333333"]},
      {name:"–°–∫–µ–ª–µ—Ç", price:3, lose:0.9, win:0.0, epicGift:"Crystal Ball", colors:["#aaaaaa","#cccccc"]},
      {name:"–ö—Ä–∏–ø–µ—Ä", price:5, lose:0.7, win:0.25, epicGift:"Mad Pumpkin", colors:["#00aa00","#55ff55"]}
    ];

    function openMobGame(index) {
      const mob = mobs[index];
      document.getElementById("mobTitle").textContent = mob.name;
      drawRoulette(mob);
    }

    function drawRoulette(mob) {
      const canvas = document.getElementById("roulette");
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const sectors = [
        { label: "–ü–æ—Ä–∞–∂–µ–Ω–∏–µ", chance: mob.lose, color: "red", type: "lose" },
        { label: "–ü–æ–±–µ–¥–∞", chance: mob.win, color: mob.colors[0], type: "win" },
        { label: "–≠–ø–∏–∫", chance: 1 - mob.lose - mob.win, color: mob.colors[1], type: "epic" }
      ];

      let start = 0;
      sectors.forEach(sec => {
        const angle = sec.chance * 2 * Math.PI;
        ctx.beginPath();
        ctx.moveTo(150,150);
        ctx.arc(150,150,150,start,start+angle);
        ctx.closePath();
        ctx.fillStyle = sec.color;
        ctx.fill();
        start += angle;
      });
    }

    function spinRoulette() {
      const mobName = document.getElementById("mobTitle").textContent;
      const mob = mobs.find(m=>m.name===mobName);
      if (!mob) return;
      if (balance < mob.price) {
        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!");
        return;
      }
      balance -= mob.price;
      updateBalance();

      const rand = Math.random();
      let result;
      if (rand < mob.lose) result = "lose";
      else if (rand < mob.lose + mob.win) result = "win";
      else result = "epic";

      let gift = null;
      if (result === "win") {
        balance += mob.price * 2;
        history.push({type: "–í—ã–∏–≥—Ä—ã—à", amount: mob.price * 2});
        renderHistory();
      } else if (result === "epic") {
        gift = gifts.find(g=>g.name===mob.epicGift);
        if (gift) addToInventory(gift);
      }

      alert(`–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result}${gift ? " - " + gift.name : ""}`);
      updateBalance();
    }

    // === –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å ===
    function addToInventory(gift) {
      inventory.push(gift);
      renderInventory();
    }

    function renderInventory() {
      const inv = document.getElementById("inventoryList");
      inv.innerHTML = "";
      inventory.forEach((gift, i) => {
        const card = document.createElement("div");
        card.className = "inventory-card";
        card.innerHTML = `
          <div><strong>${gift.name}</strong><br>${gift.price} TON</div>
          <div>
            <button onclick="sellItem(${i})">–ü—Ä–æ–¥–∞—Ç—å</button>
            <button onclick="withdrawItem(${i})">–í—ã–≤–µ—Å—Ç–∏</button>
          </div>`;
        inv.appendChild(card);
      });
    }

    function sellItem(i) {
      const gift = inventory[i];
      balance += gift.price;
      history.push({type: "–ü—Ä–æ–¥–∞–∂–∞", amount: gift.price});
      renderHistory();
      inventory.splice(i,1);
      renderInventory();
      updateBalance();
    }

    function withdrawItem(i) {
      const gift = inventory[i];
      alert(`–í—ã –≤—ã–≤–µ–ª–∏: ${gift.name}`);
      inventory.splice(i,1);
      renderInventory();
    }

    // === –ó–∞–≥—Ä—É–∑—á–∏–∫ —Å –ø—Ä–æ–≥—Ä–µ—Å—Å–±–∞—Ä–æ–º ===
    function preloadAssets() {
      const assets = [
        "background.jpg","mobs/zombie.png","mobs/spider.png",
        "mobs/skeleton.png","mobs/creeper.png"
      ];
      let loaded = 0;
      const progressBar = document.getElementById("progressBar");

      return new Promise(resolve=>{
        assets.forEach(src=>{
          const img = new Image();
          img.onload = img.onerror = ()=>{
            loaded++;
            progressBar.style.width = (loaded/assets.length*100)+"%";
            if (loaded===assets.length) resolve();
          };
          img.src = src;
        });
      });
    }

    window.onload = async function() {
      await preloadAssets();
      document.getElementById("loader").style.display="none";
      showSection("mainMenu");
      updateBalance();
      renderHistory();
      generateMine();
    };
  </script>
</body>
</html>
