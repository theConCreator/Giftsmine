<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GiftsMine üéÅ</title>
  <style>
    @font-face { font-family:'Minecraft'; src:url('minecraft.ttf') format('truetype'); }
    :root{
      --panel-bg: rgba(20,20,20,0.9);
      --accent1: linear-gradient(135deg,#ff9a9e,#fad0c4);
      --accent2: linear-gradient(135deg,#6a11cb,#2575fc);
    }
    body, html {
      margin:0; padding:0; height:100%;
      font-family:'Minecraft',sans-serif; color:#fff;
      overflow:hidden; display:flex; flex-direction:column;
      background:#000; background-size:cover; background-position:center;
      transition: background 0.5s;
    }

    /* top balance bar */
    #balance {
      padding:12px 16px;
      text-align:right;
      font-size:1.1rem;
      font-weight:bold;
      background: rgba(0,0,0,0.15);
      backdrop-filter: blur(5px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    /* main pages */
    main {
      flex:1; overflow-y:auto; padding:12px; padding-bottom:84px;
      display:none; background: rgba(0,0,0,0.18);
    }
    main.active{ display:block; }
    h2{ margin:8px 0 14px 0; text-align:center; }

    /* banner */
    .banner{ width:100%; aspect-ratio:5/1; background:rgba(255,255,255,0.06); border-radius:10px; margin-bottom:12px; display:flex; align-items:center; justify-content:center; color:#ccc; overflow:hidden; }
    .banner img{ width:100%; height:100%; object-fit:cover; display:block; }

    /* tab bar */
    .tab-bar {
      position: fixed; bottom: 0; left: 0; right: 0;
      display:flex; gap:8px; padding:10px;
      background: rgba(0,0,0,0.22); border-top:2px solid rgba(255,255,255,0.08);
      z-index:1000; box-sizing:border-box;
    }
    .tab-bar button {
      flex:1; margin:0; padding:10px; border-radius:10px;
      border:none; cursor:pointer; font-weight:bold;
      background: var(--accent1); color:#fff;
    }
    .tab-bar button.active{ background: linear-gradient(135deg,#a1c4fd,#c2e9fb); }

    /* mine grid */
    .grid{ display:grid; gap:8px; justify-content:center; }
    #mineGrid{ grid-template-columns: repeat(4,minmax(60px,1fr)); }
    .block{ aspect-ratio:1/1; background:#333; border-radius:8px; overflow:hidden; background-size:cover; background-position:center; display:flex; align-items:center; justify-content:center; position:relative; cursor:pointer; }
    .block-price{ position:absolute; right:6px; bottom:6px; background:rgba(0,0,0,0.5); padding:4px 6px; font-size:0.75rem; border-radius:4px; display:flex; gap:6px; align-items:center; }

    .block.cooldown{ filter:brightness(0.5); cursor:not-allowed; }

    /* inventory items */
    .inventory-list{ display:flex; flex-direction:column; gap:12px; }
    .gift-item{ background:var(--panel-bg); padding:10px; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.45); }
    .gift-top{ display:flex; gap:12px; align-items:center; }
    .gift-preview{ width:60px; height:60px; background:#111; border-radius:8px; overflow:hidden; display:flex; align-items:center; justify-content:center; color:#ddd; font-size:0.8rem; }
    .gift-info{ display:flex; flex-direction:column; gap:4px; }
    .gift-name{ font-weight:bold; }
    .gift-price{ color:#ccc; font-size:0.9rem; }
    .gift-actions{ display:flex; gap:10px; margin-top:8px; }
    .gift-actions button{ flex:1; padding:8px; border-radius:8px; border:none; cursor:pointer; background:var(--accent1); color:#fff; font-weight:bold; }

    /* flying */
    .flying{ position:absolute; width:60px; height:60px; pointer-events:none; z-index:2000; }

    /* loader */
    #loader{ position:fixed; inset:0; display:flex; align-items:center; justify-content:center; flex-direction:column; background:#000; z-index:3000; transition:opacity .4s; }
    #loader.hidden{ opacity:0; pointer-events:none; }
    #loaderProgress{ width:60%; height:16px; background:#222; border-radius:8px; overflow:hidden; margin-top:10px; }
    #loaderProgressBar{ height:100%; width:0%; background:#ff9a9e; transition:width .25s; }

    /* BALANCE tab specific */
    .balance-wrapper{ max-width:820px; margin:0 auto; display:flex; flex-direction:column; gap:14px; }
    .balance-section{ background:var(--panel-bg); border-radius:12px; padding:12px; box-shadow:0 6px 18px rgba(0,0,0,0.5); }
    .balance-section h3{ margin:0 0 8px 0; font-size:1.05rem; text-align:left; }

    /* method row */
    .method-row{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:10px; border-radius:10px; background:rgba(255,255,255,0.03); cursor:pointer; transition:background .18s; border:1px solid rgba(255,255,255,0.03); }
    .method-row:hover{ background:rgba(255,255,255,0.06); }
    .method-left{ display:flex; align-items:center; gap:10px; }
    .method-left img{ width:28px; height:28px; display:block; }
    .method-label{ font-weight:700; }
    .method-right{ display:flex; align-items:center; gap:10px; }
    .method-percent{ color:#bfc9d9; font-weight:700; min-width:38px; text-align:right; }
    .method-action{ padding:8px 12px; border-radius:8px; border:none; background:var(--accent2); color:#fff; cursor:pointer; font-weight:700; }

    /* promo */
    .promo-row{ display:flex; gap:10px; align-items:center; }
    .promo-input{ flex:1; padding:10px 12px; border-radius:10px; border:none; outline:none; font-weight:700; background:rgba(255,255,255,0.06); color:#fff; }
    .promo-btn{ padding:10px 14px; border-radius:10px; border:none; background:#27ae60; color:#fff; font-weight:700; cursor:pointer; }

    /* history box */
    .history-box{ max-height:220px; overflow:auto; display:flex; flex-direction:column; gap:8px; padding:10px; border-radius:8px; background:rgba(255,255,255,0.03); }
    .tx-item{ font-size:0.95rem; color:#ddd; padding:6px 8px; border-radius:6px; background:rgba(0,0,0,0.12); }

    /* responsive */
    @media (max-width:680px){
      .balance-wrapper{ padding:0 6px; }
      .method-left span, .method-percent{ font-size:0.92rem; }
    }
  </style>
</head>
<body>
  <div id="loader">
    <div id="loaderAnimation"></div>
    <div id="loaderProgress"><div id="loaderProgressBar"></div></div>
    <p style="color:#fff;margin-top:8px">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤...</p>
  </div>

  <div id="balance">–ë–∞–ª–∞–Ω—Å: 10000 <img src="ton.svg" style="width:16px;vertical-align:middle"></div>

  <!-- MAIN PAGES -->
  <main id="menu" class="active">
    <h2>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h2>
    <a href="https://t.me/theConCreator" target="_blank" class="banner">
      <img src="images/banner.jpg" alt="–†–µ–∫–ª–∞–º–∞ –±–∞–Ω–Ω–µ—Ä">
    </a>
    <p style="text-align:center;color:#bbb">–í—ã–±–∏—Ä–∞–π —Ä–µ–∂–∏–º –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –ø–æ–¥–∞—Ä–∫–∏!</p>
  </main>

  <main id="mine">
    <h2>–®–∞—Ö—Ç–∞ ‚õèÔ∏è</h2>
    <div id="brokenBlocks" style="text-align:center;margin-bottom:12px">–°–ª–æ–º–∞–Ω–æ –±–ª–æ–∫–æ–≤: 0</div>
    <div class="grid" id="mineGrid"></div>
  </main>

  <main id="inventory">
    <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å üéí</h2>
    <div class="inventory-list" id="inventoryList"></div>
  </main>

  <!-- NEW BALANCE TAB LAYOUT -->
  <main id="balanceTab">
    <h2>–ë–∞–ª–∞–Ω—Å üí∞</h2>

    <div class="balance-wrapper">
      <!-- POPOLNENIE -->
      <div class="balance-section">
        <h3>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>

        <!-- Ton –∫–æ—à–µ–ª—ë–∫ -->
        <div class="method-row" onclick="addBalance('ton',0)">
          <div class="method-left">
            <img src="icons/ton.svg" alt="TON">
            <span class="method-label">Ton –∫–æ—à–µ–ª—ë–∫</span>
          </div>
          <div class="method-right">
            <span class="method-percent">0%</span>
            <button class="method-action" onclick="addBalance('ton',0); event.stopPropagation();">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
          </div>
        </div>

        <!-- Crypto bot -->
        <div class="method-row" onclick="addBalance('crypto',5)">
          <div class="method-left">
            <img src="icons/crypto.svg" alt="Crypto">
            <span class="method-label">Crypto bot</span>
          </div>
          <div class="method-right">
            <span class="method-percent">5%</span>
            <button class="method-action" onclick="addBalance('crypto',5); event.stopPropagation();">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
          </div>
        </div>

        <!-- Telegram Stars -->
        <div class="method-row" onclick="addBalance('stars',20)">
          <div class="method-left">
            <img src="icons/stars.svg" alt="Stars">
            <span class="method-label">Telegram Stars</span>
          </div>
          <div class="method-right">
            <span class="method-percent">20%</span>
            <button class="method-action" onclick="addBalance('stars',20); event.stopPropagation();">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
          </div>
        </div>
      </div>

      <!-- PROMO -->
      <div class="balance-section">
        <h3>–ü—Ä–æ–º–æ–∫–æ–¥</h3>
        <div class="promo-row">
          <input id="promoInput" class="promo-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" />
          <button class="promo-btn" onclick="redeemPromo()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>
      </div>

      <!-- HISTORY -->
      <div class="balance-section">
        <h3>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
        <div id="transactionHistory" class="history-box">
          <!-- —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç —Ç—É—Ç -->
        </div>
      </div>
    </div>
  </main>

  <!-- tab bar -->
  <div class="tab-bar">
    <button onclick="showTab('menu')" id="tab-menu" class="active">–ú–µ–Ω—é</button>
    <button onclick="showTab('mine')" id="tab-mine">–®–∞—Ö—Ç–∞</button>
    <button onclick="showTab('inventory')" id="tab-inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
    <button onclick="showTab('balanceTab')" id="tab-balanceTab">–ë–∞–ª–∞–Ω—Å</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>
  <script>
    // --- loader animation (Lottie) ---
    let loaderAnim = lottie.loadAnimation({ container: document.getElementById('loaderAnimation'), renderer:'svg', loop:true, autoplay:true, path:'animations/myLoader.json' });

    // --- state ---
    let balance = 10000;
    let transactions = []; // newest first (we'll unshift)
    let inventory = [];
    let brokenBlocks = 0;
    let firstMineCount = 0;

    // --- UI helpers ---
    function updateBalance(){
      document.getElementById('balance').innerHTML = `–ë–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} <img src="ton.svg" style="width:16px;vertical-align:middle">`;
    }

    function updateTransactionHistory(){
      const el = document.getElementById('transactionHistory');
      el.innerHTML = '';
      // transactions array stores newest first (unshift). Show as-is (newest on top).
      transactions.forEach(tx => {
        const div = document.createElement('div');
        div.className = 'tx-item';
        div.innerText = tx;
        el.appendChild(div);
      });
    }

    function updateBrokenBlocks(){
      document.getElementById('brokenBlocks').textContent = `–°–ª–æ–º–∞–Ω–æ –±–ª–æ–∫–æ–≤: ${brokenBlocks}`;
    }

    // --- tabs & backgrounds ---
    const backgrounds = { menu:'images/menu.jpg', mine:'images/mine.jpg', inventory:'images/inventory.jpg', balanceTab:'images/mobs.jpg' };
    document.body.style.backgroundImage = `url(${backgrounds.menu})`;

    function showTab(id){
      document.querySelectorAll('main').forEach(m=>m.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('.tab-bar button').forEach(b=>b.classList.remove('active'));
      document.getElementById('tab-'+id).classList.add('active');
      document.body.style.backgroundImage = `url(${backgrounds[id]})`;
      if(id === 'inventory') renderInventory();
    }

    // --- gifts (complete list) ---
    const gifts = [
      {name:"Hypno Lollipop",price:1.77}, {name:"Desk Calendar",price:1.31},
      {name:"B-Day Candle",price:1.32}, {name:"Lol Pop",price:1.32},
      {name:"Lunar Snake",price:1.38}, {name:"Snake Box",price:1.36},
      {name:"Xmas Stocking",price:1.38}, {name:"Whip Cupcake",price:1.38},
      {name:"Candy Cane",price:1.48}, {name:"Pet Snake",price:1.58},
      {name:"Jester Hat",price:1.62}, {name:"Snoop Dogg",price:1.64},
      {name:"Homemade Cake",price:1.7}, {name:"Holiday Drink",price:1.7},
      {name:"Jingle Bells",price:1.74}, {name:"Cookie Heart",price:1.75},
      {name:"Big Year",price:1.78}, {name:"Party Sparkler",price:1.8},
      {name:"Winter Wreath",price:1.79}, {name:"Swag Bag",price:1.91},
      {name:"Tama Gadget",price:1.93}, {name:"Ginger Cookie",price:1.95},
      {name:"Moon Pendant",price:1.96}, {name:"Jack-in-the-Box",price:2.01},
      {name:"Spiced Wine",price:2.12}, {name:"Stellar Rocket",price:2.19},
      {name:"Star Notepad",price:2.32}, {name:"Easter Egg",price:2.46},
      {name:"Restless Jar",price:2.5}, {name:"Santa Hat",price:2.6},
      {name:"Snow Globe",price:2.65}, {name:"Hex Pot",price:2.7},
      {name:"Joyful Bundle",price:2.71}, {name:"Lush Bouquet",price:2.84},
      {name:"Witch Hat",price:2.86}, {name:"Light Sword",price:3.13},
      {name:"Spy Agaric",price:3.2}, {name:"Bow Tie",price:3.22},
      {name:"Eternal Candle",price:3.38}, {name:"Bunny Muffin",price:3.34},
      {name:"Jelly Bunny",price:3.43}, {name:"Berry Box",price:3.58},
      {name:"Evil Eye",price:3.6}, {name:"Snow Mittens",price:3.67},
      {name:"Valentine Box",price:4.2}, {name:"Snoop Cigar",price:4.26},
      {name:"Sakura Flower",price:4.77}, {name:"Hanging Star",price:5.26},
      {name:"Jolly Chimp",price:5.34}, {name:"Sleigh Bell",price:7.63},
      {name:"Skull Flower",price:7.7}, {name:"Crystal Ball",price:7.86},
      {name:"Record Player",price:7.91}, {name:"Love Candle",price:7.94},
      {name:"Top Hat",price:7.99}, {name:"Trapped Heart",price:8.69},
      {name:"Love Potion",price:8.79}, {name:"Flying Broom",price:9.45},
      {name:"Cupid Charm",price:11.26}, {name:"Eternal Rose",price:13.71},
      {name:"Ionic Dryer",price:14.21}, {name:"Diamond Ring",price:16.39},
      {name:"Voodoo Doll",price:16.43}, {name:"Mad Pumpkin",price:17.91},
      {name:"Toy Bear",price:19.3}, {name:"Vintage Cigar",price:23.98},
      {name:"Low Rider",price:24.8}, {name:"Signet Ring",price:25.1},
      {name:"Neko Helmet",price:26.41}, {name:"Electric Skull",price:31},
      {name:"Kissed Frog",price:34}, {name:"Swiss Watch",price:35},
      {name:"Sharp Tongue",price:39.69}, {name:"Scared Cat",price:43.6},
      {name:"Genie Lamp",price:47.07}, {name:"Westside Sign",price:51.27},
      {name:"Bonded Ring",price:54.99}, {name:"Gem Signet",price:72.98},
      {name:"Magic Potion",price:72.98}, {name:"Ion Gem",price:83},
      {name:"Astral Shard",price:95.97}, {name:"Perfume Bottle",price:95.99},
      {name:"Loot Bag",price:90.1}, {name:"Mini Oscar",price:123.89},
      {name:"Nail Bracelet",price:129.84}, {name:"Heroic Helmet",price:219.99},
      {name:"Precious Peach",price:379.99}, {name:"Durov‚Äôs Cap",price:794.9},
      {name:"Heart Locket",price:1450}, {name:"Plush Pepe",price:5199}
    ];

    // ores
    const oreTypes = [
      {img:"images/ores/coal.png",hits:3},
      {img:"images/ores/iron.png",hits:4},
      {img:"images/ores/gold.png",hits:5},
      {img:"images/ores/diamond.png",hits:6},
      {img:"images/ores/emerald.png",hits:7}
    ];

    // preloaded animation map
    const animationMap = {};

    // choose gift by price; for first two mined blocks we limit max to 2x
    function getGiftByPrice(price, isFirst=false){
      let min = price * 0.5;
      let max = price * 1.45;
      if (firstMineCount < 2 && isFirst) max = price * 2;
      let possible = gifts.filter(g => g.price >= min && g.price <= max);
      if (isFirst && possible.length === 0) possible = gifts.filter(g => g.price >= price);
      if (possible.length === 0) possible = gifts;
      return possible[Math.floor(Math.random()*possible.length)];
    }

    // spawn block
    function spawnBlock(cell,index=0){
      const ore = oreTypes[Math.floor(Math.random()*oreTypes.length)];
      let price = +(1 + Math.random()*10).toFixed(2);
      cell.className = "block";
      cell.style.backgroundImage = `url(${ore.img})`;
      cell.innerHTML = `<div class="block-price">${price}<img src="ton.svg" style="width:12px;vertical-align:middle"></div>`;
      let hits = 0;
      cell.onclick = () => {
        hits++;
        if (hits >= ore.hits) {
          brokenBlocks++; updateBrokenBlocks();
          if (balance >= price) { balance -= price; updateBalance(); }
          let gift = getGiftByPrice(price, index===0);
          inventory.push(gift); renderInventory();
          flyGift(gift, cell);
          firstMineCount++;
          let respawn = (60 + Math.random()*1740) * 1000;
          cell.classList.add("cooldown");
          cell.innerHTML = `<div style="position:absolute;top:2px;left:2px;font-size:0.7em;">${Math.round(respawn/60000)}m</div>`;
          cell.onclick = null;
          setTimeout(()=>{ cell.classList.remove("cooldown"); spawnBlock(cell,index); }, respawn);
        }
      };
    }

    function generateMineGrid(){
      const grid = document.getElementById('mineGrid'); grid.innerHTML = '';
      for(let i=0;i<16;i++){
        const cell = document.createElement('div');
        spawnBlock(cell,i);
        grid.appendChild(cell);
      }
    }

    // flyGift ‚Äî start at center of block, end at center of Inventory tab button
    function flyGift(gift, fromCell){
      const rect = fromCell.getBoundingClientRect();
      const invBtnRect = document.getElementById('tab-inventory').getBoundingClientRect();

      const fly = document.createElement('div');
      fly.className = 'flying';
      // start: centered on block
      fly.style.left = (rect.left + rect.width/2 - 30) + 'px';
      fly.style.top  = (rect.top  + rect.height/2 - 30) + 'px';
      document.body.appendChild(fly);

      // try to load animation (if available)
      const animPath = `emoji/${gift.name}.json`;
      try {
        lottie.loadAnimation({ container: fly, renderer:'svg', loop:true, autoplay:true, path: animPath });
      } catch(e){
        fly.textContent = gift.name;
        fly.style.display = 'flex';
        fly.style.alignItems = 'center';
        fly.style.justifyContent = 'center';
        fly.style.fontSize = '0.75rem';
      }

      // target center of inventory button
      const targetX = invBtnRect.left + invBtnRect.width/2 - 30;
      const targetY = invBtnRect.top  + invBtnRect.height/2 - 30;

      const dx = targetX - (rect.left + rect.width/2 - 30);
      const dy = targetY - (rect.top  + rect.height/2 - 30);

      fly.animate([
        { transform: 'translate(0,0)' },
        { transform: `translate(${dx}px, ${dy}px)` }
      ], { duration: 900, easing: 'cubic-bezier(.22,.8,.18,1)' });

      setTimeout(()=>{ fly.remove(); }, 920);
    }

    // render inventory
    function renderInventory(){
      const list = document.getElementById('inventoryList'); list.innerHTML = '';
      inventory.forEach((gift, idx) => {
        const div = document.createElement('div'); div.className='gift-item';
        const top = document.createElement('div'); top.className='gift-top';
        const prev = document.createElement('div'); prev.className='gift-preview';
        if(animationMap[gift.name]){
          try{ lottie.loadAnimation({ container:prev, renderer:'svg', loop:true, autoplay:true, path: animationMap[gift.name] }); }catch(e){}
        } else {
          prev.textContent = gift.name;
        }
        const info = document.createElement('div'); info.className='gift-info';
        info.innerHTML = `<div class="gift-name">${gift.name}</div><div class="gift-price">–¶–µ–Ω–∞: ${gift.price.toFixed(2)} <img src="ton.svg" style="width:12px;vertical-align:middle"></div>`;
        top.appendChild(prev); top.appendChild(info);
        const actions = document.createElement('div'); actions.className='gift-actions';
        const sell = document.createElement('button'); sell.textContent='–ü—Ä–æ–¥–∞—Ç—å';
        sell.onclick = () => {
          balance += gift.price; updateBalance();
          inventory.splice(idx,1); renderInventory();
          transactions.unshift(`–ü—Ä–æ–¥–∞–∂–∞: ${gift.name} +${gift.price.toFixed(2)} TON`);
          updateTransactionHistory();
        };
        const withdraw = document.createElement('button'); withdraw.textContent='–í—ã–≤–µ—Å—Ç–∏';
        withdraw.onclick = () => {
          alert('–í—ã–≤–æ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω!');
          inventory.splice(idx,1); renderInventory();
          transactions.unshift(`–í—ã–≤–æ–¥: ${gift.name}`);
          updateTransactionHistory();
        };
        actions.appendChild(sell); actions.appendChild(withdraw);
        div.appendChild(top); div.appendChild(actions);
        list.appendChild(div);
      });
    }

    // promo
    function redeemPromo(){
      const code = document.getElementById('promoInput') ? document.getElementById('promoInput').value.trim() : document.getElementById('promoCode') && document.getElementById('promoCode').value.trim();
      if(code === 'BONUS10'){
        balance += 10; updateBalance();
        transactions.unshift('–ü—Ä–æ–º–æ–∫–æ–¥: +10 TON');
        updateTransactionHistory();
        alert('–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!');
      } else {
        transactions.unshift(`–ü—Ä–æ–º–æ–∫–æ–¥: –Ω–µ–≤–µ—Ä–Ω—ã–π (${code || '–ø—É—Å—Ç–æ'})`);
        updateTransactionHistory();
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥');
      }
    }

    // add balance (method: 'ton'|'crypto'|'stars', feePerc number)
    function addBalance(method, feePerc){
      const amount = 100; // demo amount
      balance += amount; updateBalance();
      transactions.unshift(`–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ ${method}: +${amount} TON (–∫–æ–º–∏—Å—Å–∏—è ${feePerc}%)`);
      updateTransactionHistory();
      alert(`–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω —á–µ—Ä–µ–∑ ${method}: +${amount} TON`);
    }

    // --- Preload images and lottie JSONs (skip missing quietly) ---
    function preloadAssets(){
      const imagePaths = [...Object.values(backgrounds), 'ton.svg', ...oreTypes.map(o=>o.img)];
      const lottiePaths = gifts.map(g => ({name: g.name, path: `emoji/${g.name}.json`}));
      const total = imagePaths.length + lottiePaths.length;
      let loaded = 0;
      const prog = p => { document.getElementById('loaderProgressBar').style.width = Math.round(p*100) + '%'; };

      const imgPromises = imagePaths.map(src => new Promise(res => {
        const img = new Image();
        img.onload = img.onerror = function(){ loaded++; prog(loaded/total); res(); };
        img.src = src;
      }));

      const lottiePromises = lottiePaths.map(item =>
        fetch(item.path)
          .then(r => r.ok ? r.blob() : null)
          .then(blob => { if(blob){ animationMap[item.name] = URL.createObjectURL(blob); } loaded++; prog(loaded/total); })
          .catch(()=>{ loaded++; prog(loaded/total); })
      );

      return Promise.all([...imgPromises, ...lottiePromises]);
    }

    // init
    preloadAssets().then(()=> {
      setTimeout(()=> {
        document.getElementById('loader').classList.add('hidden');
        generateMineGrid();
        updateBalance();
        updateTransactionHistory();
        updateBrokenBlocks();
        document.body.style.backgroundImage = `url(${backgrounds.menu})`;
      }, 350);
    });

    // expose showTab to global
    window.showTab = showTab;

  </script>
</body>
</html>
