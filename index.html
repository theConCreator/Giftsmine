<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GiftsMine üéÅ</title>
<style>
@font-face {
    font-family: 'Minecraft';
    src: url('minecraft.ttf') format('truetype');
}
body, html {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Minecraft', sans-serif;
    color: #fff; overflow: hidden;
    display: flex; flex-direction: column;
    background: #000; background-size: cover; background-position: center;
    transition: background 0.5s;
}
#balance {
    padding: 15px; text-align: right; font-size: 1.2em; font-weight: bold;
    background: rgba(0,0,0,0.15); backdrop-filter: blur(5px); box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
main {
    flex: 1; overflow-y: auto; padding: 10px; margin-bottom: 60px;
    display: none; background: rgba(0,0,0,0.2);
}
main.active { display: block; }
.tab-bar {
    position: fixed; bottom: 0; width: 100%; display: flex; justify-content: space-around;
    background: rgba(0,0,0,0.2); padding: 10px; border-top: 2px solid #fff; z-index: 1000;
}
.tab-bar button {
    flex: 1; margin: 0 5px; padding: 10px; border: none;
    background: linear-gradient(135deg,#ff9a9e,#fad0c4); color: #fff;
    font-weight: bold; cursor: pointer; transition: 0.3s; font-size: 1em;
}
.tab-bar button.active {
    background: linear-gradient(135deg,#a1c4fd,#c2e9fb);
}
.grid { display: grid; gap: 5px; justify-content: center; }
#mineGrid { grid-template-columns: repeat(4, minmax(60px,1fr)); }
.block {
    aspect-ratio: 1/1; background: #333;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: 0.2s; position: relative; overflow: hidden;
    background-size: cover; background-position: center; border-radius: 6px;
}
.block-price {
    position: absolute; bottom: 2px; right: 2px;
    background: rgba(0,0,0,0.5); padding: 2px 4px; font-size: 0.7em;
    border-radius: 2px; display: flex; align-items: center; gap: 2px;
}
.block.cooldown { filter: brightness(0.5); cursor: not-allowed; }
.inventory-list { display: flex; flex-direction: column; gap: 12px; }
.gift-item {
    display: flex; flex-direction: column;
    background: rgba(20,20,20,0.9); border-radius: 10px; padding: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.5); color: #fff;
}
.gift-top { display: flex; gap: 10px; align-items: center; margin-bottom: 8px; }
.gift-preview { width: 60px; height: 60px; flex-shrink: 0; border-radius: 6px; overflow: hidden; background: #111; }
.gift-info { display: flex; flex-direction: column; justify-content: center; gap: 4px; flex-grow: 1; }
.gift-name { font-size: 1em; font-weight: bold; }
.gift-price { font-size: 0.9em; color: #ccc; }
.gift-actions { display: flex; gap: 10px; margin-top: 6px; }
.gift-actions button {
    flex: 1; padding: 6px; border: none; border-radius: 6px; font-size: 0.85em; cursor: pointer;
    color: #fff; background: linear-gradient(135deg,#ff9a9e,#fad0c4); transition: 0.3s;
}
.gift-actions button:hover { filter: brightness(1.1); }
#loader {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    display: flex; align-items: center; justify-content: center; flex-direction: column;
    z-index: 9999; background: #000; transition: opacity 0.6s ease;
}
#loader.hidden { opacity: 0; pointer-events: none; }
#loaderAnimation { width: 150px; height: 150px; margin-bottom: 20px; }
#loaderProgress { width: 60%; height: 20px; background: #444; border-radius: 10px; overflow: hidden; margin-top: 10px; }
#loaderProgressBar { width: 0%; height: 100%; background: #ff9a9e; }
@media (max-width:500px) {
    .tab-bar button { font-size: 0.85em; padding: 8px; }
    #balance { font-size: 1em; padding: 10px; }
    #mineGrid{gap:3px;}
}
</style>
</head>
<body>

<div id="loader">
    <div id="loaderAnimation"></div>
    <div id="loaderProgress"><div id="loaderProgressBar"></div></div>
    <p style="color:#fff;font-size:1.2em;">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤...</p>
</div>

<div id="balance">–ë–∞–ª–∞–Ω—Å: 10000 <img src="ton.svg" style="width:16px;vertical-align:middle"></div>

<main id="menu" class="active">
<h2>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h2>
<p>–í—ã–±–∏—Ä–∞–π —Ä–µ–∂–∏–º –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –ø–æ–¥–∞—Ä–∫–∏!</p>
</main>

<main id="mine">
<h2>–®–∞—Ö—Ç–∞ ‚õèÔ∏è</h2>
<div class="grid" id="mineGrid"></div>
</main>

<main id="inventory">
<h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å üéí</h2>
<div class="inventory-list" id="inventoryList"></div>
</main>

<main id="balanceTab">
<h2>–ë–∞–ª–∞–Ω—Å üí∞</h2>
<div style="margin-bottom:15px;">
    <label>–ü—Ä–æ–º–æ–∫–æ–¥: <input type="text" id="promoCode"><button onclick="redeemPromo()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button></label>
</div>
<div style="margin-bottom:15px;">
    <button onclick="addBalance('crypto')">–ü–æ–ø–æ–ª–Ω–∏—Ç—å CryptoBot</button>
    <button onclick="addBalance('ton')">–ü–æ–ø–æ–ª–Ω–∏—Ç—å TON</button>
    <button onclick="addBalance('stars')">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –ó–≤—ë–∑–¥—ã</button>
</div>
<div id="transactionHistory"></div>
</main>

<div class="tab-bar">
<button onclick="showTab('menu')" id="tab-menu" class="active">–ú–µ–Ω—é</button>
<button onclick="showTab('mine')" id="tab-mine">–®–∞—Ö—Ç–∞</button>
<button onclick="showTab('inventory')" id="tab-inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
<button onclick="showTab('balanceTab')" id="tab-balanceTab">–ë–∞–ª–∞–Ω—Å</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>
<script>
// --- –õ–æ–∞–¥–µ—Ä ---
let loaderAnim = lottie.loadAnimation({
    container: document.getElementById('loaderAnimation'),
    renderer: 'svg',
    loop: true,
    autoplay: true,
    path: 'animations/myLoader.json'
});

// --- –ë–∞–ª–∞–Ω—Å ---
let balance = 10000;
let transactions = [];
function updateBalance(){
    document.getElementById('balance').innerHTML =
        `–ë–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} <img src="ton.svg" style="width:16px;vertical-align:middle">`;
}

// --- –í–∫–ª–∞–¥–∫–∏ ---
const backgrounds = {
    menu: 'images/menu.jpg',
    mine: 'images/mine.jpg',
    inventory: 'images/inventory.jpg',
    balanceTab: 'images/mobs.jpg'
};
function showTab(id){
    document.querySelectorAll('main').forEach(m => m.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    document.querySelectorAll('.tab-bar button').forEach(b => b.classList.remove('active'));
    document.getElementById('tab-'+id).classList.add('active');
    document.body.style.backgroundImage = `url(${backgrounds[id]})`;
    if(id==='inventory') renderInventory();
}

// --- –ü–æ–¥–∞—Ä–∫–∏ ---
const gifts=[ /* –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤ (–∫–∞–∫ —É —Ç–µ–±—è) */ 
    {name:"Hypno Lollipop",price:1.77}, {name:"Desk Calendar",price:1.31}, 
    {name:"B-Day Candle",price:1.32}, {name:"Lol Pop",price:1.32}, 
    {name:"Lunar Snake",price:1.38}, {name:"Snake Box",price:1.36}, 
    {name:"Xmas Stocking",price:1.38}, {name:"Whip Cupcake",price:1.38}, 
    {name:"Candy Cane",price:1.48}, {name:"Pet Snake",price:1.58}, 
    {name:"Jester Hat",price:1.62}, {name:"Snoop Dogg",price:1.64}, 
    {name:"Homemade Cake",price:1.7}, {name:"Holiday Drink",price:1.7}, 
    {name:"Jingle Bells",price:1.74}, {name:"Cookie Heart",price:1.75}, 
    {name:"Big Year",price:1.78}, {name:"Party Sparkler",price:1.8}, 
    {name:"Winter Wreath",price:1.79}, {name:"Swag Bag",price:1.91}, 
    {name:"Tama Gadget",price:1.93}, {name:"Ginger Cookie",price:1.95}, 
    {name:"Moon Pendant",price:1.96}, {name:"Jack-in-the-Box",price:2.01}, 
    {name:"Spiced Wine",price:2.12}, {name:"Stellar Rocket",price:2.19}, 
    {name:"Star Notepad",price:2.32}, {name:"Easter Egg",price:2.46}, 
    {name:"Restless Jar",price:2.5}, {name:"Santa Hat",price:2.6}, 
    {name:"Snow Globe",price:2.65}, {name:"Hex Pot",price:2.7}, 
    {name:"Joyful Bundle",price:2.71}, {name:"Lush Bouquet",price:2.84}, 
    {name:"Witch Hat",price:2.86}, {name:"Light Sword",price:3.13}, 
    {name:"Spy Agaric",price:3.2}, {name:"Bow Tie",price:3.22}, 
    {name:"Eternal Candle",price:3.38}, {name:"Bunny Muffin",price:3.34}, 
    {name:"Jelly Bunny",price:3.43}, {name:"Berry Box",price:3.58}, 
    {name:"Evil Eye",price:3.6}, {name:"Snow Mittens",price:3.67}, 
    {name:"Valentine Box",price:4.2}, {name:"Snoop Cigar",price:4.26}, 
    {name:"Sakura Flower",price:4.77}, {name:"Hanging Star",price:5.26}, 
    {name:"Jolly Chimp",price:5.34}, {name:"Sleigh Bell",price:7.63}, 
    {name:"Skull Flower",price:7.7}, {name:"Crystal Ball",price:7.86}, 
    {name:"Record Player",price:7.91}, {name:"Love Candle",price:7.94}, 
    {name:"Top Hat",price:7.99}, {name:"Trapped Heart",price:8.69}, 
    {name:"Love Potion",price:8.79}, {name:"Flying Broom",price:9.45}, 
    {name:"Cupid Charm",price:11.26}, {name:"Eternal Rose",price:13.71}, 
    {name:"Ionic Dryer",price:14.21}, {name:"Diamond Ring",price:16.39}, 
    {name:"Voodoo Doll",price:16.43}, {name:"Mad Pumpkin",price:17.91}, 
    {name:"Toy Bear",price:19.3}, {name:"Vintage Cigar",price:23.98}, 
    {name:"Low Rider",price:24.8}, {name:"Signet Ring",price:25.1}, 
    {name:"Neko Helmet",price:26.41}, {name:"Electric Skull",price:31}, 
    {name:"Kissed Frog",price:34}, {name:"Swiss Watch",price:35}, 
    {name:"Sharp Tongue",price:39.69}, {name:"Scared Cat",price:43.6}, 
    {name:"Genie Lamp",price:47.07}, {name:"Westside Sign",price:51.27}, 
    {name:"Bonded Ring",price:54.99}, {name:"Gem Signet",price:72.98}, 
    {name:"Magic Potion",price:72.98}, {name:"Ion Gem",price:83}, 
    {name:"Astral Shard",price:95.97}, {name:"Perfume Bottle",price:95.99}, 
    {name:"Loot Bag",price:90.1}, {name:"Mini Oscar",price:123.89}, 
    {name:"Nail Bracelet",price:129.84}, {name:"Heroic Helmet",price:219.99}, 
    {name:"Precious Peach",price:379.99}, {name:"Durov‚Äôs Cap",price:794.9}, 
    {name:"Heart Locket",price:1450}, {name:"Plush Pepe",price:5199}
];
let inventory = [];
let giftAnimations = {}; // –∫—ç—à –∞–Ω–∏–º–∞—Ü–∏–π

// --- –®–∞—Ö—Ç–∞ 4x4 ---
const oreTypes = [
  { img: "images/ores/coal.png", hits: 3 },
  { img: "images/ores/iron.png", hits: 4 },
  { img: "images/ores/gold.png", hits: 5 },
  { img: "images/ores/diamond.png", hits: 6 },
  { img: "images/ores/emerald.png", hits: 7 }
];

function getGiftByPrice(price, isFirst = false) {
  let min = price * 0.5, max = price * 1.45;
  let possible = gifts.filter(g => g.price >= min && g.price <= max);
  if (isFirst) {
    possible = gifts.filter(g => g.price >= price);
    if (possible.length === 0) possible = gifts;
  }
  if (possible.length === 0) possible = gifts;
  return possible[Math.floor(Math.random() * possible.length)];
}

function spawnBlock(cell, index = 0) {
  const ore = oreTypes[Math.floor(Math.random() * oreTypes.length)];
  let price = +(1 + Math.random() * 10).toFixed(2);

  cell.className = "block";
  cell.style.backgroundImage = `url(${ore.img})`;
  cell.innerHTML = `<div class="block-price">${price}<img src="ton.svg" style="width:12px;vertical-align:middle"></div>`;

  let hits = 0;
  cell.onclick = () => {
    hits++;
    if (hits >= ore.hits) {
      if (balance >= price) {
        balance -= price;
        updateBalance();
      }
      let gift = getGiftByPrice(price, index === 0);
      inventory.push(gift);
      renderInventory();
      flyGift(gift, cell);

      let respawn = (60 + Math.random() * 1740) * 1000;
      cell.classList.add("cooldown");
      cell.innerHTML = `<div style="position:absolute;top:2px;left:2px;font-size:0.7em;">${Math.round(respawn / 60000)}m</div>`;
      cell.onclick = null;

      setTimeout(() => {
        cell.classList.remove("cooldown");
        spawnBlock(cell, index);
      }, respawn);
    }
  };
}

function generateMineGrid() {
  const grid = document.getElementById("mineGrid");
  grid.innerHTML = "";
  for (let i = 0; i < 16; i++) {
    let cell = document.createElement("div");
    spawnBlock(cell, i);
    grid.appendChild(cell);
  }
}

// --- –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥–∞—Ä–∫–∞ ---
function flyGift(gift, fromCell) {
  const rect = fromCell.getBoundingClientRect();
  const fly = document.createElement("div");
  fly.className = "flying";
  fly.style.position = "absolute";
  fly.style.left = rect.left + "px";
  fly.style.top = rect.top + "px";
  fly.style.width = "60px";
  fly.style.height = "60px";
  document.body.appendChild(fly);

  lottie.loadAnimation({
    container: fly,
    renderer: "svg",
    loop: false,
    autoplay: true,
    animationData: giftAnimations[gift.name]
  });

  const inv = document.getElementById("tab-inventory").getBoundingClientRect();

  fly.animate(
    [
      { transform: `translate(0,0) scale(1)` },
      { transform: `translate(${inv.left - rect.left}px, ${inv.top - rect.top}px) scale(0.3)` }
    ],
    { duration: 1000, easing: "ease-in-out" }
  );

  setTimeout(() => fly.remove(), 1000);
}

// --- –†–µ–Ω–¥–µ—Ä –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è ---
function renderInventory() {
  let list = document.getElementById("inventoryList");
  list.innerHTML = "";
  inventory.forEach((gift, i) => {
    let item = document.createElement("div");
    item.className = "gift-item";
    item.innerHTML = `
      <div class="gift-top">
        <div class="gift-preview" id="gift-preview-${i}"></div>
        <div class="gift-info">
          <div class="gift-name">${gift.name}</div>
          <div class="gift-price">${gift.price.toFixed(2)} <img src="ton.svg" style="width:14px;vertical-align:middle"></div>
        </div>
      </div>
      <div class="gift-actions">
        <button onclick="sellGift(${i})">–ü—Ä–æ–¥–∞—Ç—å</button>
        <button onclick="sendGift(${i})">–ü–µ—Ä–µ–¥–∞—Ç—å</button>
        <button onclick="useGift(${i})">–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</button>
      </div>`;
    list.appendChild(item);

    let container = item.querySelector(`#gift-preview-${i}`);
    lottie.loadAnimation({
      container: container,
      renderer: "svg",
      loop: true,
      autoplay: true,
      animationData: giftAnimations[gift.name]
    });
  });
}

function sellGift(i) {
  let gift = inventory[i];
  balance += gift.price;
  transactions.push(`–ü—Ä–æ–¥–∞–∂–∞ ${gift.name} –∑–∞ ${gift.price}`);
  inventory.splice(i, 1);
  updateBalance(); renderInventory();
}
function sendGift(i) {
  let gift = inventory[i];
  transactions.push(`–ü–µ—Ä–µ–¥–∞–Ω ${gift.name}`);
  inventory.splice(i, 1); renderInventory();
}
function useGift(i) {
  let gift = inventory[i];
  transactions.push(`–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω ${gift.name}`);
  inventory.splice(i, 1); renderInventory();
}

// --- –ë–∞–ª–∞–Ω—Å –≤–∫–ª–∞–¥–∫–∞ ---
function redeemPromo(){
    let code=document.getElementById('promoCode').value.trim();
    if(code==="FREE100"){
        balance+=100;transactions.push("–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –ø—Ä–æ–º–æ–∫–æ–¥ FREE100");
    }
    updateBalance();document.getElementById('promoCode').value="";
}
function addBalance(method){
    let amt=+(prompt("–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è:","100"))||0;
    if(amt>0){balance+=amt;transactions.push(`–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ ${method}: +${amt}`);}
    updateBalance();
}

// --- –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ ---
function preloadImages(paths, onProgress){
    let loaded=0; return Promise.all(paths.map(src=>new Promise(res=>{
        const img=new Image(); img.onload=img.onerror=function(){ loaded++; onProgress(loaded/paths.length); res(); }; img.src=src;
    })));
}
function preloadGiftAnimations(onProgress) {
    let loaded = 0;
    return Promise.all(
        gifts.map(gift => new Promise(res => {
            fetch(`animations/${gift.name}.json`)
                .then(r => r.json())
                .then(data => {
                    giftAnimations[gift.name] = data;
                })
                .catch(()=>{})
                .finally(() => {
                    loaded++;
                    onProgress(loaded / gifts.length);
                    res();
                });
        }))
    );
}
function preloadAssets(){
    const imagePaths=[ ...Object.values(backgrounds),"ton.svg", ...oreTypes.map(o=>o.img) ];
    let totalProgress = 0;

    preloadImages(imagePaths,p=>{
        totalProgress = p * 0.5;
        document.getElementById("loaderProgressBar").style.width=(totalProgress*100)+"%";
    }).then(()=>{
        return preloadGiftAnimations(p=>{
            totalProgress = 0.5 + p * 0.5;
            document.getElementById("loaderProgressBar").style.width=(totalProgress*100)+"%";
        });
    }).then(()=>{
        setTimeout(()=>document.getElementById("loader").classList.add("hidden"),500);
        generateMineGrid(); 
        updateBalance();
    });
}
preloadAssets();
</script>
</body>
</html>
