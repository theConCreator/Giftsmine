<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GiftsMine üéÅ</title>
  <style>
    @font-face { font-family:'Minecraft'; src:url('minecraft.ttf') format('truetype'); }
    body, html { margin:0; padding:0; height:100%; font-family:'Minecraft',sans-serif; color:#fff; overflow:hidden; display:flex; flex-direction:column; background:#000; background-size:cover; background-position:center; transition: background 0.5s; }
    #balance { padding:15px; text-align:right; font-size:1.2em; font-weight:bold; background:rgba(0,0,0,0.15); backdrop-filter:blur(5px); box-shadow:0 2px 8px rgba(0,0,0,0.3); }
    main { flex:1; overflow-y:auto; padding:10px; padding-bottom:70px; display:none; background: rgba(0,0,0,0.2); }
    main.active{display:block;}
    h2{margin-top:0;text-align:center}
    .banner{width:100%;aspect-ratio:5/1;background:rgba(255,255,255,0.06);border-radius:10px;margin-bottom:15px;display:flex;align-items:center;justify-content:center;color:#ccc}
    .tab-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      display: flex;
      justify-content: space-between;
      background: rgba(0,0,0,0.2);
      padding: 10px 8px;
      border-top: 2px solid #fff;
      z-index: 1000;
      box-sizing: border-box;
    }
    .tab-bar button {
      flex: 1;
      margin: 0 4px;
      padding: 10px;
      font-size: 1em;
      border-radius: 10px;
      transition: 0.25s;
    }
    button { background: linear-gradient(135deg,#ff9a9e,#fad0c4); color:#fff; border:none; border-radius:8px; padding:8px 10px; cursor:pointer; font-weight:bold; }
    .tab-bar button.active { background: linear-gradient(135deg,#a1c4fd,#c2e9fb); }
    .grid { display:grid; gap:5px; justify-content:center; }
    #mineGrid { grid-template-columns: repeat(4, minmax(60px,1fr)); }
    .block { aspect-ratio:1/1; background:#333; display:flex; align-items:center; justify-content:center; cursor:pointer; transition:0.2s; position:relative; overflow:hidden; background-size:cover; background-position:center; border-radius:6px; }
    .block-price { position:absolute; bottom:2px; right:2px; background:rgba(0,0,0,0.5); padding:2px 4px; font-size:0.7em; border-radius:2px; display:flex; align-items:center; gap:2px; }
    .block.cooldown { filter:brightness(0.5); cursor:not-allowed; }
    .inventory-list { display:flex; flex-direction:column; gap:12px; }
    .gift-item { display:flex; flex-direction:column; background: rgba(20,20,20,0.95); border-radius:10px; padding:10px; box-shadow:0 4px 12px rgba(0,0,0,0.5); color:#fff; }
    .gift-top { display:flex; gap:10px; align-items:center; margin-bottom:8px; }
    .gift-preview { width:60px; height:60px; flex-shrink:0; border-radius:6px; overflow:hidden; background:#111; }
    .gift-info { display:flex; flex-direction:column; justify-content:center; gap:4px; flex-grow:1; }
    .gift-name { font-size:1em; font-weight:bold; }
    .gift-price { font-size:0.9em; color:#ccc; }
    .gift-actions { display:flex; gap:10px; margin-top:6px; }
    .gift-actions button { flex:1; padding:6px; border:none; border-radius:6px; font-size:0.85em; cursor:pointer; color:#fff; background: linear-gradient(135deg,#ff9a9e,#fad0c4); transition:0.3s; }
    .gift-actions button:hover { filter:brightness(1.1); }
    .flying { position:absolute; width:60px; height:60px; pointer-events:none; z-index:10000; }
    #loader { position:fixed; top:0; left:0; width:100%; height:100%; display:flex; align-items:center; justify-content:center; flex-direction:column; z-index:9999; background:#000; transition:opacity 0.6s ease; }
    #loader.hidden { opacity:0; pointer-events:none; }
    #loaderAnimation { width:150px; height:150px; margin-bottom:20px; }
    #loaderProgress { width:60%; height:20px; background:#444; border-radius:10px; margin-top:10px; overflow:hidden; }
    #loaderProgressBar { width:0%; height:100%; background:#ff9a9e; transition:0.3s; }
    input[type="text"]{padding:8px;border-radius:8px;border:none;background:rgba(255,255,255,0.1);color:#fff;font-weight:bold;}
    .balance-buttons button{background:linear-gradient(135deg,#6a11cb,#2575fc); color:#fff; font-weight:bold; border-radius:8px; flex:1; padding:10px; transition:0.3s;}
    .balance-buttons button:hover{filter:brightness(1.1);}
    @media (max-width:500px){ .tab-bar button{font-size:0.85em;padding:8px;} #balance{font-size:1em;padding:10px;} #mineGrid{gap:3px;} }
  </style>
</head>
<body>
<div id="loader">
  <div id="loaderAnimation"></div>
  <div id="loaderProgress"><div id="loaderProgressBar"></div></div>
  <p style="color:#fff;font-size:1.1em;margin-top:8px">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤...</p>
</div>

<div id="balance">–ë–∞–ª–∞–Ω—Å: 10000 <img src="ton.svg" style="width:16px;vertical-align:middle"></div>

<main id="menu" class="active">
  <h2>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h2>
  <a href="https://site.com" target="_blank" class="banner">
  <img src="images/banner.jpg" alt="–†–µ–∫–ª–∞–º–∞" style="width:100%; height:100%; object-fit:cover; border-radius:10px;">
</a>
  <p style="text-align:center;color:#bbb">–í—ã–±–∏—Ä–∞–π —Ä–µ–∂–∏–º –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –ø–æ–¥–∞—Ä–∫–∏!</p>
</main>

<main id="mine">
  <h2>–®–∞—Ö—Ç–∞ ‚õèÔ∏è</h2>
  <div id="brokenBlocks" style="text-align:center;margin-bottom:12px">–°–ª–æ–º–∞–Ω–æ –±–ª–æ–∫–æ–≤: 0</div>
  <div class="grid" id="mineGrid"></div>
</main>

<main id="inventory">
  <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å üéí</h2>
  <div class="inventory-list" id="inventoryList"></div>
</main>

<main id="balanceTab">
  <h2>–ë–∞–ª–∞–Ω—Å üí∞</h2>
  <div style="margin-bottom:15px;"><label>–ü—Ä–æ–º–æ–∫–æ–¥: <input type="text" id="promoCode"><button onclick="redeemPromo()">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button></label></div>
  <div class="balance-buttons" style="margin-bottom:15px; display:flex; gap:8px; flex-wrap:wrap">
    <button onclick="addBalance('crypto')">–ü–æ–ø–æ–ª–Ω–∏—Ç—å CryptoBot</button>
    <button onclick="addBalance('ton')">–ü–æ–ø–æ–ª–Ω–∏—Ç—å TON</button>
    <button onclick="addBalance('stars')">–ü–æ–ø–æ–ª–Ω–∏—Ç—å –ó–≤—ë–∑–¥—ã</button>
  </div>
  <div id="transactionHistory"></div>
</main>

<div class="tab-bar">
  <button onclick="showTab('menu')" id="tab-menu" class="active">–ú–µ–Ω—é</button>
  <button onclick="showTab('mine')" id="tab-mine">–®–∞—Ö—Ç–∞</button>
  <button onclick="showTab('inventory')" id="tab-inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
  <button onclick="showTab('balanceTab')" id="tab-balanceTab">–ë–∞–ª–∞–Ω—Å</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>
<script>
let loaderAnim=lottie.loadAnimation({container:document.getElementById('loaderAnimation'),renderer:'svg',loop:true,autoplay:true,path:'animations/myLoader.json'});
let balance=10000,transactions=[],inventory=[],brokenBlocks=0,firstMineCount=0;

const backgrounds={menu:'images/menu.jpg',mine:'images/mine.jpg',inventory:'images/inventory.jpg',balanceTab:'images/mobs.jpg'};
document.body.style.backgroundImage=`url(${backgrounds.menu})`;

function updateBalance(){document.getElementById('balance').innerHTML=`–ë–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} <img src="ton.svg" style="width:16px;vertical-align:middle">`;}
function updateTransactionHistory(){const el=document.getElementById('transactionHistory'); el.innerHTML=''; transactions.slice().reverse().forEach(t=>{el.innerHTML+=`<div style="padding:6px 0;font-size:0.9em;color:#ddd">${t}</div>`});}
function updateBrokenBlocks(){document.getElementById('brokenBlocks').textContent=`–°–ª–æ–º–∞–Ω–æ –±–ª–æ–∫–æ–≤: ${brokenBlocks}`;}

function showTab(id){document.querySelectorAll('main').forEach(m=>m.classList.remove('active')); document.getElementById(id).classList.add('active'); document.querySelectorAll('.tab-bar button').forEach(b=>b.classList.remove('active')); document.getElementById('tab-'+id).classList.add('active'); document.body.style.backgroundImage=`url(${backgrounds[id]})`; if(id==='inventory') renderInventory();}

const gifts=[{name:"Hypno Lollipop",price:1.77},{name:"Desk Calendar",price:1.31},{name:"B-Day Candle",price:1.32},{name:"Lol Pop",price:1.32},{name:"Lunar Snake",price:1.38},{name:"Snake Box",price:1.36},{name:"Xmas Stocking",price:1.38},{name:"Whip Cupcake",price:1.38},{name:"Candy Cane",price:1.48},{name:"Pet Snake",price:1.58},{name:"Jester Hat",price:1.62},{name:"Snoop Dogg",price:1.64},{name:"Homemade Cake",price:1.7},{name:"Holiday Drink",price:1.7},{name:"Jingle Bells",price:1.74},{name:"Cookie Heart",price:1.75},{name:"Big Year",price:1.78},{name:"Party Sparkler",price:1.8},{name:"Winter Wreath",price:1.79},{name:"Swag Bag",price:1.91},{name:"Tama Gadget",price:1.93},{name:"Ginger Cookie",price:1.95},{name:"Moon Pendant",price:1.96},{name:"Jack-in-the-Box",price:2.01},{name:"Spiced Wine",price:2.12},{name:"Stellar Rocket",price:2.19},{name:"Star Notepad",price:2.32},{name:"Easter Egg",price:2.46},{name:"Restless Jar",price:2.5},{name:"Santa Hat",price:2.6},{name:"Snow Globe",price:2.65},{name:"Hex Pot",price:2.7},{name:"Joyful Bundle",price:2.71},{name:"Lush Bouquet",price:2.84},{name:"Witch Hat",price:2.86},{name:"Light Sword",price:3.13},{name:"Spy Agaric",price:3.2},{name:"Bow Tie",price:3.22},{name:"Eternal Candle",price:3.38},{name:"Bunny Muffin",price:3.34},{name:"Jelly Bunny",price:3.43},{name:"Berry Box",price:3.58},{name:"Evil Eye",price:3.6},{name:"Snow Mittens",price:3.67},{name:"Valentine Box",price:4.2},{name:"Snoop Cigar",price:4.26},{name:"Sakura Flower",price:4.77},{name:"Hanging Star",price:5.26},{name:"Jolly Chimp",price:5.34},{name:"Sleigh Bell",price:7.63},{name:"Skull Flower",price:7.7},{name:"Crystal Ball",price:7.86},{name:"Record Player",price:7.91},{name:"Love Candle",price:7.94},{name:"Top Hat",price:7.99},{name:"Trapped Heart",price:8.69},{name:"Love Potion",price:8.79},{name:"Flying Broom",price:9.45},{name:"Cupid Charm",price:11.26},{name:"Eternal Rose",price:13.71},{name:"Ionic Dryer",price:14.21},{name:"Diamond Ring",price:16.39},{name:"Voodoo Doll",price:16.43},{name:"Mad Pumpkin",price:17.91},{name:"Toy Bear",price:19.3},{name:"Vintage Cigar",price:23.98},{name:"Low Rider",price:24.8},{name:"Signet Ring",price:25.1},{name:"Neko Helmet",price:26.41},{name:"Electric Skull",price:31},{name:"Kissed Frog",price:34},{name:"Swiss Watch",price:35},{name:"Sharp Tongue",price:39.69},{name:"Scared Cat",price:43.6},{name:"Genie Lamp",price:47.07},{name:"Westside Sign",price:51.27},{name:"Bonded Ring",price:54.99},{name:"Gem Signet",price:72.98},{name:"Magic Potion",price:72.98},{name:"Ion Gem",price:83},{name:"Astral Shard",price:95.97},{name:"Perfume Bottle",price:95.99},{name:"Loot Bag",price:90.1},{name:"Mini Oscar",price:123.89},{name:"Nail Bracelet",price:129.84},{name:"Heroic Helmet",price:219.99},{name:"Precious Peach",price:379.99},{name:"Durov‚Äôs Cap",price:794.9},{name:"Heart Locket",price:1450},{name:"Plush Pepe",price:5199}];

const oreTypes=[{img:"images/ores/coal.png",hits:3},{img:"images/ores/iron.png",hits:4},{img:"images/ores/gold.png",hits:5},{img:"images/ores/diamond.png",hits:6},{img:"images/ores/emerald.png",hits:7}];
const animationMap={};

function getGiftByPrice(price,isFirst=false){
  let min=price*0.5,max=price*1.45;
  if(firstMineCount<2 && isFirst) max=price*2;
  let possible=gifts.filter(g=>g.price>=min && g.price<=max);
  if(isFirst && possible.length===0) possible=gifts.filter(g=>g.price>=price);
  if(possible.length===0) possible=gifts;
  return possible[Math.floor(Math.random()*possible.length)];
}

function spawnBlock(cell,index=0){
  const ore=oreTypes[Math.floor(Math.random()*oreTypes.length)];
  let price=+(1+Math.random()*10).toFixed(2);
  cell.className="block"; cell.style.backgroundImage=`url(${ore.img})`;
  cell.innerHTML=`<div class="block-price">${price}<img src="ton.svg" style="width:12px;vertical-align:middle"></div>`;
  let hits=0;
  cell.onclick=()=>{
    hits++;
    if(hits>=ore.hits){
      brokenBlocks++; updateBrokenBlocks();
      if(balance>=price){ balance-=price; updateBalance(); }
      let gift=getGiftByPrice(price,index===0);
      inventory.push(gift); renderInventory();
      flyGift(gift,cell);
      firstMineCount++;
      let respawn=(60+Math.random()*1740)*1000;
      cell.classList.add("cooldown");
      cell.innerHTML=`<div style="position:absolute;top:2px;left:2px;font-size:0.7em;">${Math.round(respawn/60000)}m</div>`;
      cell.onclick=null;
      setTimeout(()=>{ cell.classList.remove("cooldown"); spawnBlock(cell,index); },respawn);
    }
  };
}

function generateMineGrid(){ const grid=document.getElementById('mineGrid'); grid.innerHTML=''; for(let i=0;i<16;i++){ let cell=document.createElement('div'); spawnBlock(cell,i); grid.appendChild(cell); }}

function flyGift(gift, fromCell) {
  const rect = fromCell.getBoundingClientRect();
  const fly = document.createElement('div');
  fly.className = 'flying';
  
  // —Å—Ç–∞—Ä—Ç: —Ü–µ–Ω—Ç—Ä –±–ª–æ–∫–∞
  fly.style.left = rect.left + rect.width / 2 - 30 + 'px'; // 30 = –ø–æ–ª–æ–≤–∏–Ω–∞ —à–∏—Ä–∏–Ω—ã –ø–æ–¥–∞—Ä–∫–∞ (60px)
  fly.style.top  = rect.top  + rect.height / 2 - 30 + 'px';
  
  document.body.appendChild(fly);

  const anim = lottie.loadAnimation({
    container: fly,
    renderer: 'svg',
    loop: true,
    autoplay: true,
    path: `emoji/${gift.name}.json`
  });

  // —Ü–µ–ª–µ–≤–∞—è –ø–æ–∑–∏—Ü–∏—è: —Ü–µ–Ω—Ç—Ä –∫–Ω–æ–ø–∫–∏ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
  const invBtn = document.getElementById('tab-inventory').getBoundingClientRect();
  const targetX = invBtn.left + invBtn.width / 2 - 30;
  const targetY = invBtn.top  + invBtn.height / 2 - 30;

  fly.animate([
    { transform: 'translate(0,0)' },
    { transform: `translate(${targetX - (rect.left + rect.width / 2 - 30)}px, ${targetY - (rect.top + rect.height / 2 - 30)}px)` }
  ], { duration: 1000, easing: 'ease-in-out' });

  setTimeout(() => { fly.remove(); anim.destroy(); }, 1000);
}


function renderInventory(){
  const list=document.getElementById('inventoryList'); list.innerHTML='';
  inventory.forEach((gift,idx)=>{
    const div=document.createElement('div'); div.className='gift-item';
    const top=document.createElement('div'); top.className='gift-top';
    const prev=document.createElement('div'); prev.className='gift-preview';
    if(animationMap[gift.name]){ try{ lottie.loadAnimation({container:prev,renderer:'svg',loop:true,autoplay:true,path:animationMap[gift.name]}); }catch(e){} } else { prev.textContent = gift.name; prev.style.display='flex'; prev.style.alignItems='center'; prev.style.justifyContent='center'; prev.style.padding='6px'; prev.style.fontSize='0.75em'; prev.style.color='#ddd'; }
    const info=document.createElement('div'); info.className='gift-info';
    info.innerHTML=`<div class="gift-name">${gift.name}</div><div class="gift-price">–¶–µ–Ω–∞: ${gift.price.toFixed(2)} <img src="ton.svg" style="width:12px;vertical-align:middle"></div>`;
    top.appendChild(prev); top.appendChild(info);
    const actions=document.createElement('div'); actions.className='gift-actions';
    const sell=document.createElement('button'); sell.textContent='–ü—Ä–æ–¥–∞—Ç—å'; sell.onclick=()=>{ balance+=gift.price; updateBalance(); inventory.splice(idx,1); renderInventory(); transactions.unshift(`–ü—Ä–æ–¥–∞–∂–∞: ${gift.name} +${gift.price.toFixed(2)} TON`); updateTransactionHistory(); };
    const withdraw=document.createElement('button'); withdraw.textContent='–í—ã–≤–µ—Å—Ç–∏'; withdraw.onclick=()=>{ alert('–í—ã–≤–æ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω!'); inventory.splice(idx,1); renderInventory(); transactions.unshift(`–í—ã–≤–æ–¥: ${gift.name}`); updateTransactionHistory(); };
    actions.appendChild(sell); actions.appendChild(withdraw); div.appendChild(top); div.appendChild(actions); list.appendChild(div);
  });
}

function redeemPromo(){ const code=document.getElementById('promoCode').value.trim(); if(code==='BONUS10'){ balance+=10; updateBalance(); transactions.unshift('–ü—Ä–æ–º–æ–∫–æ–¥ +10 TON'); updateTransactionHistory(); alert('–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!'); } else{ transactions.unshift(`–ü—Ä–æ–º–æ–∫–æ–¥: –Ω–µ–≤–µ—Ä–Ω—ã–π (${code||'–ø—É—Å—Ç–æ'})`); updateTransactionHistory(); alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥'); }}

function addBalance(method){ let amount=100; balance+=amount; updateBalance(); transactions.unshift(`–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ ${method} +${amount} TON`); updateTransactionHistory(); alert(`–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω —á–µ—Ä–µ–∑ ${method}: +${amount} TON`); }

// preload assets
function preloadAssets(){
  const imagePaths=[...Object.values(backgrounds),'ton.svg',...oreTypes.map(o=>o.img)];
  const lottiePaths=gifts.map(g=>({name:g.name,path:`emoji/${g.name}.json`}));
  const total=imagePaths.length+lottiePaths.length; let loaded=0;
  const prog=p=>{ document.getElementById('loaderProgressBar').style.width=Math.round(p*100)+'%'; };
  const imgPromises=imagePaths.map(src=>new Promise(res=>{ const img=new Image(); img.onload=img.onerror=function(){ loaded++; prog(loaded/total); res(); }; img.src=src; }));
  const lottiePromises=lottiePaths.map(item=>fetch(item.path).then(r=>{ if(!r.ok) return null; return r.blob(); }).then(blob=>{ if(blob){ animationMap[item.name]=URL.createObjectURL(blob); } loaded++; prog(loaded/total); }).catch(()=>{ loaded++; prog(loaded/total); }));
  return Promise.all([...imgPromises,...lottiePromises]);
}

preloadAssets().then(()=>{ setTimeout(()=>{ document.getElementById('loader').classList.add('hidden'); generateMineGrid(); updateBalance(); updateTransactionHistory(); updateBrokenBlocks(); document.body.style.backgroundImage=`url(${backgrounds.menu})`; },400); });
</script>
</body>
</html>
