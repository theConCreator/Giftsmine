<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GiftsMine üéÅ</title>
<style>
@font-face { font-family: 'Minecraft'; src: url('minecraft.ttf') format('truetype'); }
body, html { margin:0; padding:0; height:100%; font-family:'Minecraft',Segoe UI,sans-serif; color:#fff; overflow:hidden; display:flex; flex-direction:column; background:#000; background-size:cover; background-position:center; }
#balance{padding:15px;text-align:right;font-size:1.2em;font-weight:bold;background:rgba(0,0,0,0.15);backdrop-filter:blur(5px);box-shadow:0 2px 8px rgba(0,0,0,0.3);}
main{flex:1;overflow-y:auto;padding:10px;margin-bottom:60px;display:none;background: rgba(0,0,0,0.2);}
main.active{display:block;}
.tab-bar{position:fixed;bottom:0;width:100%;display:flex;justify-content:space-around;background:rgba(0,0,0,0.2);padding:10px;border-top:2px solid #fff;z-index:1000;}
.tab-bar button{flex:1;margin:0 5px;padding:10px;border:none;background:linear-gradient(135deg,#ff9a9e,#fad0c4);color:#fff;font-weight:bold;cursor:pointer;transition:0.3s;font-size:1em;}
.tab-bar button.active{background:linear-gradient(135deg,#a1c4fd,#c2e9fb);}
.grid{display:grid;gap:5px;justify-content:center;}
.mobs-grid{display:flex;gap:15px;justify-content:center;flex-wrap:wrap;margin-bottom:15px;}
.mob-card{background:#222;padding:10px;border-radius:8px;flex:1 1 100px;text-align:center;cursor:pointer;transition:0.3s;}
.mob-card:hover{background:#444;}
#rouletteCanvas{background:#222;border-radius:50%;display:block;margin:0 auto;}
#spinButton{padding:10px;margin-top:10px;background:linear-gradient(135deg,#ff9a9e,#fad0c4);border:none;color:#fff;font-weight:bold;cursor:pointer;border-radius:8px;display:block;margin-left:auto;margin-right:auto;}
.inventory-list{position:fixed;right:10px;bottom:10px;width:150px;max-height:200px;overflow-y:auto;}
.gift-item{background:#222;padding:5px;margin-bottom:5px;border-radius:6px;font-size:0.8em;text-align:center;}
.flying{position:absolute;width:50px;height:50px;pointer-events:none;z-index:10000;}
</style>
</head>
<body>

<div id="balance">–ë–∞–ª–∞–Ω—Å: 10000 <img src="ton.svg" style="width:16px;vertical-align:middle"></div>

<main id="mobs" class="active">
<h2>–ú–æ–±—ã üêæ</h2>
<div class="mobs-grid" id="mobsGrid"></div>
<canvas id="rouletteCanvas" width="400" height="400"></canvas>
<div style="text-align:center;">
  <button id="spinButton">–†–∞—Å–∫—Ä—É—Ç–∏—Ç—å</button>
</div>
<div class="inventory-list" id="inventoryList"></div>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>
<script>
// --- –ë–∞–ª–∞–Ω—Å ---
let balance = 10000;
function updateBalance(){
  document.getElementById('balance').innerHTML =
    `–ë–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} <img src="ton.svg" style="width:16px;vertical-align:middle">`;
}

// --- –ü–æ–¥–∞—Ä–∫–∏ ---
const gifts=[
  {name:"Hypno Lollipop",price:1.77},{name:"Desk Calendar",price:1.31},
  {name:"B-Day Candle",price:1.32},{name:"Lol Pop",price:1.32},
  {name:"Lunar Snake",price:1.38},{name:"Snake Box",price:1.36},
  {name:"Xmas Stocking",price:1.38},{name:"Whip Cupcake",price:1.38},
  {name:"Candy Cane",price:1.48},{name:"Pet Snake",price:1.58},
  {name:"Jester Hat",price:1.62},{name:"Snoop Dogg",price:1.64},
  {name:"Homemade Cake",price:1.7},{name:"Holiday Drink",price:1.7},
  {name:"Jingle Bells",price:1.74},{name:"Cookie Heart",price:1.75},
  {name:"Big Year",price:1.78},{name:"Party Sparkler",price:1.8},
  {name:"Winter Wreath",price:1.79},{name:"Swag Bag",price:1.91},
  {name:"Tama Gadget",price:1.93},{name:"Ginger Cookie",price:1.95},
  {name:"Moon Pendant",price:1.96},{name:"Jack-in-the-Box",price:2.01},
  {name:"Spiced Wine",price:2.12},{name:"Stellar Rocket",price:2.19},
  {name:"Star Notepad",price:2.32},{name:"Easter Egg",price:2.46},
  {name:"Restless Jar",price:2.5},{name:"Santa Hat",price:2.6},
  {name:"Snow Globe",price:2.65},{name:"Hex Pot",price:2.7},
  {name:"Joyful Bundle",price:2.71},{name:"Lush Bouquet",price:2.84},
  {name:"Witch Hat",price:2.86},{name:"Light Sword",price:3.13},
  {name:"Spy Agaric",price:3.2},{name:"Bow Tie",price:3.22},
  {name:"Eternal Candle",price:3.38},{name:"Bunny Muffin",price:3.34},
  {name:"Jelly Bunny",price:3.43},{name:"Berry Box",price:3.58},
  {name:"Evil Eye",price:3.6},{name:"Snow Mittens",price:3.67},
  {name:"Valentine Box",price:4.2},{name:"Snoop Cigar",price:4.26},
  {name:"Sakura Flower",price:4.77},{name:"Hanging Star",price:5.26},
  {name:"Jolly Chimp",price:5.34},{name:"Sleigh Bell",price:7.63},
  {name:"Skull Flower",price:7.7},{name:"Crystal Ball",price:7.86},
  {name:"Record Player",price:7.91},{name:"Love Candle",price:7.94},
  {name:"Top Hat",price:7.99},{name:"Trapped Heart",price:8.69},
  {name:"Love Potion",price:8.79},{name:"Flying Broom",price:9.45},
  {name:"Cupid Charm",price:11.26},{name:"Eternal Rose",price:13.71},
  {name:"Ionic Dryer",price:14.21},{name:"Diamond Ring",price:16.39},
  {name:"Voodoo Doll",price:16.43},{name:"Mad Pumpkin",price:17.91},
  {name:"Toy Bear",price:19.3},{name:"Vintage Cigar",price:23.98},
  {name:"Low Rider",price:24.8},{name:"Signet Ring",price:25.1},
  {name:"Neko Helmet",price:26.41},{name:"Electric Skull",price:31},
  {name:"Kissed Frog",price:34},{name:"Swiss Watch",price:35},
  {name:"Sharp Tongue",price:39.69},{name:"Scared Cat",price:43.6},
  {name:"Genie Lamp",price:47.07},{name:"Westside Sign",price:51.27},
  {name:"Bonded Ring",price:54.99},{name:"Gem Signet",price:72.98},
  {name:"Magic Potion",price:72.98},{name:"Ion Gem",price:83},
  {name:"Astral Shard",price:95.97},{name:"Perfume Bottle",price:95.99},
  {name:"Loot Bag",price:90.1},{name:"Mini Oscar",price:123.89},
  {name:"Nail Bracelet",price:129.84},{name:"Heroic Helmet",price:219.99},
  {name:"Precious Peach",price:379.99},{name:"Durov‚Äôs Cap",price:794.9},
  {name:"Heart Locket",price:1450},{name:"Plush Pepe",price:5199}
];

let inventory=[];

// --- –ú–æ–±—ã ---
const mobsData=[
  {name:"–ó–æ–º–±–∏",price:1,lose:0.4,win:0.4,epicGift:"Restless Jar",color:"#0a5a0a"},
  {name:"–ü–∞—É–∫",price:2,lose:0.3,win:0.6,epicGift:"Witch Hat",color:"#111111"},
  {name:"–°–∫–µ–ª–µ—Ç",price:3,lose:0.9,win:0,epicGift:"Crystal Ball",color:"#aaaaaa"},
  {name:"–ö—Ä–∏–ø–µ—Ä",price:5,lose:0.7,win:0.25,epicGift:"Mad Pumpkin",color:"#7fff7f"}
];

let selectedMob=null, spinning=false;
const canvas=document.getElementById("rouletteCanvas");
const ctx=canvas.getContext("2d");
const center=canvas.width/2;
const radius=canvas.width/2-10;

// --- –†–µ–Ω–¥–µ—Ä–∏–º –º–æ–±—ã ---
function renderMobs(){
  const grid=document.getElementById("mobsGrid");
  if(grid.childElementCount>0) return;
  mobsData.forEach(mob=>{
    const div=document.createElement("div"); div.className="mob-card";
    div.innerHTML=`<img src="mobs/${mob.name}.png" style="width:80px"><br>${mob.name} (${mob.price} TON)`;
    div.onclick=()=>selectMob(mob);
    grid.appendChild(div);
  });
}

// --- –í—ã–±–æ—Ä –º–æ–±–∞ ---
function selectMob(mob){
  selectedMob=mob;
  drawRoulette();
}

// --- –†–∏—Å—É–µ–º —Ä—É–ª–µ—Ç–∫—É ---
function drawRoulette(rotation=0){
  if(!selectedMob) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  const segments=[
    {label:"–ü—Ä–æ–∏–≥—Ä—ã—à",value:selectedMob.lose,color:"#f44336"},
    {label:"–í—ã–∏–≥—Ä—ã—à",value:selectedMob.win,color:selectedMob.color},
    {label:"–≠–ø–∏–∫",value:1-selectedMob.lose-selectedMob.win,color:"#ffd700"}
  ];
  let startAngle=rotation;
  segments.forEach(seg=>{
    const endAngle=startAngle+seg.value*2*Math.PI;
    ctx.beginPath(); ctx.moveTo(center,center);
    ctx.arc(center,center,radius,startAngle,endAngle);
    ctx.fillStyle=seg.color; ctx.fill(); ctx.closePath();
    startAngle=endAngle;
  });
  const img=new Image(); img.src=`mobs/${selectedMob.name}.png`;
  img.onload=()=>{ctx.drawImage(img,center-40,center-40,80,80);};
}

// --- –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–¥–∞—Ä–∫–∞ ---
function flyGift(gift){
  const invRect=document.getElementById("inventoryList").getBoundingClientRect();
  const fly=document.createElement("div");
  fly.className="flying";
  fly.style.left=(canvas.getBoundingClientRect().left+center-25)+"px";
  fly.style.top=(canvas.getBoundingClientRect().top+center-25)+"px";
  fly.textContent=gift.name;
  document.body.appendChild(fly);
  fly.animate(
    [
      {transform:"translate(0,0) scale(1)",opacity:1},
      {transform:`translate(${invRect.left-(canvas.getBoundingClientRect().left+center-25)}px,${invRect.top-(canvas.getBoundingClientRect().top+center-25)}px) scale(0.5)`,opacity:0.8}
    ],
    {duration:1000,easing:"ease-in-out"}
  );
  setTimeout(()=>{document.body.removeChild(fly); renderInventory();},1000);
}

// --- –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å ---
function renderInventory(){
  const list=document.getElementById("inventoryList");
  list.innerHTML="";
  inventory.forEach(g=>{
    const div=document.createElement("div");
    div.className="gift-item";
    div.textContent=`${g.name} (${g.price} TON)`;
    list.appendChild(div);
  });
}

// --- –í—Ä–∞—â–µ–Ω–∏–µ —Ä—É–ª–µ—Ç–∫–∏ ---
function spinRoulette(){
  if(!selectedMob||spinning) return;
  spinning=true;

  const segments=[
    {label:"–ü—Ä–æ–∏–≥—Ä—ã—à",value:selectedMob.lose,color:"#f44336"},
    {label:"–í—ã–∏–≥—Ä—ã—à",value:selectedMob.win,color:selectedMob.color},
    {label:"–≠–ø–∏–∫",value:1-selectedMob.lose-selectedMob.win,color:"#ffd700"}
  ];
  let rand=Math.random(), resultIndex;
  if(rand<segments[0].value) resultIndex=0;
  else if(rand<segments[0].value+segments[1].value) resultIndex=1;
  else resultIndex=2;

  let angleStart=segments.slice(0,resultIndex).reduce((acc,s)=>acc+s.value*2*Math.PI,0);
  let angleEnd=angleStart+segments[resultIndex].value*2*Math.PI;
  let targetRotation=angleStart + Math.random()*(angleEnd-angleStart) + 5*2*Math.PI;

  let currentRotation=0;
  function animate(){
    currentRotation += (targetRotation - currentRotation)*0.1;
    drawRoulette(currentRotation);
    if(Math.abs(targetRotation-currentRotation)<0.001){
      finishSpin(resultIndex);
      spinning=false;
    } else requestAnimationFrame(animate);
  }
  animate();
}

// --- –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—Ä–∞—â–µ–Ω–∏—è ---
function finishSpin(result){
  if(result===0){alert("–í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏!");}
  else if(result===1){balance+=selectedMob.price; updateBalance(); alert("–í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ "+selectedMob.price+" TON");}
  else if(result===2){
    const gift=gifts.find(g=>g.name===selectedMob.epicGift);
    if(gift){inventory.push(gift); flyGift(gift);}
  }
}

document.getElementById("spinButton").onclick=spinRoulette;

// --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
updateBalance();
renderMobs();
</script>
</body>
</html>
