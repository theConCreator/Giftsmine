<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GiftsMine</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.10.2/lottie.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body, html { width: 100%; height: 100%; overflow: hidden; font-family: Arial, sans-serif; }
    #app { position: relative; width: 100%; height: 100%; display: flex; flex-direction: column; }

    .background { position: absolute; width: 100%; height: 100%; top:0; left:0; background-size: cover; background-position: center; z-index: -1; }
    #balance { position: absolute; top: 10px; right: 15px; font-size: 20px; font-weight: bold; color: #fff; text-shadow: 0 0 5px #000; z-index: 10; }
    .content { flex: 1; display: flex; justify-content: center; align-items: center; overflow: auto; padding: 20px; }
    .tabs { display: flex; justify-content: space-around; background: rgba(0,0,0,0.7); padding: 10px; }
    .tab { flex: 1; text-align: center; color: #fff; padding: 10px; cursor: pointer; }
    .tab.active { background: rgba(255,255,255,0.2); border-radius: 10px; }
    .grid { display: grid; gap: 5px; }
    .mines-grid { grid-template-columns: repeat(5, 1fr); max-width: 90vw; }
    .mine-cell { background: rgba(255,255,255,0.2); border: 1px solid #ccc; height: 60px; display:flex; justify-content:center; align-items:center; cursor: pointer; }
    .mine-cell.revealed.safe { background: rgba(0,255,0,0.5); }
    .mine-cell.revealed.mine { background: rgba(255,0,0,0.6); }
    .mine-controls { margin-top: 15px; text-align: center; color: #fff; }
    .mine-blocks { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; max-width: 90vw; }
    .block { position: relative; background: rgba(255,255,255,0.2); border: 1px solid #999; height: 70px; display:flex; justify-content:center; align-items:center; cursor: pointer; font-size:14px; font-weight:bold; color:#fff; }
    .inventory { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; width: 100%; }
    .gift-card { background: rgba(255,255,255,0.2); border-radius: 10px; padding: 10px; text-align:center; color:#fff; position:relative; }
    .gift-anim { width: 80px; height: 80px; margin: auto; }
    .gift-buttons { margin-top:5px; display:flex; justify-content:space-between; }
    .gift-buttons button { flex:1; margin:2px; font-size:12px; cursor:pointer; }
    .flying { position:absolute; width:80px; height:80px; pointer-events:none; z-index:1000; }
  </style>
</head>
<body>
<div id="app">
  <div class="background" id="background"></div>
  <div id="balance">–ë–∞–ª–∞–Ω—Å: 0 TON</div>
  <div class="content" id="content"></div>
  <div class="tabs">
    <div class="tab active" id="tab-menu">–ú–µ–Ω—é</div>
    <div class="tab" id="tab-mines">–ú–∏–Ω—ã</div>
    <div class="tab" id="tab-minefield">–®–∞—Ö—Ç–∞</div>
    <div class="tab" id="tab-inventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</div>
  </div>
</div>

<script>
// === –ü–æ–¥–∞—Ä–∫–∏ ===
const rawGifts=[{name:"Hypno Lollipop",price:1.77},{name:"Desk Calendar",price:1.31},{name:"B-Day Candle",price:1.32},{name:"Lol Pop",price:1.32},{name:"Lunar Snake",price:1.38},{name:"Snake Box",price:1.36},{name:"Xmas Stocking",price:1.38},{name:"Whip Cupcake",price:1.38},{name:"Candy Cane",price:1.48},{name:"Pet Snake",price:1.58},{name:"Jester Hat",price:1.62},{name:"Snoop Dogg",price:1.64},{name:"Homemade Cake",price:1.7},{name:"Holiday Drink",price:1.7},{name:"Jingle Bells",price:1.74},{name:"Cookie Heart",price:1.75},{name:"Big Year",price:1.78},{name:"Party Sparkler",price:1.8},{name:"Winter Wreath",price:1.79},{name:"Swag Bag",price:1.91},{name:"Tama Gadget",price:1.93},{name:"Ginger Cookie",price:1.95},{name:"Moon Pendant",price:1.96},{name:"Jack-in-the-Box",price:2.01},{name:"Spiced Wine",price:2.12},{name:"Stellar Rocket",price:2.19},{name:"Star Notepad",price:2.32},{name:"Easter Egg",price:2.46},{name:"Restless Jar",price:2.5},{name:"Santa Hat",price:2.6},{name:"Snow Globe",price:2.65},{name:"Hex Pot",price:2.7},{name:"Joyful Bundle",price:2.71},{name:"Lush Bouquet",price:2.84},{name:"Witch Hat",price:2.86},{name:"Light Sword",price:3.13},{name:"Spy Agaric",price:3.2},{name:"Bow Tie",price:3.22},{name:"Eternal Candle",price:3.38},{name:"Bunny Muffin",price:3.34},{name:"Jelly Bunny",price:3.43},{name:"Berry Box",price:3.58},{name:"Evil Eye",price:3.6},{name:"Snow Mittens",price:3.67},{name:"Valentine Box",price:4.2},{name:"Snoop Cigar",price:4.26},{name:"Sakura Flower",price:4.77},{name:"Hanging Star",price:5.26},{name:"Jolly Chimp",price:5.34},{name:"Sleigh Bell",price:7.63},{name:"Skull Flower",price:7.7},{name:"Crystal Ball",price:7.86},{name:"Record Player",price:7.91},{name:"Love Candle",price:7.94},{name:"Top Hat",price:7.99},{name:"Trapped Heart",price:8.69},{name:"Love Potion",price:8.79},{name:"Flying Broom",price:9.45},{name:"Cupid Charm",price:11.26},{name:"Eternal Rose",price:13.71},{name:"Ionic Dryer",price:14.21},{name:"Diamond Ring",price:16.39},{name:"Voodoo Doll",price:16.43},{name:"Mad Pumpkin",price:17.91},{name:"Toy Bear",price:19.3},{name:"Vintage Cigar",price:23.98},{name:"Low Rider",price:24.8},{name:"Signet Ring",price:25.1},{name:"Neko Helmet",price:26.41},{name:"Electric Skull",price:31},{name:"Kissed Frog",price:34},{name:"Swiss Watch",price:35},{name:"Sharp Tongue",price:39.69},{name:"Scared Cat",price:43.6},{name:"Genie Lamp",price:47.07},{name:"Westside Sign",price:51.27},{name:"Bonded Ring",price:54.99},{name:"Gem Signet",price:72.98},{name:"Magic Potion",price:72.98},{name:"Ion Gem",price:83},{name:"Astral Shard",price:95.97},{name:"Perfume Bottle",price:95.99},{name:"Loot Bag",price:90.1},{name:"Mini Oscar",price:123.89},{name:"Nail Bracelet",price:129.84},{name:"Heroic Helmet",price:219.99},{name:"Precious Peach",price:379.99},{name:"Durov‚Äôs Cap",price:794.9},{name:"Heart Locket",price:1450},{name:"Plush Pepe",price:5199}];
const gifts=rawGifts.map(g=>({name:g.name,price:+(g.price*(0.9+Math.random()*0.2)).toFixed(1)}));

let balance=localStorage.getItem('balance')?+localStorage.getItem('balance'):10000;
let inventory=localStorage.getItem('inventory')?JSON.parse(localStorage.getItem('inventory')):[];
let mines=localStorage.getItem('mines')?JSON.parse(localStorage.getItem('mines')):null;
let revealed=localStorage.getItem('revealed')?JSON.parse(localStorage.getItem('revealed')):null;

const contentEl=document.getElementById('content');
const backgroundEl=document.getElementById('background');
const balanceEl=document.getElementById('balance');
function updateBalance(){ balanceEl.textContent=`–ë–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} TON`; localStorage.setItem('balance',balance); }
updateBalance();

function saveState(){ localStorage.setItem('inventory',JSON.stringify(inventory)); if(mines) localStorage.setItem('mines',JSON.stringify(mines)); if(revealed) localStorage.setItem('revealed',JSON.stringify(revealed)); }

// === –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ–ª—ë—Ç–∞ –ø–æ–¥–∞—Ä–∫–∞ ===
function flyGiftToInventory(giftName,startX,startY){
  const target=document.getElementById('tab-inventory').getBoundingClientRect();
  const targetX=target.left+target.width/2;
  const targetY=target.top+target.height/2;
  const container=document.createElement('div');
  container.className='flying';
  container.style.left=startX+'px';
  container.style.top=startY+'px';
  document.body.appendChild(container);
  const anim=lottie.loadAnimation({container,renderer:'svg',loop:true,autoplay:true,path:`emoji/${giftName}.json`});
  requestAnimationFrame(()=>{container.style.transition='transform 1s ease-in-out';container.style.transform=`translate(${targetX-startX}px,${targetY-startY}px) scale(0.2)`;});
  container.addEventListener('transitionend',()=>{anim.destroy();container.remove();inventory.push(gifts.find(g=>g.name===giftName));renderInventory(); saveState();},{once:true});
}

// === –ú–µ–Ω—é ===
function renderMenu(){backgroundEl.style.backgroundImage='url(images/menu.jpg)';contentEl.innerHTML=`<div style="color:#fff;text-align:center;"><h1>GiftsMine</h1><p>–í—ã–±–∏—Ä–∞–π —Ä–µ–∂–∏–º —Å–Ω–∏–∑—É</p></div>`;}

// === –ú–∏–Ω—ã ===
let bet=mines&&mines.bet?mines.bet:null;
function renderMines(){
  backgroundEl.style.backgroundImage='url(images/mines.jpg)';
  if(!mines){mines={cells:[],bet:null};for(let i=0;i<25;i++){mines.cells.push(null);} revealed=Array(25).fill(null);}
  let html=`<div class="grid mines-grid">`;
  for(let i=0;i<25;i++){const r=revealed[i];let cls="mine-cell";if(r){cls+=revealed[i]==='mine'?" revealed mine":" revealed safe";}html+=`<div class="${cls}" data-idx="${i}">${r==='safe'?"‚úîÔ∏è":r==='mine'?"üí£":""}</div>`;}
  html+=`</div><div class="mine-controls">`;
  if(!bet){html+=`<p>–°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É –¥–ª—è –Ω–∞—á–∞–ª–∞</p><button onclick="placeBet(1)">–ü–æ—Å—Ç–∞–≤–∏—Ç—å 1 TON</button>`;} else {html+=`<button onclick="cashout()">–ó–∞–±—Ä–∞—Ç—å</button>`;}
  html+=`</div>`;
  contentEl.innerHTML=html;
  document.querySelectorAll('.mine-cell').forEach(cell=>{
    cell.onclick=()=>{if(!bet) return alert('–°–Ω–∞—á–∞–ª–∞ —Å–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É!');const idx=+cell.dataset.idx;if(revealed[idx]) return;if(mines.cells.includes(idx)){revealed[idx]='mine';endMines(false,cell);}else{revealed[idx]='safe';cell.textContent='‚úîÔ∏è';}saveState(); renderMines();}
  });
}
function placeBet(amount){if(balance<amount) return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞');balance-=amount;updateBalance();bet={amount,multiplier:1};mines.bet=bet;while(mines.cells.filter(v=>v==='mine').length<5){let m=Math.floor(Math.random()*25);if(!mines.cells.includes(m))mines.cells.push(m);}revealed=Array(25).fill(null);saveState(); renderMines();}
function endMines(win,cell){if(!win){mines.cells.forEach(m=>revealed[m]='mine');bet=null;mines.bet=null;setTimeout(renderMines,500); saveState();}}
function cashout(){if(!bet)return;let gift=gifts[Math.floor(Math.random()*gifts.length)];const rect=contentEl.getBoundingClientRect();flyGiftToInventory(gift.name,rect.left+rect.width/2,rect.top+rect.height/2);bet=null;mines.bet=null;saveState(); renderMines();}

// === –®–∞—Ö—Ç–∞ ===
let mineBlocks=localStorage.getItem('mineBlocks')?JSON.parse(localStorage.getItem('mineBlocks')):Array.from({length:16},()=>+(1+Math.random()*14).toFixed(2));
function renderMinefield(){
  backgroundEl.style.backgroundImage='url(images/minefield.jpg)';
  let html=`<div class="mine-blocks">`;
  mineBlocks.forEach((price,i)=>{html+=`<div class="block" data-idx="${i}" data-price="${price}">${price} TON</div>`;});
  html+=`</div>`;contentEl.innerHTML=html;
  document.querySelectorAll('.block').forEach(block=>{
    block.onclick=()=>{const idx=+block.dataset.idx;const price=+block.dataset.price;if(balance<price)return alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞');balance-=price;updateBalance();const candidates=gifts.filter(g=>g.price>=price*0.7&&g.price<=price*1.3);const gift=candidates[Math.floor(Math.random()*candidates.length)];const rect=block.getBoundingClientRect();flyGiftToInventory(gift.name,rect.left+rect.width/2,rect.top+rect.height/2);mineBlocks[idx]=+(price*(1+Math.random()*0.2)).toFixed(2);localStorage.setItem('mineBlocks',JSON.stringify(mineBlocks)); renderMinefield();};
  });
}

// === –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å ===
function renderInventory(){
  backgroundEl.style.backgroundImage='url(images/inventory.jpg)';
  let html=`<div class="inventory">`;
  inventory.forEach((gift,idx)=>{html+=`<div class="gift-card"><div class="gift-anim" id="gift-${idx}"></div><div>${gift.name} (${gift.price} TON)</div><div class="gift-buttons"><button onclick="sellGift(${idx})">–ü—Ä–æ–¥–∞—Ç—å</button><button>–í—ã–≤–µ—Å—Ç–∏</button></div></div>`;});
  html+=`</div>`;contentEl.innerHTML=html;
  inventory.forEach((gift,idx)=>{const cont=document.getElementById(`gift-${idx}`);lottie.loadAnimation({container:cont,renderer:'svg',loop:true,autoplay:true,path:`emoji/${gift.name}.json`});});
}
function sellGift(idx){balance+=inventory[idx].price;inventory.splice(idx,1);updateBalance();renderInventory(); saveState();}

// === –ù–∞–≤–∏–≥–∞—Ü–∏—è ===
document.getElementById('tab-menu').onclick=()=>{setActive('tab-menu');renderMenu();};
document.getElementById('tab-mines').onclick=()=>{setActive('tab-mines');renderMines();};
document.getElementById('tab-minefield').onclick=()=>{setActive('tab-minefield');renderMinefield();};
document.getElementById('tab-inventory').onclick=()=>{setActive('tab-inventory');renderInventory();};
function setActive(id){document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.getElementById(id).classList.add('active');}
renderMenu();
</script>
</body>
</html>
