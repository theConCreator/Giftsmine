<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Game App</title>
  <style>
    @font-face {
      font-family: "Minecraft";
      src: url("minecraft.ttf") format("truetype");
    }
    body {
      margin: 0;
      font-family: "Minecraft", sans-serif;
      background-size: cover;
      background-position: center;
      color: white;
    }
    .hidden { display: none; }
    #loader {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: black;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 1000;
    }
    #loaderProgress {
      width: 80%;
      height: 20px;
      border: 1px solid white;
      margin-top: 20px;
    }
    #loaderProgressBar {
      width: 0%;
      height: 100%;
      background: limegreen;
    }
    nav {
      display: flex;
      gap: 10px;
      background: rgba(0,0,0,0.5);
      padding: 10px;
    }
    nav button {
      padding: 10px;
      background: #333;
      color: white;
      border: none;
      cursor: pointer;
    }
    .section { display: none; padding: 20px; }
    .section.active { display: block; }

    /* === Баланс === */
    #balanceSection { text-align: center; }
    #promoInput {
      padding: 8px;
      font-size: 1em;
      margin-bottom: 10px;
    }
    #history {
      max-height: 200px;
      overflow-y: auto;
      margin-top: 15px;
      background: rgba(0,0,0,0.4);
      padding: 10px;
      border-radius: 8px;
    }
    .history-item {
      margin: 5px 0;
      padding: 5px;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
    }

    /* === Инвентарь === */
    #inventoryItems {
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(150px,1fr));
      gap: 10px;
    }
    .item {
      background: rgba(0,0,0,0.5);
      padding: 10px;
      border-radius: 8px;
      text-align: center;
    }
    .item button {
      margin-top: 5px;
      display: block;
      width: 100%;
      padding: 5px;
      border: none;
      background: #555;
      color: white;
      cursor: pointer;
      border-radius: 4px;
    }

    /* === Шахта === */
    #mineGrid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }
    .block {
      background: #444;
      aspect-ratio: 1/1;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border-radius: 6px;
      position: relative;
    }
    .block.cooldown {
      filter: brightness(0.5);
      cursor: not-allowed;
    }
    .block-price {
      position: absolute;
      bottom: 2px;
      right: 2px;
      background: rgba(0,0,0,0.6);
      padding: 2px 4px;
      font-size: 0.8em;
      border-radius: 3px;
    }
  </style>
</head>
<body>
  <!-- Loader -->
  <div id="loader">
    <div>Загрузка...</div>
    <div id="loaderProgress"><div id="loaderProgressBar"></div></div>
  </div>

  <!-- Навигация -->
  <nav>
    <button onclick="showSection('menu')">Меню</button>
    <button onclick="showSection('mine')">Шахта</button>
    <button onclick="showSection('inventory')">Инвентарь</button>
    <button onclick="showSection('balanceSection')">Баланс</button>
  </nav>

  <!-- Секции -->
  <div id="menu" class="section active">
    <h1>Главное меню</h1>
    <p>Добро пожаловать!</p>
  </div>

  <div id="mine" class="section">
    <h1>Шахта</h1>
    <div id="mineGrid"></div>
  </div>

  <div id="inventory" class="section">
    <h1>Инвентарь</h1>
    <div id="inventoryItems"></div>
  </div>

  <div id="balanceSection" class="section">
    <h1>Баланс</h1>
    <div id="balanceValue"></div>
    <input id="promoInput" type="text" placeholder="Введите промокод">
    <button onclick="applyPromo()">Активировать промокод</button>
    <h3>Пополнение:</h3>
    <button onclick="addBalance(10)">Пополнить через CryptoBot (+10 TON)</button>
    <button onclick="addBalance(20)">Пополнить через TON (+20 TON)</button>
    <button onclick="addBalance(5)">Пополнить через Stars (+5 TON)</button>
    <h3>История операций</h3>
    <div id="history"></div>
  </div>

  <script>
    const backgrounds = {
      menu: "backgrounds/menu.jpg",
      mine: "backgrounds/mine.jpg",
      inventory: "backgrounds/inventory.jpg",
      balanceSection: "backgrounds/mobs.jpg"
    };

    let balance = 50;
    let history = [];
    let inventory = [];

    const gifts=[
  {name:"Hypno Lollipop",price:1.77},{name:"Desk Calendar",price:1.31},
  {name:"B-Day Candle",price:1.32},{name:"Lol Pop",price:1.32},
  {name:"Lunar Snake",price:1.38},{name:"Snake Box",price:1.36},
  {name:"Xmas Stocking",price:1.38},{name:"Whip Cupcake",price:1.38},
  {name:"Candy Cane",price:1.48},{name:"Pet Snake",price:1.58},
  {name:"Jester Hat",price:1.62},{name:"Snoop Dogg",price:1.64},
  {name:"Homemade Cake",price:1.7},{name:"Holiday Drink",price:1.7},
  {name:"Jingle Bells",price:1.74},{name:"Cookie Heart",price:1.75},
  {name:"Big Year",price:1.78},{name:"Party Sparkler",price:1.8},
  {name:"Winter Wreath",price:1.79},{name:"Swag Bag",price:1.91},
  {name:"Tama Gadget",price:1.93},{name:"Ginger Cookie",price:1.95},
  {name:"Moon Pendant",price:1.96},{name:"Jack-in-the-Box",price:2.01},
  {name:"Spiced Wine",price:2.12},{name:"Stellar Rocket",price:2.19},
  {name:"Star Notepad",price:2.32},{name:"Easter Egg",price:2.46},
  {name:"Restless Jar",price:2.5},{name:"Santa Hat",price:2.6},
  {name:"Snow Globe",price:2.65},{name:"Hex Pot",price:2.7},
  {name:"Joyful Bundle",price:2.71},{name:"Lush Bouquet",price:2.84},
  {name:"Witch Hat",price:2.86},{name:"Light Sword",price:3.13},
  {name:"Spy Agaric",price:3.2},{name:"Bow Tie",price:3.22},
  {name:"Eternal Candle",price:3.38},{name:"Bunny Muffin",price:3.34},
  {name:"Jelly Bunny",price:3.43},{name:"Berry Box",price:3.58},
  {name:"Evil Eye",price:3.6},{name:"Snow Mittens",price:3.67},
  {name:"Valentine Box",price:4.2},{name:"Snoop Cigar",price:4.26},
  {name:"Sakura Flower",price:4.77},{name:"Hanging Star",price:5.26},
  {name:"Jolly Chimp",price:5.34},{name:"Sleigh Bell",price:7.63},
  {name:"Skull Flower",price:7.7},{name:"Crystal Ball",price:7.86},
  {name:"Record Player",price:7.91},{name:"Love Candle",price:7.94},
  {name:"Top Hat",price:7.99},{name:"Trapped Heart",price:8.69},
  {name:"Love Potion",price:8.79},{name:"Flying Broom",price:9.45},
  {name:"Cupid Charm",price:11.26},{name:"Eternal Rose",price:13.71},
  {name:"Ionic Dryer",price:14.21},{name:"Diamond Ring",price:16.39},
  {name:"Voodoo Doll",price:16.43},{name:"Mad Pumpkin",price:17.91},
  {name:"Toy Bear",price:19.3},{name:"Vintage Cigar",price:23.98},
  {name:"Low Rider",price:24.8},{name:"Signet Ring",price:25.1},
  {name:"Neko Helmet",price:26.41},{name:"Electric Skull",price:31},
  {name:"Kissed Frog",price:34},{name:"Swiss Watch",price:35},
  {name:"Sharp Tongue",price:39.69},{name:"Scared Cat",price:43.6},
  {name:"Genie Lamp",price:47.07},{name:"Westside Sign",price:51.27},
  {name:"Bonded Ring",price:54.99},{name:"Gem Signet",price:72.98},
  {name:"Magic Potion",price:72.98},{name:"Ion Gem",price:83},
  {name:"Astral Shard",price:95.97},{name:"Perfume Bottle",price:95.99},
  {name:"Loot Bag",price:90.1},{name:"Mini Oscar",price:123.89},
  {name:"Nail Bracelet",price:129.84},{name:"Heroic Helmet",price:219.99},
  {name:"Precious Peach",price:379.99},{name:"Durov’s Cap",price:794.9},
  {name:"Heart Locket",price:1450},{name:"Plush Pepe",price:5199}
];


    const oreTypes = [
      {img: "ores/coal.png", hits: 2},
      {img: "ores/iron.png", hits: 3},
      {img: "ores/gold.png", hits: 4},
      {img: "ores/diamond.png", hits: 5},
      {img: "ores/emerald.png", hits: 6}
    ];

    function preloadImages(sources, progressCallback) {
      let loaded = 0;
      return new Promise(resolve=>{
        sources.forEach(src=>{
          const img=new Image();
          img.onload = img.onerror = ()=>{
            loaded++;
            progressCallback(loaded/sources.length);
            if(loaded===sources.length) resolve();
          };
          img.src=src;
        });
      });
    }

    function preloadAssets(){
      const images = Object.values(backgrounds);
      preloadImages(images, p=>{
        document.getElementById("loaderProgressBar").style.width=(p*100)+"%";
      }).then(()=>{
        document.getElementById("loader").classList.add("hidden");
        document.body.style.backgroundImage = `url(${backgrounds['menu']})`;
        updateBalance();
        generateMine();
      });
    }

    function updateBalance() {
      document.getElementById("balanceValue").innerHTML =
        `Баланс: ${balance.toFixed(2)} <img src="ton.svg" style="width:16px;vertical-align:middle">`;
    }

    function addBalance(amount) {
      balance += amount;
      history.push({type: "Пополнение", amount: amount});
      renderHistory();
      updateBalance();
    }

    function applyPromo() {
      const code = document.getElementById("promoInput").value.trim();
      if (!code) return;
      if (code === "FREE10") {
        balance += 10;
        history.push({type: "Промокод", amount: 10});
        renderHistory();
        updateBalance();
        alert("Промокод активирован! +10 TON");
      } else {
        alert("Неверный промокод");
      }
      document.getElementById("promoInput").value = "";
    }

    function renderHistory() {
      const list = document.getElementById("history");
      list.innerHTML = "";
      history.slice().reverse().forEach(item => {
        const div = document.createElement("div");
        div.className = "history-item";
        div.textContent = `${item.type}: ${item.amount} TON`;
        list.appendChild(div);
      });
    }

    function showSection(id) {
      document.querySelectorAll(".section").forEach(sec => sec.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      document.body.style.backgroundImage = `url(${backgrounds[id]})`;
      if (id==="inventory") renderInventory();
    }

    // === Шахта ===
    function generateMine() {
      const grid = document.getElementById("mineGrid");
      grid.innerHTML = "";
      for (let i=0;i<16;i++) {
        const cell = document.createElement("div");
        spawnBlock(cell);
        grid.appendChild(cell);
      }
    }

    function spawnBlock(cell) {
      const ore = oreTypes[Math.floor(Math.random()*oreTypes.length)];
      const price = +(1 + Math.random()*10).toFixed(2);
      let hits = 0;

      cell.className="block";
      cell.style.backgroundImage=`url(${ore.img})`;
      cell.style.backgroundSize="cover";
      cell.innerHTML=`<div class="block-price">${price} TON</div>`;

      cell.onclick=()=>{
        if (balance < price) { alert("Недостаточно средств!"); return; }
        hits++;
        if (hits >= ore.hits) {
          balance -= price;
          updateBalance();
          const gift = gifts[Math.floor(Math.random()*gifts.length)];
          inventory.push(gift);
          renderInventory();
          startCooldown(cell);
        }
      };
    }

    function startCooldown(cell) {
      cell.classList.add("cooldown");
      cell.innerHTML="<div class='block-price'>Перезарядка...</div>";
      cell.onclick=null;
      setTimeout(()=>{ spawnBlock(cell); cell.classList.remove("cooldown"); },3000);
    }

    // === Инвентарь ===
    function renderInventory() {
      const list = document.getElementById("inventoryItems");
      list.innerHTML="";
      inventory.forEach((gift, idx)=>{
        const div=document.createElement("div");
        div.className="item";
        div.innerHTML=`<strong>${gift.name}</strong><br>${gift.price} TON`;
        const sell=document.createElement("button");
        sell.textContent="Продать";
        sell.onclick=()=>{
          balance += gift.price;
          inventory.splice(idx,1);
          updateBalance();
          renderInventory();
        };
        div.appendChild(sell);
        list.appendChild(div);
      });
    }

    window.onload = preloadAssets;
  </script>
</body>
</html>
