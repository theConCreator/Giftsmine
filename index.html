<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GiftsMine üéÅ</title>
  <style>
    @font-face { font-family: 'Minecraft'; src: url('minecraft.ttf') format('truetype'); }
    body, html {
      margin: 0; padding: 0; height: 100%; font-family: 'Minecraft', sans-serif;
      background: #000 no-repeat center/cover; color: #fff; overflow: hidden;
      display: flex; flex-direction: column;
    }
    #loader {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: #000; display: flex; flex-direction: column;
      align-items: center; justify-content: center; z-index: 9999;
      transition: opacity 0.5s;
    }
    #loader.hidden { opacity: 0; pointer-events: none; }
    #loaderAnimation { width: 180px; height: 180px; }
    #loaderProgress { width: 50%; height: 14px; background: #333;
      border-radius: 8px; margin-top: 15px; overflow: hidden; }
    #loaderProgressBar { width: 0; height: 100%; background: #ff9a9e; transition: 0.3s; }

    #balanceBar {
      padding: 12px; text-align: right; font-weight: bold;
      background: rgba(0,0,0,0.2); backdrop-filter: blur(5px);
    }

    main { flex: 1; overflow-y: auto; padding: 15px; padding-bottom: 70px; display: none; }
    main.active { display: block; }
    h2 { text-align: center; margin-top: 0; }

    .banner {
      width: 100%; aspect-ratio: 5/1; border-radius: 12px;
      overflow: hidden; margin-bottom: 15px;
    }
    .banner img { width: 100%; height: 100%; object-fit: cover; }

    /* –®–∞—Ö—Ç–∞ */
    .grid { display: grid; gap: 5px; grid-template-columns: repeat(4, 1fr); }
    .block {
      aspect-ratio: 1/1; border-radius: 6px;
      background-size: cover; background-position: center;
      display: flex; align-items: flex-end; justify-content: flex-end;
      position: relative; cursor: pointer; overflow: hidden;
      image-rendering: pixelated;
    }
    .block-price {
      font-size: 0.7em; padding: 2px 4px;
      background: rgba(0,0,0,0.6); border-radius: 4px;
      margin: 3px;
    }
    .block.cooldown { filter: brightness(0.6); cursor: not-allowed; }
    .destroy-stage {
      position: absolute; inset: 0; image-rendering: pixelated;
    }

    /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
    .inventory-list { display: flex; flex-direction: column; gap: 10px; }
    .gift-item {
      background: rgba(20,20,20,0.9); border-radius: 10px; padding: 10px;
      display: flex; flex-direction: column; gap: 6px;
    }
    .gift-top { display: flex; gap: 10px; align-items: center; }
    .gift-preview { width: 60px; height: 60px; border-radius: 6px; background: #111; }
    .gift-actions { display: flex; gap: 6px; }
    .gift-actions button { flex: 1; }

    /* –ë–∞–ª–∞–Ω—Å */
    .balance-section { margin-bottom: 20px; }
    .balance-section h3 { margin: 0 0 10px 0; font-size: 1.1em; text-align: center; }
    .balance-buttons { display: flex; flex-direction: column; gap: 10px; }
    .balance-buttons button {
      width: 100%; padding: 12px; border-radius: 8px; font-weight: bold;
      background: linear-gradient(135deg,#6a11cb,#2575fc); color: #fff;
    }
    input[type="text"] {
      width: 100%; padding: 10px; border-radius: 8px;
      border: none; background: rgba(255,255,255,0.1);
      color: #fff; font-weight: bold;
    }
    #transactionHistory div {
      font-size: 0.85em; padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    /* –ù–∞–≤–∏–≥–∞—Ü–∏—è */
    .tab-bar {
      position: fixed; bottom: 0; left: 0; right: 0;
      display: flex; background: rgba(0,0,0,0.2); border-top: 2px solid #fff;
    }
    .tab-bar button {
      flex: 1; padding: 10px; font-size: 0.9em; border: none;
      background: transparent; color: #fff; font-weight: bold;
    }
    .tab-bar button.active {
      background: rgba(255,255,255,0.15);
    }
    button { cursor: pointer; border: none; }
    .flying { position: absolute; width: 60px; height: 60px; pointer-events: none; z-index: 2000; }
  </style>
</head>
<body>
  <!-- –ó–∞–≥—Ä—É–∑—á–∏–∫ -->
  <div id="loader">
    <div id="loaderAnimation"></div>
    <div id="loaderProgress"><div id="loaderProgressBar"></div></div>
    <p>–ó–∞–≥—Ä—É–∑–∫–∞...</p>
  </div>

  <!-- –ë–∞–ª–∞–Ω—Å -->
  <div id="balanceBar">–ë–∞–ª–∞–Ω—Å: 0 <img src="ton.svg" width="16" style="vertical-align:middle"></div>

  <!-- –í–∫–ª–∞–¥–∫–∏ -->
  <main id="menu" class="active">
    <h2>–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</h2>
    <div class="banner"><img src="images/banner.jpg" alt="–†–µ–∫–ª–∞–º–∞"></div>
    <p style="text-align:center;color:#bbb">–í—ã–±–∏—Ä–∞–π —Ä–µ–∂–∏–º –∏ –∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –ø–æ–¥–∞—Ä–∫–∏!</p>
  </main>

  <main id="mine">
    <h2>–®–∞—Ö—Ç–∞</h2>
    <div id="brokenBlocks" style="text-align:center;margin-bottom:12px">–°–ª–æ–º–∞–Ω–æ –±–ª–æ–∫–æ–≤: 0</div>
    <div class="grid" id="mineGrid"></div>
  </main>

  <main id="inventory">
    <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
    <div class="inventory-list" id="inventoryList"></div>
  </main>

  <main id="balanceTab">
    <h2>–ë–∞–ª–∞–Ω—Å</h2>

    <div class="balance-section">
      <h3>–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</h3>
      <div class="balance-buttons">
        <button onclick="addBalance('ton')"><img src="ton.svg" width="18"> TON –∫–æ—à–µ–ª—ë–∫<br><small>–∫–æ–º–∏—Å—Å–∏—è 0%</small></button>
        <button onclick="addBalance('crypto')"><img src="icons/cryptobot.svg" width="18"> Crypto Bot<br><small>–∫–æ–º–∏—Å—Å–∏—è 5%</small></button>
        <button onclick="addBalance('stars')"><img src="icons/stars.svg" width="18"> Telegram Stars<br><small>–∫–æ–º–∏—Å—Å–∏—è 20%</small></button>
      </div>
    </div>

    <div class="balance-section">
      <h3>–ü—Ä–æ–º–æ–∫–æ–¥</h3>
      <input type="text" id="promoCode" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥">
      <button onclick="redeemPromo()" style="margin-top:8px;width:100%;padding:10px;border-radius:8px;background:linear-gradient(135deg,#ff9a9e,#fad0c4);color:#fff">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
    </div>

    <div class="balance-section">
      <h3>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞</h3>
      <p style="text-align:center;font-size:0.9em;color:#ccc">+0.5% —Å –¥–µ–ø–æ–∑–∏—Ç–æ–≤ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –∑–∞ –∫–∞–∂–¥—ã–π —Å–ª–æ–º–∞–Ω–Ω—ã–π –±–ª–æ–∫ (–º–∞–∫—Å 20%)</p>
    </div>

    <div class="balance-section">
      <h3>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
      <div id="transactionHistory"></div>
    </div>
  </main>

  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <div class="tab-bar">
    <button id="tab-menu" class="active" onclick="showTab('menu')">–ú–µ–Ω—é</button>
    <button id="tab-mine" onclick="showTab('mine')">–®–∞—Ö—Ç–∞</button>
    <button id="tab-inventory" onclick="showTab('inventory')">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
    <button id="tab-balanceTab" onclick="showTab('balanceTab')">–ë–∞–ª–∞–Ω—Å</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.2/lottie.min.js"></script>
  <script>
    // === –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ===
    let balance = 0, transactions = [], inventory = [], brokenBlocks = 0;
    const animationMap = {};

    const backgrounds = {
      menu: "images/menu.jpg",
      mine: "images/mine.jpg",
      inventory: "images/inventory.jpg",
      balanceTab: "images/mobs.jpg"
    };

    const gifts = [
      {name:"Hypno Lollipop",price:1.77}, {name:"Desk Calendar",price:1.31},
      {name:"B-Day Candle",price:1.32}, {name:"Lol Pop",price:1.32},
      {name:"Lunar Snake",price:1.38}, {name:"Snake Box",price:1.36},
      {name:"Xmas Stocking",price:1.38}, {name:"Whip Cupcake",price:1.38},
      {name:"Candy Cane",price:1.48}, {name:"Pet Snake",price:1.58},
      {name:"Jester Hat",price:1.62}, {name:"Snoop Dogg",price:1.64},
      {name:"Homemade Cake",price:1.7}, {name:"Holiday Drink",price:1.7},
      {name:"Jingle Bells",price:1.74}, {name:"Cookie Heart",price:1.75},
      {name:"Big Year",price:1.78}, {name:"Party Sparkler",price:1.8},
      {name:"Winter Wreath",price:1.79}, {name:"Swag Bag",price:1.91},
      {name:"Tama Gadget",price:1.93}, {name:"Ginger Cookie",price:1.95},
      {name:"Moon Pendant",price:1.96}, {name:"Jack-in-the-Box",price:2.01},
      {name:"Spiced Wine",price:2.12}, {name:"Stellar Rocket",price:2.19},
      {name:"Star Notepad",price:2.32}, {name:"Easter Egg",price:2.46},
      {name:"Restless Jar",price:2.5}, {name:"Santa Hat",price:2.6},
      {name:"Snow Globe",price:2.65}, {name:"Hex Pot",price:2.7},
      {name:"Joyful Bundle",price:2.71}, {name:"Lush Bouquet",price:2.84},
      {name:"Witch Hat",price:2.86}, {name:"Light Sword",price:3.13},
      {name:"Spy Agaric",price:3.2}, {name:"Bow Tie",price:3.22},
      {name:"Eternal Candle",price:3.38}, {name:"Bunny Muffin",price:3.34},
      {name:"Jelly Bunny",price:3.43}, {name:"Berry Box",price:3.58},
      {name:"Evil Eye",price:3.6}, {name:"Snow Mittens",price:3.67},
      {name:"Valentine Box",price:4.2}, {name:"Snoop Cigar",price:4.26},
      {name:"Sakura Flower",price:4.77}, {name:"Hanging Star",price:5.26},
      {name:"Jolly Chimp",price:5.34}, {name:"Sleigh Bell",price:7.63},
      {name:"Skull Flower",price:7.7}, {name:"Crystal Ball",price:7.86},
      {name:"Record Player",price:7.91}, {name:"Love Candle",price:7.94},
      {name:"Top Hat",price:7.99}, {name:"Trapped Heart",price:8.69},
      {name:"Love Potion",price:8.79}, {name:"Flying Broom",price:9.45},
      {name:"Cupid Charm",price:11.26}, {name:"Eternal Rose",price:13.71},
      {name:"Ionic Dryer",price:14.21}, {name:"Diamond Ring",price:16.39},
      {name:"Voodoo Doll",price:16.43}, {name:"Mad Pumpkin",price:17.91},
      {name:"Toy Bear",price:19.3}, {name:"Vintage Cigar",price:23.98},
      {name:"Low Rider",price:24.8}, {name:"Signet Ring",price:25.1},
      {name:"Neko Helmet",price:26.41}, {name:"Electric Skull",price:31},
      {name:"Kissed Frog",price:34}, {name:"Swiss Watch",price:35},
      {name:"Sharp Tongue",price:39.69}, {name:"Scared Cat",price:43.6},
      {name:"Genie Lamp",price:47.07}, {name:"Westside Sign",price:51.27},
      {name:"Bonded Ring",price:54.99}, {name:"Gem Signet",price:72.98},
      {name:"Magic Potion",price:72.98}, {name:"Ion Gem",price:83},
      {name:"Astral Shard",price:95.97}, {name:"Perfume Bottle",price:95.99},
      {name:"Loot Bag",price:90.1}, {name:"Mini Oscar",price:123.89},
      {name:"Nail Bracelet",price:129.84}, {name:"Heroic Helmet",price:219.99},
      {name:"Precious Peach",price:379.99}, {name:"Durov‚Äôs Cap",price:794.9},
      {name:"Heart Locket",price:1450}, {name:"Plush Pepe",price:5199}
    ];

    const oreTypes = [
      { img:"images/ores/coal.png", hits:3 },
      { img:"images/ores/iron.png", hits:4 },
      { img:"images/ores/gold.png", hits:5 },
      { img:"images/ores/diamond.png", hits:6 },
      { img:"images/ores/emerald.png", hits:7 },
      { img:"images/ores/earth.png", hits:2, type:"earth" },
      { img:"images/ores/glass.png", hits:4, type:"glass" }
    ];

    // === –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å ===
    function updateBalance(){
      document.getElementById('balanceBar').innerHTML =
        `–ë–∞–ª–∞–Ω—Å: ${balance.toFixed(2)} <img src="ton.svg" width="16" style="vertical-align:middle">`;
    }
    function updateTransactionHistory(){
      const el=document.getElementById('transactionHistory'); el.innerHTML='';
      transactions.forEach(t=>{
        el.innerHTML += `<div>${t}</div>`;
      });
    }
    function updateBrokenBlocks(){
      document.getElementById('brokenBlocks').textContent=`–°–ª–æ–º–∞–Ω–æ –±–ª–æ–∫–æ–≤: ${brokenBlocks}`;
    }

    function showTab(id){
      document.querySelectorAll('main').forEach(m=>m.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('.tab-bar button').forEach(b=>b.classList.remove('active'));
      document.getElementById('tab-'+id).classList.add('active');
      document.body.style.backgroundImage=`url(${backgrounds[id]})`;
      if(id==='inventory') renderInventory();
    }

    // === –®–∞—Ö—Ç–∞ ===
    function spawnBlock(cell){
      const ore = oreTypes[Math.floor(Math.random()*oreTypes.length)];
      let price = +(1+Math.random()*10).toFixed(2);
      cell.className="block"; cell.style.backgroundImage=`url(${ore.img})`;
      cell.innerHTML=`<div class="block-price">${price}<img src="ton.svg" width="12"></div>`;
      let hits=0, stages=[0,3,6,9], destroyOverlay=document.createElement('img');
      destroyOverlay.className="destroy-stage"; cell.appendChild(destroyOverlay);

      let glassGift=null;
      if(ore.type==="glass"){
        glassGift=gifts[Math.floor(Math.random()*gifts.length)];
        const prev=document.createElement('div'); prev.className='gift-preview';
        prev.style.position='absolute'; prev.style.inset='25%'; prev.style.fontSize='0.5em';
        prev.style.display='flex'; prev.style.alignItems='center'; prev.style.justifyContent='center';
        prev.textContent=glassGift.name;
        cell.appendChild(prev);
      }

      cell.onclick=()=>{
        if(balance<price){ alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–∞–ª–∞–Ω—Å–∞!"); return; }
        hits++;
        let stageIndex=Math.floor(hits/ore.hits*stages.length);
        if(stageIndex>=stages.length) stageIndex=stages.length-1;
        destroyOverlay.src=`destroy/destroy_stage_${stages[stageIndex]}.png`;

        if(hits>=ore.hits){
          brokenBlocks++; updateBrokenBlocks();
          balance-=price; updateBalance();
          transactions.unshift(`–°–ø–∏—Å–∞–Ω–∏–µ: -${price} TON`); updateTransactionHistory();

          if(ore.type==="earth"){
            if(Math.random()<0.5){ // —Ç–æ–Ω
              flyTon(cell,0.1);
              balance+=0.1; updateBalance();
              transactions.unshift("–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ –±–ª–æ–∫–∞: +0.1 TON");
              updateTransactionHistory();
            } else {
              const cheap=gifts.filter(g=>g.price<2);
              const g=cheap[Math.floor(Math.random()*cheap.length)];
              inventory.push(g); renderInventory();
              flyGift(g,cell);
            }
          } else if(ore.type==="glass" && glassGift){
            inventory.push(glassGift); renderInventory();
            flyGift(glassGift,cell);
          } else {
            const g=gifts[Math.floor(Math.random()*gifts.length)];
            inventory.push(g); renderInventory();
            flyGift(g,cell);
          }

          // —Ä–µ—Å–ø–∞–≤–Ω
          let respawn=(30+Math.random()*60)*1000;
          cell.classList.add("cooldown");
          cell.innerHTML=`<div class="block-price">${Math.round(respawn/1000)}s</div>`;
          setTimeout(()=>spawnBlock(cell),respawn);
        }
      };
    }

    function generateMineGrid(){
      const grid=document.getElementById('mineGrid'); grid.innerHTML='';
      for(let i=0;i<16;i++){ let cell=document.createElement('div'); spawnBlock(cell); grid.appendChild(cell); }
    }

    // === –ê–Ω–∏–º–∞—Ü–∏–∏ –ø–æ–ª—ë—Ç–∞ ===
    function flyGift(gift,fromCell){
      const rect=fromCell.getBoundingClientRect();
      const fly=document.createElement('div'); fly.className='flying';
      fly.style.left=rect.left+rect.width/2-30+"px";
      fly.style.top=rect.top+rect.height/2-30+"px";
      document.body.appendChild(fly);
      const anim=lottie.loadAnimation({container:fly,renderer:'svg',loop:true,autoplay:true,path:`emoji/${gift.name}.json`});
      const invBtn=document.getElementById('tab-inventory').getBoundingClientRect();
      const targetX=invBtn.left+invBtn.width/2-30, targetY=invBtn.top-30;
      fly.animate([{transform:'translate(0,0)'},{transform:`translate(${targetX-(rect.left+rect.width/2-30)}px,${targetY-(rect.top+rect.height/2-30)}px)`}],{duration:1200,easing:'ease-in-out'});
      setTimeout(()=>{fly.remove();anim.destroy();},1200);
    }
    function flyTon(fromCell,amount){
      const rect=fromCell.getBoundingClientRect();
      const fly=document.createElement('div'); fly.className='flying';
      fly.innerHTML=`<div style="display:flex;align-items:center;gap:4px;background:#222;padding:4px 6px;border-radius:6px;">
        <img src="ton.svg" width="20">+${amount}</div>`;
      fly.style.left=rect.left+rect.width/2-30+"px"; fly.style.top=rect.top+"px";
      document.body.appendChild(fly);
      const bal=document.getElementById('balanceBar').getBoundingClientRect();
      const targetX=bal.left+bal.width/2-30, targetY=bal.top;
      fly.animate([{transform:'translate(0,0)'},{transform:`translate(${targetX-(rect.left+rect.width/2-30)}px,${targetY-rect.top}px)`}],{duration:1200,easing:'ease-in-out'});
      setTimeout(()=>fly.remove(),1200);
    }

    // === –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å ===
    function renderInventory(){
      const list=document.getElementById('inventoryList'); list.innerHTML='';
      inventory.forEach((gift,idx)=>{
        const div=document.createElement('div'); div.className='gift-item';
        div.innerHTML=`<div class="gift-top"><div class="gift-preview">${gift.name}</div><div>${gift.price} TON</div></div>`;
        const actions=document.createElement('div'); actions.className='gift-actions';
        const sell=document.createElement('button'); sell.textContent='–ü—Ä–æ–¥–∞—Ç—å';
        sell.onclick=()=>{ balance+=gift.price; updateBalance(); transactions.unshift(`–ü—Ä–æ–¥–∞–∂–∞: +${gift.price} TON`); updateTransactionHistory(); inventory.splice(idx,1); renderInventory(); };
        const withdraw=document.createElement('button'); withdraw.textContent='–í—ã–≤–µ—Å—Ç–∏';
        withdraw.onclick=()=>{ transactions.unshift(`–í—ã–≤–æ–¥: ${gift.name}`); updateTransactionHistory(); inventory.splice(idx,1); renderInventory(); };
        actions.appendChild(sell); actions.appendChild(withdraw); div.appendChild(actions); list.appendChild(div);
      });
    }

    // === –ë–∞–ª–∞–Ω—Å ===
    function redeemPromo(){
      const code=document.getElementById('promoCode').value.trim();
      if(code==='BONUS10'){ balance+=10; updateBalance(); transactions.unshift("–ü—Ä–æ–º–æ–∫–æ–¥: +10 TON"); updateTransactionHistory(); alert("–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!"); }
      else { alert("–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥"); }
    }
    function addBalance(method){
      let amount=100; let fee=0;
      if(method==='crypto') fee=0.05;
      if(method==='stars') fee=0.20;
      const final=amount*(1-fee);
      balance+=final; updateBalance();
      transactions.unshift(`–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ ${amount} TON —á–µ—Ä–µ–∑ ${method} (–∫–æ–º–∏—Å—Å–∏—è ${fee*100}%)`);
      updateTransactionHistory();
    }

    // === –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ ===
    async function preload(){
      const files=[...Object.values(backgrounds),...oreTypes.map(o=>o.img)];
      gifts.forEach(g=>files.push(`emoji/${g.name}.json`));
      files.push("ton.svg","icons/cryptobot.svg","icons/stars.svg","minecraft.ttf");
      let loaded=0;
      for(const f of files){
        try{
          if(f.endsWith(".json")){
            const a=document.createElement('div'); a.style.display="none"; document.body.appendChild(a);
            await new Promise(r=>{
              const anim=lottie.loadAnimation({container:a,renderer:'svg',loop:false,autoplay:false,path:f});
              anim.addEventListener('DOMLoaded',()=>{document.body.removeChild(a);anim.destroy();r();});
            });
          } else {
            await new Promise(r=>{const img=new Image(); img.onload=r; img.onerror=r; img.src=f;});
          }
        }catch{}
        loaded++; document.getElementById('loaderProgressBar').style.width=`${loaded/files.length*100}%`;
      }
    }

    async function init(){
      lottie.loadAnimation({container:document.getElementById('loaderAnimation'),renderer:'svg',loop:true,autoplay:true,path:'myLoader.json'});
      await preload();
      document.getElementById('loader').classList.add('hidden');
      updateBalance(); generateMineGrid();
    }
    init();
  </script>
</body>
</html>
